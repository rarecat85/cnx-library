import{_ as X}from"./XIEB4zfM.js";import{_ as G,a as J}from"./DYcgDTZD.js";import{F as K,u as O,r as i,o as Q,D as I,a as j,O as M,L as d,g as v,H as L,K as n,I as s,R as N,S as P,P as t,Q as C,M as x,G as q,J as Y,T as Z}from"./ycURoG9Y.js";import{u as S}from"./D7she8QH.js";import{u as ee}from"./CRZ2QJAh.js";const te={class:"remember-me-container mb-4"},oe={class:"error-content"},se={class:"error-message"},ae=["disabled"],ne={class:"auth-links text-center mt-4"},le={class:"logo-bottom text-center mt-6"},ie={class:"logo-with-credit"},re={__name:"login",setup(ue){const{login:z,loading:c,resendVerificationEmailForLogin:B,user:T,getAutoLoginInfo:A}=S(),k=O(),r=i(""),m=i(""),a=i(""),R=i(),_=i(!1),b=i(!1),g=i(!1),f=i(!1);Q(async()=>{localStorage.getItem("rememberMe")==="true"&&(f.value=!0);const e=I("auth_state_ready");if(!I("auth_initialized",()=>!1).value&&e.value)try{await Promise.race([e.value,new Promise(l=>setTimeout(l,5e3))])}catch(l){console.error("인증 상태 확인 대기 중 오류:",l)}const{loading:y}=S();if(y.value){const p=Date.now();for(;y.value&&Date.now()-p<3e3;)await new Promise(w=>setTimeout(w,100))}if(T.value){await k.push("/");return}const h=A();if(h){const{$firebaseAuth:l}=j(),p=l;if(p&&p.currentUser){await k.push("/");return}r.value=h.email}});const D=[o=>!!o||"이메일을 입력해주세요",o=>/.+@.+\..+/.test(o)||"올바른 이메일 형식이 아닙니다"],F=[o=>!!o||"비밀번호를 입력해주세요",o=>o&&o.length>=6||"비밀번호는 6자 이상이어야 합니다"],U=async()=>{a.value="",b.value=!1;const{valid:o}=await R.value.validate();if(!o)return;const e=await z(r.value,m.value,f.value);e.success?await k.push("/"):(a.value=e.error||"로그인에 실패했습니다.",e.error&&(e.error.includes("이메일 인증이 완료되지 않았습니다")||e.error.includes("이메일 재인증이 필요합니다"))&&(b.value=!0))},$=async()=>{if(!r.value||!m.value){a.value="이메일과 비밀번호를 입력해주세요.";return}g.value=!0,a.value="";const o=await B(r.value,m.value);o.success?(a.value="인증 이메일이 재전송되었습니다. 이메일을 확인해주세요.",b.value=!1):a.value=o.error||"이메일 재전송에 실패했습니다.",g.value=!1};return ee({title:"로그인 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(o,e)=>{const V=v("v-text-field"),y=v("v-checkbox"),h=v("v-alert"),l=v("v-btn"),p=v("v-form"),w=X,E=J,H=G,W=v("v-app");return L(),M(W,null,{default:d(()=>[n(H,null,{default:d(()=>[e[10]||(e[10]=s("div",{class:"text-center mb-8"},[s("h1",{class:"login-title mb-2"}," CNX Library "),s("p",{class:"login-subtitle"}," 로그인하여 시작하세요 ")],-1)),n(p,{ref_key:"loginForm",ref:R,"validate-on":"submit",onSubmit:N(U,["prevent"])},{default:d(()=>[n(V,{modelValue:t(r),"onUpdate:modelValue":e[0]||(e[0]=u=>C(r)?r.value=u:null),label:"이메일",type:"email","prepend-inner-icon":"mdi-email-outline",variant:"outlined",rules:D,disabled:t(c),class:"mb-2",density:"comfortable"},null,8,["modelValue","disabled"]),n(V,{modelValue:t(m),"onUpdate:modelValue":e[1]||(e[1]=u=>C(m)?m.value=u:null),label:"비밀번호",type:t(_)?"text":"password","prepend-inner-icon":"mdi-lock-outline","append-inner-icon":t(_)?"mdi-eye-off-outline":"mdi-eye-outline",variant:"outlined",rules:F,disabled:t(c),class:"mb-2",density:"comfortable","onClick:appendInner":e[2]||(e[2]=u=>_.value=!t(_))},null,8,["modelValue","type","append-inner-icon","disabled"]),s("div",te,[n(y,{modelValue:t(f),"onUpdate:modelValue":e[3]||(e[3]=u=>C(f)?f.value=u:null),label:"자동로그인",color:"primary","hide-details":"",disabled:t(c),density:"compact"},null,8,["modelValue","disabled"])]),t(a)?(L(),M(h,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert mb-4","onClick:close":e[4]||(e[4]=u=>a.value="")},{default:d(()=>[s("div",oe,[s("div",se,[x(Y(t(a))+" ",1),t(b)?(L(),q("a",{key:0,href:"#",class:Z(["resend-link",{resending:t(g)}]),disabled:t(g)||t(c),onClick:N($,["prevent"])}," 인증 이메일 재전송 ",10,ae)):P("",!0)])])]),_:1})):P("",!0),n(l,{type:"submit",block:"",size:"large",loading:t(c),disabled:t(c),class:"login-btn",elevation:"2"},{default:d(()=>[...e[5]||(e[5]=[x(" 로그인 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},512),s("div",ne,[n(w,{to:"/signup",class:"auth-link"},{default:d(()=>[...e[6]||(e[6]=[x(" 회원가입 ",-1)])]),_:1}),e[8]||(e[8]=s("span",{class:"auth-link-divider"},null,-1)),n(w,{to:"/forgot-password",class:"auth-link"},{default:d(()=>[...e[7]||(e[7]=[x(" 비밀번호찾기 ",-1)])]),_:1})]),s("div",le,[s("div",ie,[n(E),e[9]||(e[9]=s("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},fe=K(re,[["__scopeId","data-v-973dd7d5"]]);export{fe as default};
