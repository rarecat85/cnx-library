const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Bb-IZLVQ.js","./entry.DYRcaxkF.css"])))=>i.map(i=>d[i]);
import{F as ne,u as le,N as re,a as ce,D as de,r as m,o as P,e as ue,k as me,O as L,L as n,_ as U,g as r,H as c,K as i,P as o,I as s,G as p,S as T,M as _,Q as M,J as V,V as _e,W as pe,T as ve,R as fe}from"./Bb-IZLVQ.js";import{u as ge,_ as he}from"./Bi71xubJ.js";import{_ as ye}from"./BXLUrFre.js";import{u as we}from"./DU0bEG_V.js";import{u as ke}from"./D0YV89OB.js";import"./D8OVkwJr.js";const be={class:"notifications-page"},Ne={class:"page-header mb-4"},De={class:"email-notification-setting mb-6"},Ve={class:"setting-content"},Ce={class:"setting-info"},xe={class:"filter-section mb-4"},Re={key:0,class:"text-center py-8"},Ae={key:1,class:"empty-state"},Ee={class:"empty-text"},ze={key:2,class:"notification-list"},Le=["onClick"],Te={class:"notification-icon"},Me={class:"notification-content"},Se={class:"notification-title"},Fe={class:"notification-message"},Be={class:"notification-time"},Ie={class:"notification-actions"},Pe={key:3,class:"load-more-section"},Ue={class:"drawer-content"},We={__name:"notifications",setup($e){const w=le(),{user:k}=we(),{alert:S}=re(),{$firebaseFirestore:W}=ce(),b=W,{notifications:F,unreadCount:C,loading:$,markAsRead:O,markAllAsRead:q,deleteNotification:H,getNotifications:G,getNotificationIcon:J,getNotificationColor:K,formatNotificationTime:Q}=ge(),v=de("navigationDrawer",()=>!1),B=m(280),f=m("all"),N=m(!1),x=m(!0),I=m(null),g=m(!1),R=m(!1),X=async()=>{if(!(!k.value||!b))try{const{doc:t,getDoc:e}=await U(async()=>{const{doc:u,getDoc:h}=await import("./Bb-IZLVQ.js").then(y=>y.aF);return{doc:u,getDoc:h}},__vite__mapDeps([0,1]),import.meta.url),d=t(b,"users",k.value.uid),l=await e(d);if(l.exists()){const u=l.data();g.value=u.emailNotification===!0}}catch(t){console.error("이메일 알림 설정 로드 오류:",t)}},j=async t=>{if(!(!k.value||!b))try{R.value=!0;const{doc:e,updateDoc:d,serverTimestamp:l}=await U(async()=>{const{doc:y,updateDoc:A,serverTimestamp:E}=await import("./Bb-IZLVQ.js").then(z=>z.aF);return{doc:y,updateDoc:A,serverTimestamp:E}},__vite__mapDeps([0,1]),import.meta.url),u=e(b,"users",k.value.uid);await d(u,{emailNotification:t,updatedAt:l()}),await S(t?"이메일 알림이 활성화되었습니다.":"이메일 알림이 비활성화되었습니다.",{type:"success"})}catch(e){console.error("이메일 알림 설정 변경 오류:",e),g.value=!t,await S("설정 변경에 실패했습니다.",{type:"error"})}finally{R.value=!1}};P(()=>{X()}),P(()=>{const t=()=>{B.value=window.innerWidth>=769?360:280};t(),window.addEventListener("resize",t),ue(()=>{window.removeEventListener("resize",t)})});const D=me(()=>f.value==="unread"?F.value.filter(t=>!t.isRead):F.value),Y=async t=>{switch(t.isRead||await O(t.id),t.type){case"book_request":w.push("/admin/books/register");break;case"rent_request":case"overdue_admin":w.push("/admin/books");break;case"book_registered":w.push("/books");break;case"return_reminder":case"overdue":w.push("/mypage");break}},Z=async()=>{await q()},ee=async t=>{await H(t)},te=async()=>{if(!(N.value||!x.value))try{N.value=!0;const t=await G(20,I.value);t.items.length<20&&(x.value=!1),I.value=t.lastDoc}catch(t){console.error("알림 더 불러오기 오류:",t)}finally{N.value=!1}};return ke({title:"알림 - CNX Library",meta:[{name:"description",content:"알림 목록"}]}),(t,e)=>{const d=r("v-btn"),l=r("v-icon"),u=r("v-switch"),h=r("v-chip"),y=r("v-badge"),A=r("v-chip-group"),E=r("v-progress-circular"),z=he,oe=ye,se=r("v-navigation-drawer"),ae=r("v-app");return c(),L(ae,null,{default:n(()=>[i(z,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:e[2]||(e[2]=a=>v.value=!o(v))},{default:n(()=>[s("div",be,[s("div",Ne,[e[5]||(e[5]=s("h1",{class:"page-title mb-0"}," 알림 ",-1)),o(C)>0?(c(),L(d,{key:0,variant:"text",size:"small",class:"mark-all-btn",onClick:Z},{default:n(()=>[...e[4]||(e[4]=[_(" 모두 읽음 ",-1)])]),_:1})):T("",!0)]),s("div",De,[s("div",Ve,[s("div",Ce,[i(l,{size:"20",class:"setting-icon"},{default:n(()=>[...e[6]||(e[6]=[_(" mdi-email-outline ",-1)])]),_:1}),e[7]||(e[7]=s("div",{class:"setting-text"},[s("span",{class:"setting-label"},"이메일로 알림 받기"),s("span",{class:"setting-description"},"알림을 이메일로도 받습니다")],-1))]),i(u,{modelValue:o(g),"onUpdate:modelValue":[e[0]||(e[0]=a=>M(g)?g.value=a:null),j],color:"primary","hide-details":"",density:"compact",loading:o(R)},null,8,["modelValue","loading"])])]),s("div",xe,[i(A,{modelValue:o(f),"onUpdate:modelValue":e[1]||(e[1]=a=>M(f)?f.value=a:null),mandatory:"","selected-class":"filter-chip-selected"},{default:n(()=>[i(h,{value:"all",variant:"outlined",class:"filter-chip"},{default:n(()=>[...e[8]||(e[8]=[_(" 전체 ",-1)])]),_:1}),i(h,{value:"unread",variant:"outlined",class:"filter-chip"},{default:n(()=>[e[9]||(e[9]=_(" 읽지 않음 ",-1)),o(C)>0?(c(),L(y,{key:0,content:o(C),inline:"",color:"error",class:"ml-1"},null,8,["content"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])]),o($)&&o(D).length===0?(c(),p("div",Re,[i(E,{indeterminate:"",color:"primary"})])):o(D).length===0?(c(),p("div",Ae,[i(l,{size:"64",color:"grey-lighten-1"},{default:n(()=>[...e[10]||(e[10]=[_(" mdi-bell-off-outline ",-1)])]),_:1}),s("p",Ee,V(o(f)==="unread"?"읽지 않은 알림이 없습니다":"알림이 없습니다"),1)])):(c(),p("div",ze,[(c(!0),p(_e,null,pe(o(D),a=>(c(),p("div",{key:a.id,class:ve(["notification-card",{"notification-unread":!a.isRead}]),onClick:ie=>Y(a)},[s("div",Te,[i(l,{icon:o(J)(a.type),color:o(K)(a.type),size:"28"},null,8,["icon","color"])]),s("div",Me,[s("div",Se,V(a.title),1),s("div",Fe,V(a.message),1),s("div",Be,V(o(Q)(a.createdAt)),1)]),s("div",Ie,[i(d,{icon:"",variant:"text",size:"small",onClick:fe(ie=>ee(a.id),["stop"])},{default:n(()=>[i(l,{size:"20"},{default:n(()=>[...e[11]||(e[11]=[_(" mdi-close ",-1)])]),_:1})]),_:1},8,["onClick"])])],10,Le))),128))])),o(x)&&o(D).length>0?(c(),p("div",Pe,[i(d,{variant:"outlined",color:"primary",loading:o(N),onClick:te},{default:n(()=>[...e[12]||(e[12]=[_(" 더 보기 ",-1)])]),_:1},8,["loading"])])):T("",!0)])]),_:1}),i(se,{modelValue:o(v),"onUpdate:modelValue":e[3]||(e[3]=a=>M(v)?v.value=a:null),location:"right",temporary:"",width:o(B),class:"side-navigation"},{default:n(()=>[s("div",Ue,[i(oe)])]),_:1},8,["modelValue","width"])]),_:1})}}},Qe=ne(We,[["__scopeId","data-v-720a3338"]]);export{Qe as default};
