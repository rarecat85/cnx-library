import{h as se,_ as le}from"./DLpPUGWo.js";import{F as ie,r as p,k as b,g as B,G as l,H as s,K as d,L as r,U as m,I as f,P as a,O as w,M as n,J as u,W as g,T as C,R as M,Q as re}from"./DTWtb0Lw.js";import{f as E,a as de}from"./CKGa_ErN.js";const ue={key:0,class:"book-card-header"},ce={class:"book-card-inner"},be={class:"book-image-wrapper"},me={key:1,class:"book-image-placeholder"},fe={class:"book-card-content"},ye={class:"book-title mb-2"},ke={key:0,class:"book-info text-body-2 mb-1"},ge={key:1,class:"book-info book-info-publisher text-body-2"},ve={key:2,class:"book-location text-body-2"},Re={class:"location-text"},qe={key:3,class:"book-quantity text-body-2"},we={key:4,class:"book-label-number text-body-2"},xe={key:5,class:"book-center text-body-2"},Be={key:1,class:"book-action-area book-action-area-admin"},he={class:"admin-info-text text-body-2"},De={key:2,class:"book-action-area"},Se={key:3,class:"book-action-area book-action-area-admin"},Ce={class:"admin-info-text text-body-2"},ze={key:4,class:"book-action-area book-action-area-mypage"},Ie={key:5,class:"book-action-area book-action-area-mypage"},Ne={class:"requested-date-text text-body-2"},Le={key:6,class:"book-action-area book-action-area-mypage"},Me={class:"requested-date-text text-body-2"},Ae={key:7,class:"book-action-area"},$e={key:0,class:"rented-notify-section"},Oe={key:1,class:"subscribed-text text-body-2"},Te={key:1,class:"rented-text text-body-2"},Ve={key:2,class:"requested-status-text text-body-2"},Fe={key:0,class:"registered-text text-body-2"},Pe={class:"registered-text text-body-2"},je={key:2,class:"requested-text text-body-2"},pe={key:0,class:"admin-info-text text-body-2 requested-badge"},Ee={key:1,class:"admin-info-text text-body-2"},Qe={__name:"BookCard",props:{book:{type:Object,required:!0},center:{type:String,required:!0},registeredBooks:{type:Array,default:()=>[]},isRegistered:{type:Boolean,default:!1},showAction:{type:Boolean,default:!0},selectable:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},status:{type:String,default:null},showStatusFlags:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},actionButtonText:{type:String,default:""},registeredMessage:{type:String,default:""},requestedBooks:{type:Array,default:()=>[]},requestedMessage:{type:String,default:""},hideOverdueStatus:{type:Boolean,default:!1},showReturnDate:{type:Boolean,default:!1},returnDate:{type:[Date,Object,String],default:null},showRentButton:{type:Boolean,default:!1},showReturnNotifyButton:{type:Boolean,default:!1},isSubscribedToReturn:{type:Boolean,default:!1},returnNotifyLoading:{type:Boolean,default:!1},renterInfo:{type:String,default:""},requesterInfo:{type:String,default:""},showAdminRentButton:{type:Boolean,default:!1},showAdminReturnButton:{type:Boolean,default:!1},allowRegisterRequested:{type:Boolean,default:!1},allowAdditionalRegister:{type:Boolean,default:!1},showLocation:{type:Boolean,default:!1},location:{type:String,default:""},locations:{type:Array,default:()=>[]},showQuantity:{type:Boolean,default:!1},availableCount:{type:Number,default:0},totalCount:{type:Number,default:0},showLabelNumber:{type:Boolean,default:!1},labelNumber:{type:String,default:""},locationPopupMode:{type:String,default:"rent"},showRequestedInfo:{type:Boolean,default:!1},requestedDate:{type:[Date,Object,String],default:null},cancelLoading:{type:Boolean,default:!1},showRentRequestInfo:{type:Boolean,default:!1},rentRequestDate:{type:[Date,Object,String],default:null},cancelRentRequestLoading:{type:Boolean,default:!1},showCenter:{type:Boolean,default:!1},showRipple:{type:Boolean,default:!0}},emits:["register","select","return","rent","adminRent","adminReturn","locationClick","cancelRequest","cancelRentRequest","subscribeReturnNotify"],setup(t,{emit:Q}){const o=t,v=Q,h=p(!1),W=b(()=>!!(o.book.cover||o.book.image)),Y=b(()=>o.book.cover||o.book.image||""),A=b(()=>o.location?E(o.location):o.locations&&o.locations.length>0?de(o.locations):o.book.location?E(o.book.location):""),z=b(()=>o.location?o.location:o.locations&&o.locations.length>0?o.locations[0]:o.book.location?o.book.location:""),$=b(()=>se(o.center)),G=()=>{$.value&&z.value&&(h.value=!0,v("locationClick",{center:o.center,location:z.value}))},D=b(()=>{if(o.isRegistered)return!0;const i=o.book.isbn13||o.book.isbn||"";return i?o.registeredBooks.some(e=>{const y=e.isbn13||e.isbn||e.id||"",k=i.toString().trim(),c=y.toString().trim();return k===c&&e.center===o.center}):!1}),I=b(()=>{const i=o.book.isbn13||o.book.isbn||"";return i?o.requestedBooks.some(e=>{const y=e.isbn13||e.isbn||"",k=i.toString().trim(),c=y.toString().trim();return k===c&&e.center===o.center}):!1}),q=p(!1),O=async()=>{if(!q.value)try{q.value=!0,v("register",o.book)}finally{setTimeout(()=>{q.value=!1},1e3)}},T=b(()=>(o.location||o.book?.location)==="구매칸"),x=b(()=>o.status?o.status:null),N=b(()=>{const i=x.value;return o.hideOverdueStatus&&i==="overdue"?"대여중":{new:"NEW",rented:"대여중",overdue:"연체중",requested:"대여신청"}[i]||""}),U=b(()=>{const i=x.value;return o.hideOverdueStatus&&i==="overdue"?"info":{new:"primary",rented:"info",overdue:"error",requested:"warning"}[i]||"primary"}),S=b(()=>x.value==="rented"||x.value==="overdue"),L=b(()=>x.value==="requested"),H=()=>{o.selectable&&!o.disabled&&v("select",o.book,!o.selected)},J=()=>{v("return",o.book)},K=()=>{v("rent",o.book)},V=()=>{v("adminRent",o.book)},X=()=>{v("adminReturn",o.book)},F=b(()=>{if(!o.returnDate)return"";const i=o.returnDate?.toDate?.()||new Date(o.returnDate),e=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0");return`${e}.${y}.${k}`}),P=b(()=>o.returnDate?(o.returnDate?.toDate?.()||new Date(o.returnDate))<new Date:!1),Z=b(()=>{if(!o.requestedDate)return"";const i=o.requestedDate?.toDate?.()||new Date(o.requestedDate),e=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0");return`${e}.${y}.${k}`}),_=()=>{v("cancelRequest",o.book)},ee=()=>{v("cancelRentRequest",o.book)},te=()=>{v("subscribeReturnNotify",o.book)},oe=b(()=>{if(!o.rentRequestDate)return"";const i=o.rentRequestDate?.toDate?.()||new Date(o.rentRequestDate),e=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0");return`${e}.${y}.${k} 신청`});return(i,e)=>{const y=B("v-chip"),k=B("v-img"),c=B("v-icon"),R=B("v-btn"),ne=B("v-card"),ae=le;return s(),l(M,null,[d(ne,{class:C(["book-card",{"book-card-selected":t.selectable&&t.selected,"book-card-disabled":t.disabled}]),elevation:"0",ripple:!t.disabled&&t.showRipple,onClick:e[0]||(e[0]=j=>!t.disabled&&t.selectable?H():null)},{default:r(()=>[t.showStatusFlags&&(a(N)||a(T))?(s(),l("div",ue,[a(T)?(s(),w(y,{key:0,color:"primary",size:"x-small",variant:"flat",class:"status-chip"},{default:r(()=>[...e[2]||(e[2]=[n(" NEW ",-1)])]),_:1})):m("",!0),a(N)?(s(),w(y,{key:1,color:a(U),size:"x-small",variant:"flat",class:"status-chip"},{default:r(()=>[n(u(a(N)),1)]),_:1},8,["color"])):m("",!0)])):m("",!0),f("div",ce,[f("div",be,[a(W)?(s(),w(k,{key:0,src:a(Y),alt:t.book.title,height:"100%",cover:"",class:"book-image"},null,8,["src","alt"])):(s(),l("div",me,[...e[3]||(e[3]=[f("span",null,"No Image",-1)])]))]),f("div",fe,[f("div",ye,u(t.book.title),1),t.book.author?(s(),l("div",ke,[e[4]||(e[4]=f("strong",null,"저자:",-1)),n(" "+u(t.book.author),1)])):m("",!0),t.book.publisher?(s(),l("div",ge,[e[5]||(e[5]=f("strong",null,"출판사:",-1)),n(" "+u(t.book.publisher),1)])):m("",!0),t.showLocation&&a(A)?(s(),l("div",ve,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[6]||(e[6]=[n(" mdi-map-marker ",-1)])]),_:1}),f("span",Re,u(a(A)),1),a($)?(s(),w(c,{key:0,size:"small",class:"ml-1 location-info-icon clickable",onClick:g(G,["stop"])},{default:r(()=>[...e[7]||(e[7]=[n(" mdi-information-outline ",-1)])]),_:1})):m("",!0)])):m("",!0),t.showQuantity&&t.totalCount>0?(s(),l("div",qe,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[8]||(e[8]=[n(" mdi-book-multiple ",-1)])]),_:1}),n(" 대여가능 "+u(t.availableCount)+"권 / 총 "+u(t.totalCount)+"권 ",1)])):m("",!0),t.showLabelNumber&&t.labelNumber?(s(),l("div",we,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[9]||(e[9]=[n(" mdi-label ",-1)])]),_:1}),n(" "+u(t.labelNumber),1)])):m("",!0),t.showCenter&&t.center?(s(),l("div",xe,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[10]||(e[10]=[n(" mdi-map-marker-radius ",-1)])]),_:1}),n(" "+u(t.center),1)])):m("",!0)])]),t.showAdminRentButton&&a(L)&&t.requesterInfo?(s(),l("div",Be,[f("div",he,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[11]||(e[11]=[n(" mdi-account-clock ",-1)])]),_:1}),n(" "+u(t.requesterInfo),1)]),d(R,{color:"primary",size:"small",class:"admin-rent-btn mt-2",onClick:g(V,["stop"])},{default:r(()=>[...e[12]||(e[12]=[n(" 대여 처리 ",-1)])]),_:1})])):t.showAdminRentButton&&!a(S)&&!a(L)?(s(),l("div",De,[d(R,{color:"primary",size:"small",class:"admin-rent-btn",onClick:g(V,["stop"])},{default:r(()=>[...e[13]||(e[13]=[n(" 대여 처리 ",-1)])]),_:1})])):t.renterInfo&&a(S)?(s(),l("div",Se,[f("div",Ce,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[14]||(e[14]=[n(" mdi-account ",-1)])]),_:1}),n(" "+u(t.renterInfo),1)]),t.returnDate?(s(),l("div",{key:0,class:C(["return-date-text text-body-2",{"return-date-overdue":a(P)}])},[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[15]||(e[15]=[n(" mdi-calendar-clock ",-1)])]),_:1}),n(" 반납예정일: "+u(a(F)),1)],2)):m("",!0),t.showAdminReturnButton?(s(),w(R,{key:1,color:"primary",size:"small",class:"admin-return-btn mt-2",onClick:g(X,["stop"])},{default:r(()=>[...e[16]||(e[16]=[n(" 반납 처리 ",-1)])]),_:1})):m("",!0)])):m("",!0),t.showReturnDate&&t.returnDate?(s(),l("div",ze,[d(R,{color:"primary",size:"small",class:"return-btn",onClick:g(J,["stop"])},{default:r(()=>[...e[17]||(e[17]=[n(" 반납하기 ",-1)])]),_:1}),f("div",{class:C(["return-date-text text-body-2",{"return-date-overdue":a(P)}])},[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[18]||(e[18]=[n(" mdi-calendar-clock ",-1)])]),_:1}),n(" 반납예정일: "+u(a(F)),1)],2)])):t.showRequestedInfo&&t.requestedDate?(s(),l("div",Ie,[d(R,{color:"error",variant:"outlined",size:"small",class:"cancel-request-btn",loading:t.cancelLoading,onClick:g(_,["stop"])},{default:r(()=>[...e[19]||(e[19]=[n(" 신청 취소 ",-1)])]),_:1},8,["loading"]),f("div",Ne,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[20]||(e[20]=[n(" mdi-clock-outline ",-1)])]),_:1}),n(" 신청일: "+u(a(Z)),1)])])):t.showRentRequestInfo&&t.rentRequestDate?(s(),l("div",Le,[d(R,{color:"error",variant:"outlined",size:"small",class:"cancel-request-btn",loading:t.cancelRentRequestLoading,onClick:g(ee,["stop"])},{default:r(()=>[...e[21]||(e[21]=[n(" 대여 신청 취소 ",-1)])]),_:1},8,["loading"]),f("div",Me,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[22]||(e[22]=[n(" mdi-clock-outline ",-1)])]),_:1}),n(" "+u(a(oe)),1)])])):t.showRentButton?(s(),l("div",Ae,[a(S)&&t.showReturnNotifyButton?(s(),l("div",$e,[e[24]||(e[24]=f("div",{class:"rented-text text-body-2 mb-1"}," 대여중인 도서입니다. ",-1)),t.isSubscribedToReturn?(s(),l("div",Oe," 반납 알림 신청됨 ")):(s(),w(R,{key:0,color:"primary",variant:"outlined",size:"small",class:"return-notify-btn",loading:t.returnNotifyLoading,onClick:g(te,["stop"])},{default:r(()=>[...e[23]||(e[23]=[n(" 반납알림받기 ",-1)])]),_:1},8,["loading"]))])):a(S)?(s(),l("div",Te," 대여중인 도서입니다. ")):a(L)?(s(),l("div",Ve," 신청중인 도서입니다. ")):(s(),w(R,{key:3,color:"primary",size:"small",class:"rent-btn",onClick:g(K,["stop"])},{default:r(()=>[...e[25]||(e[25]=[n(" 대여 신청 ",-1)])]),_:1}))])):t.showAction?(s(),l("div",{key:8,class:C(["book-action-area",{"book-action-area-admin":(t.requesterInfo||a(I)&&t.allowRegisterRequested)&&!a(D),"book-action-area-column":a(D)&&t.allowAdditionalRegister}])},[a(D)&&!t.allowAdditionalRegister?(s(),l("div",Fe,u(t.registeredMessage||`${t.center}에 등록된 도서입니다.`),1)):a(D)&&t.allowAdditionalRegister?(s(),l(M,{key:1},[f("div",Pe,u(t.registeredMessage||`${t.center}에 등록된 도서입니다.`),1),d(R,{color:"secondary",size:"small",variant:"outlined",loading:a(q),disabled:a(q),class:"register-btn",onClick:g(O,["stop"])},{default:r(()=>[...e[26]||(e[26]=[n(" 추가 등록 ",-1)])]),_:1},8,["loading","disabled"])],64)):a(I)&&!t.allowRegisterRequested?(s(),l("div",je,u(t.requestedMessage||`${t.center}에 이미 신청된 도서입니다.`),1)):(s(),l(M,{key:3},[a(I)&&t.allowRegisterRequested?(s(),l("div",pe,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[27]||(e[27]=[n(" mdi-book-clock ",-1)])]),_:1}),e[28]||(e[28]=n(" 신청된 도서 ",-1))])):t.requesterInfo?(s(),l("div",Ee,[d(c,{size:"small",class:"mr-1"},{default:r(()=>[...e[29]||(e[29]=[n(" mdi-account-clock ",-1)])]),_:1}),n(" "+u(t.requesterInfo),1)])):m("",!0),d(R,{color:"primary",size:"small",loading:a(q),disabled:a(q),class:"register-btn",onClick:g(O,["stop"])},{default:r(()=>[n(u(t.actionButtonText||`${t.center}에 등록하기`),1)]),_:1},8,["loading","disabled"])],64))],2)):m("",!0)]),_:1},8,["class","ripple"]),d(ae,{modelValue:a(h),"onUpdate:modelValue":e[1]||(e[1]=j=>re(h)?h.value=j:null),center:t.center,location:a(z),"label-number":t.labelNumber,mode:t.locationPopupMode},null,8,["modelValue","center","location","label-number","mode"])],64)}}},Ue=ie(Qe,[["__scopeId","data-v-5cebfb1d"]]);export{Ue as _};
