const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dw84HrPm.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{a as tt,r as M,_ as f}from"./Dw84HrPm.js";import{C as U}from"./BmY9MuGI.js";const P=["경제경영","교양사상","국내소설","국내수필","마케팅","심리학","외국도서","외국소설","외국수필","외국어","인문학","자기계발","전공서적","회계학"],et={강남센터:"1",용산센터:"2"},it=(r,D,R)=>{const k=et[D]||"1",L=String(R).padStart(4,"0");return`${r}_${k}${L}`},ut=r=>{if(!r||!r.includes("_"))return null;const[D,R]=r.split("_");return!R||R.length!==5?null:{category:D,centerCode:R.charAt(0),fourDigits:R.substring(1)}},B=r=>r?r==="구매칸"||r==="기부칸"?r:`${r}번 칸`:"",mt=r=>{if(!r||r.length===0)return"없음";const D=[...new Set(r)];return D.length===1?B(D[0]):D.length===2?D.map(B).join(", "):`${B(D[0])} 외 ${D.length-1}곳`},dt=()=>{const{$firebaseFirestore:r,$firebaseStorage:D}=tt(),R=M(!1),k=M(null),L=async()=>{if(!r)return console.warn("Firebase가 초기화되지 않았습니다."),{items:{}};try{const{doc:t,getDoc:o}=await f(async()=>{const{doc:n,getDoc:c}=await import("./Dw84HrPm.js").then(a=>a.b2);return{doc:n,getDoc:c}},__vite__mapDeps([0,1]),import.meta.url),e=t(r,"settings","categories"),s=await o(e);return s.exists()?s.data():{items:{}}}catch(t){throw console.error("카테고리 설정 로드 오류:",t),t}},C=async t=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{doc:o,setDoc:e,serverTimestamp:s}=await f(async()=>{const{doc:c,setDoc:a,serverTimestamp:i}=await import("./Dw84HrPm.js").then(d=>d.b2);return{doc:c,setDoc:a,serverTimestamp:i}},__vite__mapDeps([0,1]),import.meta.url),n=o(r,"settings","categories");await e(n,{...t,updatedAt:s()})}catch(o){throw console.error("카테고리 설정 저장 오류:",o),o}},q=async()=>{if(!r)return[];try{const{collection:t,getDocs:o}=await f(async()=>{const{collection:c,getDocs:a}=await import("./Dw84HrPm.js").then(i=>i.b2);return{collection:c,getDocs:a}},__vite__mapDeps([0,1]),import.meta.url),e=t(r,"categories"),s=await o(e),n=[];return s.forEach(c=>{const a=c.data();a.name&&!P.includes(a.name)&&n.push({id:c.id,name:a.name,center:a.center,createdAt:a.createdAt})}),n}catch(t){return console.error("추가 카테고리 로드 오류:",t),[]}},j=async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");const e=t.trim();if(!e)throw new Error("카테고리명을 입력해주세요.");if(P.includes(e))throw new Error("기본 카테고리와 동일한 이름은 사용할 수 없습니다.");try{const{doc:s,setDoc:n,serverTimestamp:c}=await f(async()=>{const{doc:i,setDoc:d,serverTimestamp:w}=await import("./Dw84HrPm.js").then(m=>m.b2);return{doc:i,setDoc:d,serverTimestamp:w}},__vite__mapDeps([0,1]),import.meta.url);for(const i of o){const d=`${i}_${e}`,w=s(r,"categories",d);await n(w,{center:i,name:e,createdAt:c()})}const a=await L();return a.items=a.items||{},a.items[e]=o,await C(a),{success:!0}}catch(s){throw console.error("카테고리 추가 오류:",s),s}},W=async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");const e=o.trim();if(!e)throw new Error("새 카테고리명을 입력해주세요.");if(e===t)return{success:!0,updatedCount:0};try{const{collection:s,query:n,where:c,getDocs:a,doc:i,updateDoc:d,writeBatch:w,deleteDoc:m,setDoc:u,serverTimestamp:l}=await f(async()=>{const{collection:h,query:E,where:S,getDocs:$,doc:x,updateDoc:N,writeBatch:A,deleteDoc:F,setDoc:X,serverTimestamp:Y}=await import("./Dw84HrPm.js").then(Z=>Z.b2);return{collection:h,query:E,where:S,getDocs:$,doc:x,updateDoc:N,writeBatch:A,deleteDoc:F,setDoc:X,serverTimestamp:Y}},__vite__mapDeps([0,1]),import.meta.url),g=s(r,"books"),p=await a(g),_=[];p.forEach(h=>{const E=h.data();E.labelNumber&&E.labelNumber.startsWith(`${t}_`)&&_.push({id:h.id,oldLabelNumber:E.labelNumber,newLabelNumber:E.labelNumber.replace(`${t}_`,`${e}_`)})});const y=w(r);for(const h of _){const E=i(r,"books",h.id);y.update(E,{labelNumber:h.newLabelNumber,category:e})}if(await y.commit(),!P.includes(t))for(const h of U){const E=`${h}_${t}`,S=`${h}_${e}`,$=i(r,"categories",E),{getDoc:x}=await f(async()=>{const{getDoc:A}=await import("./Dw84HrPm.js").then(F=>F.b2);return{getDoc:A}},__vite__mapDeps([0,1]),import.meta.url);if((await x($)).exists()){const A=i(r,"categories",S);await u(A,{center:h,name:e,createdAt:l()}),await m($)}}const b=await L();return b.items&&b.items[t]&&(b.items[e]=b.items[t],delete b.items[t],await C(b)),{success:!0,updatedCount:_.length}}catch(s){throw console.error("카테고리명 수정 오류:",s),s}},G=async t=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");if(P.includes(t))throw new Error("기본 카테고리는 삭제할 수 없습니다.");try{const{collection:o,query:e,where:s,getDocs:n,doc:c,deleteDoc:a}=await f(async()=>{const{collection:u,query:l,where:g,getDocs:p,doc:_,deleteDoc:y}=await import("./Dw84HrPm.js").then(b=>b.b2);return{collection:u,query:l,where:g,getDocs:p,doc:_,deleteDoc:y}},__vite__mapDeps([0,1]),import.meta.url),i=o(r,"books"),d=await n(i);let w=!1;if(d.forEach(u=>{const l=u.data();l.labelNumber&&l.labelNumber.startsWith(`${t}_`)&&(w=!0)}),w)throw new Error("해당 카테고리에 등록된 도서가 있어 삭제할 수 없습니다.");for(const u of U){const l=`${u}_${t}`,g=c(r,"categories",l);await a(g)}const m=await L();return m.items&&m.items[t]&&(delete m.items[t],await C(m)),{success:!0}}catch(o){throw console.error("카테고리 삭제 오류:",o),o}},z=async t=>{if(!r)return 0;try{const{collection:o,getDocs:e}=await f(async()=>{const{collection:a,getDocs:i}=await import("./Dw84HrPm.js").then(d=>d.b2);return{collection:a,getDocs:i}},__vite__mapDeps([0,1]),import.meta.url),s=o(r,"books"),n=await e(s);let c=0;return n.forEach(a=>{const i=a.data();i.labelNumber&&i.labelNumber.startsWith(`${t}_`)&&c++}),c}catch(o){return console.error("카테고리별 도서 수 조회 오류:",o),0}},I=async()=>{if(!r)return[];try{const{doc:t,getDoc:o}=await f(async()=>{const{doc:n,getDoc:c}=await import("./Dw84HrPm.js").then(a=>a.b2);return{doc:n,getDoc:c}},__vite__mapDeps([0,1]),import.meta.url),e=t(r,"settings","shelfImages"),s=await o(e);return s.exists()?s.data().images||[]:[]}catch(t){return console.error("서가 이미지 로드 오류:",t),[]}},H=async(t,o,e)=>{if(!D||!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{ref:s,uploadBytes:n,getDownloadURL:c}=await f(async()=>{const{ref:_,uploadBytes:y,getDownloadURL:b}=await import("./Dw84HrPm.js").then(h=>h.b3);return{ref:_,uploadBytes:y,getDownloadURL:b}},__vite__mapDeps([0,1]),import.meta.url),{doc:a,setDoc:i,serverTimestamp:d}=await f(async()=>{const{doc:_,setDoc:y,serverTimestamp:b}=await import("./Dw84HrPm.js").then(h=>h.b2);return{doc:_,setDoc:y,serverTimestamp:b}},__vite__mapDeps([0,1]),import.meta.url),w=`img_${Date.now()}`,m=`${w}_${t.name}`,u=s(D,`shelves/${m}`);await n(u,t);const l=await c(u),g=await I();g.push({id:w,name:o.trim(),url:l,fileName:m,center:e||"",createdAt:new Date().toISOString()});const p=a(r,"settings","shelfImages");return await i(p,{images:g,updatedAt:d()}),{id:w,name:o.trim(),url:l,center:e}}catch(s){throw console.error("서가 이미지 업로드 오류:",s),s}},J=async t=>{if(!D||!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{ref:o,deleteObject:e}=await f(async()=>{const{ref:u,deleteObject:l}=await import("./Dw84HrPm.js").then(g=>g.b3);return{ref:u,deleteObject:l}},__vite__mapDeps([0,1]),import.meta.url),{doc:s,setDoc:n,serverTimestamp:c}=await f(async()=>{const{doc:u,setDoc:l,serverTimestamp:g}=await import("./Dw84HrPm.js").then(p=>p.b2);return{doc:u,setDoc:l,serverTimestamp:g}},__vite__mapDeps([0,1]),import.meta.url),a=await v();for(const u in a)for(const l in a[u])if(a[u][l]===t)throw new Error("해당 이미지가 칸 매핑에 사용 중이어서 삭제할 수 없습니다.");const i=await I(),d=i.findIndex(u=>u.id===t);if(d===-1)throw new Error("이미지를 찾을 수 없습니다.");const w=i[d];if(w.fileName)try{const u=o(D,`shelves/${w.fileName}`);await e(u)}catch(u){console.warn("Storage 이미지 삭제 실패 (이미 삭제되었거나 존재하지 않음):",u)}i.splice(d,1);const m=s(r,"settings","shelfImages");return await n(m,{images:i,updatedAt:c()}),{success:!0}}catch(o){throw console.error("서가 이미지 삭제 오류:",o),o}},K=async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{doc:e,setDoc:s,serverTimestamp:n}=await f(async()=>{const{doc:d,setDoc:w,serverTimestamp:m}=await import("./Dw84HrPm.js").then(u=>u.b2);return{doc:d,setDoc:w,serverTimestamp:m}},__vite__mapDeps([0,1]),import.meta.url),c=await I(),a=c.findIndex(d=>d.id===t);if(a===-1)throw new Error("이미지를 찾을 수 없습니다.");c[a].name=o.trim();const i=e(r,"settings","shelfImages");return await s(i,{images:c,updatedAt:n()}),{success:!0}}catch(e){throw console.error("서가 이미지 이름 수정 오류:",e),e}},v=async()=>{if(!r)return{};try{const{doc:t,getDoc:o}=await f(async()=>{const{doc:n,getDoc:c}=await import("./Dw84HrPm.js").then(a=>a.b2);return{doc:n,getDoc:c}},__vite__mapDeps([0,1]),import.meta.url),e=t(r,"settings","locationMapping"),s=await o(e);if(s.exists()){const n=s.data(),{updatedAt:c,...a}=n;return a}return{}}catch(t){return console.error("칸-이미지 매핑 로드 오류:",t),{}}},V=async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{doc:e,setDoc:s,serverTimestamp:n}=await f(async()=>{const{doc:i,setDoc:d,serverTimestamp:w}=await import("./Dw84HrPm.js").then(m=>m.b2);return{doc:i,setDoc:d,serverTimestamp:w}},__vite__mapDeps([0,1]),import.meta.url),c=await v();c[t]=o;const a=e(r,"settings","locationMapping");return await s(a,{...c,updatedAt:n()}),{success:!0}}catch(e){throw console.error("칸-이미지 매핑 저장 오류:",e),e}},Q=async(t,o)=>{try{const s=(await v())[t]?.[o];return s&&(await I()).find(a=>a.id===s)?.url||null}catch(e){return console.error("칸 이미지 URL 조회 오류:",e),null}},T=async t=>{if(!r)return[];try{const{doc:o,getDoc:e}=await f(async()=>{const{doc:c,getDoc:a}=await import("./Dw84HrPm.js").then(i=>i.b2);return{doc:c,getDoc:a}},__vite__mapDeps([0,1]),import.meta.url),s=o(r,"settings","locations"),n=await e(s);return n.exists()?n.data()[t]||[]:[]}catch(o){return console.error("칸 목록 로드 오류:",o),[]}},O=async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{doc:e,getDoc:s,setDoc:n,serverTimestamp:c}=await f(async()=>{const{doc:w,getDoc:m,setDoc:u,serverTimestamp:l}=await import("./Dw84HrPm.js").then(g=>g.b2);return{doc:w,getDoc:m,setDoc:u,serverTimestamp:l}},__vite__mapDeps([0,1]),import.meta.url),a=e(r,"settings","locations"),i=await s(a),d=i.exists()?i.data():{};return await n(a,{...d,[t]:o,updatedAt:c()}),{success:!0}}catch(e){throw console.error("칸 목록 저장 오류:",e),e}};return{loading:R,error:k,loadCategorySettings:L,saveCategorySettings:C,loadAdditionalCategories:q,addCategory:j,updateCategoryName:W,deleteCategory:G,getBookCountByCategory:z,loadShelfImages:I,uploadShelfImage:H,deleteShelfImage:J,updateShelfImageName:K,loadLocationMapping:v,saveLocationMapping:V,getLocationImageUrl:Q,loadCenterLocations:T,saveCenterLocations:O,addCenterLocation:async(t,o)=>{const e=o.trim();if(!e)throw new Error("칸 이름을 입력해주세요.");const s=await T(t);if(s.find(n=>n.name===e))throw new Error("이미 존재하는 칸 이름입니다.");return s.push({id:`loc_${Date.now()}`,name:e,createdAt:new Date().toISOString()}),await O(t,s),{success:!0}},updateLocationName:async(t,o,e)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");const s=e.trim();if(!s)throw new Error("새 칸 이름을 입력해주세요.");if(o===s)return{success:!0,updatedCount:0};try{const{collection:n,getDocs:c,doc:a,writeBatch:i}=await f(async()=>{const{collection:p,getDocs:_,doc:y,writeBatch:b}=await import("./Dw84HrPm.js").then(h=>h.b2);return{collection:p,getDocs:_,doc:y,writeBatch:b}},__vite__mapDeps([0,1]),import.meta.url),d=n(r,"books"),w=await c(d),m=[];if(w.forEach(p=>{const _=p.data();_.center===t&&_.location===o&&m.push({id:p.id})}),m.length>0){const p=i(r);for(const _ of m){const y=a(r,"books",_.id);p.update(y,{location:s})}await p.commit()}const u=await T(t),l=u.findIndex(p=>p.name===o);l!==-1&&(u[l].name=s,await O(t,u));const g=await v();return g[t]&&g[t][o]&&(g[t][s]=g[t][o],delete g[t][o],await V(t,g[t])),{success:!0,updatedCount:m.length}}catch(n){throw console.error("칸 이름 변경 오류:",n),n}},deleteCenterLocation:async(t,o)=>{if(!r)throw new Error("Firebase가 초기화되지 않았습니다.");try{const{collection:e,getDocs:s}=await f(async()=>{const{collection:m,getDocs:u}=await import("./Dw84HrPm.js").then(l=>l.b2);return{collection:m,getDocs:u}},__vite__mapDeps([0,1]),import.meta.url),n=e(r,"books"),c=await s(n);let a=!1;if(c.forEach(m=>{const u=m.data();u.center===t&&u.location===o&&(a=!0)}),a)throw new Error("해당 칸에 등록된 도서가 있어 삭제할 수 없습니다.");const d=(await T(t)).filter(m=>m.name!==o);await O(t,d);const w=await v();return w[t]&&w[t][o]&&(delete w[t][o],await V(t,w[t])),{success:!0}}catch(e){throw console.error("칸 삭제 오류:",e),e}},getLocationSelectOptions:async t=>(await T(t)).map(e=>({title:e.name,value:e.name}))}};export{et as C,P as D,mt as a,it as c,B as f,ut as p,dt as u};
