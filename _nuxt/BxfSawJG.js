const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dw84HrPm.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as Y,N as Z,a as ee,r as C,o as O,e as te,_ as $,O as D,L as l,g,H as i,K as v,P as r,I as o,G as w,U as Q,$ as oe,Q as U,J as y,R as W,S as q,M as d}from"./Dw84HrPm.js";import{_ as se,g as ae}from"./BmY9MuGI.js";import{u as ne,_ as re}from"./Co5Ttkt1.js";import{c as ie}from"./C-xtXPWq.js";import{u as le}from"./DaFGRQh7.js";import"./DjMHYbGS.js";import"./Doj8Tdqm.js";const ce={class:"managers-admin-page"},de={class:"search-section mb-6"},ue={key:0,class:"search-results-section mb-8"},me={class:"section-header mb-4"},_e={class:"text-body-2 text-medium-emphasis"},ve={key:0,class:"text-center py-6"},pe={class:"user-card"},fe={class:"user-card-header"},ye={class:"user-card-content"},ge={class:"user-name"},he={class:"user-info text-body-2"},we={class:"user-info text-body-2"},xe={class:"user-card-action"},be={key:2,class:"admin-text text-body-2"},ke={key:2,class:"text-center py-6 text-medium-emphasis empty-state"},Le={class:"managers-list-section"},Ce={class:"section-header mb-4"},De={class:"text-body-2 text-medium-emphasis"},Re={key:0,class:"text-center py-8"},Ve={class:"user-card"},Ee={class:"user-card-header"},Te={class:"user-card-content"},$e={class:"user-name"},ze={class:"user-info text-body-2"},Ae={class:"user-info text-body-2"},Ie={class:"user-card-action"},Ne={key:2,class:"text-center py-8 text-medium-emphasis empty-state"},Pe={class:"drawer-content"},Be={__name:"index",setup(Se){const{confirm:P,alert:T}=Z(),{$firebaseFirestore:F}=ee(),h=F,{drawer:R,drawerWidth:B}=ne(),V=C([]),z=C(!1),x=C(""),m=C([]),A=C(!1),I=C(!1),b=C(null);O(()=>{const t=()=>{B.value=window.innerWidth>=769?360:280};t(),window.addEventListener("resize",t),te(()=>{window.removeEventListener("resize",t)})}),O(async()=>{await N()});const N=async()=>{if(h)try{z.value=!0;const{collection:t,query:e,where:p,getDocs:u}=await $(async()=>{const{collection:a,query:f,where:k,getDocs:L}=await import("./Dw84HrPm.js").then(E=>E.b2);return{collection:a,query:f,where:k,getDocs:L}},__vite__mapDeps([0,1]),import.meta.url),_=t(h,"users"),n=e(_,p("role","==","manager")),c=await u(n);V.value=c.docs.map(a=>({uid:a.id,...a.data()}))}catch(t){console.error("매니저 목록 로드 오류:",t),V.value=[]}finally{z.value=!1}},K=async()=>{if(!(!h||!x.value.trim()))try{A.value=!0,I.value=!0;const{collection:t,getDocs:e}=await $(async()=>{const{collection:n,getDocs:c}=await import("./Dw84HrPm.js").then(a=>a.b2);return{collection:n,getDocs:c}},__vite__mapDeps([0,1]),import.meta.url),p=t(h,"users"),u=await e(p),_=ie(x.value).toLowerCase().trim();m.value=u.docs.map(n=>({uid:n.id,...n.data()})).filter(n=>{const c=(n.name||"").toLowerCase(),a=(n.email||"").toLowerCase();return c.includes(_)||a.includes(_)}).slice(0,20)}catch(t){console.error("사용자 검색 오류:",t),m.value=[]}finally{A.value=!1}},H=()=>{x.value="",m.value=[],I.value=!1},G=t=>{switch(t){case"admin":return"최고관리자";case"manager":return"매니저";default:return"일반 사용자"}},J=t=>{switch(t){case"admin":return"warning";case"manager":return"primary";default:return"grey"}},X=async t=>{if(!h)return;const e=ae(t.workplace);if(await P(`"${t.name||t.email}"님을 매니저로 지정하시겠습니까?

소속 센터: ${e}`))try{b.value=t.uid;const{doc:u,updateDoc:_,serverTimestamp:n}=await $(async()=>{const{doc:f,updateDoc:k,serverTimestamp:L}=await import("./Dw84HrPm.js").then(E=>E.b2);return{doc:f,updateDoc:k,serverTimestamp:L}},__vite__mapDeps([0,1]),import.meta.url),c=u(h,"users",t.uid);await _(c,{role:"manager",center:e,updatedAt:n()});const a=m.value.findIndex(f=>f.uid===t.uid);a!==-1&&(m.value[a].role="manager",m.value[a].center=e),await N(),await T(`"${t.name||t.email}"님이 매니저로 지정되었습니다.`,{type:"success"})}catch(u){console.error("매니저 지정 오류:",u),await T("매니저 지정에 실패했습니다.",{type:"error"})}finally{b.value=null}},S=async t=>{if(!(!h||!await P(`"${t.name||t.email}"님의 매니저 권한을 해제하시겠습니까?`)))try{b.value=t.uid;const{doc:p,updateDoc:u,serverTimestamp:_}=await $(async()=>{const{doc:a,updateDoc:f,serverTimestamp:k}=await import("./Dw84HrPm.js").then(L=>L.b2);return{doc:a,updateDoc:f,serverTimestamp:k}},__vite__mapDeps([0,1]),import.meta.url),n=p(h,"users",t.uid);await u(n,{role:"user",updatedAt:_()});const c=m.value.findIndex(a=>a.uid===t.uid);c!==-1&&(m.value[c].role="user"),await N(),await T(`"${t.name||t.email}"님의 매니저 권한이 해제되었습니다.`,{type:"success"})}catch(p){console.error("매니저 해제 오류:",p),await T("매니저 해제에 실패했습니다.",{type:"error"})}finally{b.value=null}};return le({title:"매니저 관리 - CNX Library",meta:[{name:"description",content:"매니저 지정 및 관리"}]}),(t,e)=>{const p=g("v-text-field"),u=g("v-progress-circular"),_=g("v-chip"),n=g("v-btn"),c=g("v-col"),a=g("v-row"),f=g("v-icon"),k=se,L=re,E=g("v-navigation-drawer"),j=g("v-app");return i(),D(j,null,{default:l(()=>[v(k,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:e[1]||(e[1]=s=>R.value=!r(R))},{default:l(()=>[o("div",ce,[e[18]||(e[18]=o("div",{class:"page-header mb-6"},[o("h1",{class:"page-title mb-0"}," 매니저 관리 ")],-1)),o("div",de,[v(p,{modelValue:r(x),"onUpdate:modelValue":e[0]||(e[0]=s=>U(x)?x.value=s:null),label:"사용자 검색 (이름 또는 이메일)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"search-input",onKeyup:oe(K,["enter"]),"onClick:clear":H},null,8,["modelValue"])]),r(I)?(i(),w("div",ue,[o("div",me,[e[3]||(e[3]=o("h2",{class:"section-title"}," 검색 결과 ",-1)),o("div",_e,y(r(m).length)+"명 ",1)]),r(A)?(i(),w("div",ve,[v(u,{indeterminate:"",color:"primary"})])):r(m).length>0?(i(),D(a,{key:1,class:"users-grid"},{default:l(()=>[(i(!0),w(W,null,q(r(m),s=>(i(),D(c,{key:s.uid,cols:"12",sm:"6"},{default:l(()=>[o("div",pe,[o("div",fe,[v(_,{color:J(s.role),size:"x-small",variant:"flat",class:"role-chip"},{default:l(()=>[d(y(G(s.role)),1)]),_:2},1032,["color"])]),o("div",ye,[o("div",ge,y(s.name||"이름 없음"),1),o("div",he,[e[4]||(e[4]=o("strong",null,"이메일:",-1)),d(" "+y(s.email),1)]),o("div",we,[e[5]||(e[5]=o("strong",null,"근무지:",-1)),d(" "+y(s.workplace||"-"),1)])]),o("div",xe,[!s.role||s.role==="user"?(i(),D(n,{key:0,color:"primary",size:"small",class:"action-btn",loading:r(b)===s.uid,onClick:M=>X(s)},{default:l(()=>[...e[6]||(e[6]=[d(" 매니저 지정 ",-1)])]),_:1},8,["loading","onClick"])):s.role==="manager"?(i(),D(n,{key:1,size:"small",variant:"outlined",color:"error",class:"action-btn",loading:r(b)===s.uid,onClick:M=>S(s)},{default:l(()=>[...e[7]||(e[7]=[d(" 해제 ",-1)])]),_:1},8,["loading","onClick"])):s.role==="admin"?(i(),w("div",be," 최고관리자는 변경할 수 없습니다. ")):Q("",!0)])])]),_:2},1024))),128))]),_:1})):(i(),w("div",ke,[v(f,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>[...e[8]||(e[8]=[d(" mdi-account-search-outline ",-1)])]),_:1}),o("p",null,[e[9]||(e[9]=d("'",-1)),o("strong",null,y(r(x)),1),e[10]||(e[10]=d("'에 대한 검색 결과가 없습니다.",-1))])]))])):Q("",!0),o("div",Le,[o("div",Ce,[e[11]||(e[11]=o("h2",{class:"section-title"}," 매니저 목록 ",-1)),o("div",De," 총 "+y(r(V).length)+"명 ",1)]),r(z)?(i(),w("div",Re,[v(u,{indeterminate:"",color:"primary"})])):r(V).length>0?(i(),D(a,{key:1,class:"managers-grid"},{default:l(()=>[(i(!0),w(W,null,q(r(V),s=>(i(),D(c,{key:s.uid,cols:"12",sm:"6"},{default:l(()=>[o("div",Ve,[o("div",Ee,[v(_,{color:"primary",size:"x-small",variant:"flat",class:"role-chip"},{default:l(()=>[...e[12]||(e[12]=[d(" 매니저 ",-1)])]),_:1})]),o("div",Te,[o("div",$e,y(s.name||"이름 없음"),1),o("div",ze,[e[13]||(e[13]=o("strong",null,"이메일:",-1)),d(" "+y(s.email),1)]),o("div",Ae,[e[14]||(e[14]=o("strong",null,"근무지:",-1)),d(" "+y(s.workplace||"-"),1)])]),o("div",Ie,[v(n,{size:"small",variant:"outlined",color:"error",class:"action-btn",loading:r(b)===s.uid,onClick:M=>S(s)},{default:l(()=>[...e[15]||(e[15]=[d(" 해제 ",-1)])]),_:1},8,["loading","onClick"])])])]),_:2},1024))),128))]),_:1})):(i(),w("div",Ne,[v(f,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>[...e[16]||(e[16]=[d(" mdi-account-off-outline ",-1)])]),_:1}),e[17]||(e[17]=o("p",null,"등록된 매니저가 없습니다.",-1))]))])])]),_:1}),v(E,{modelValue:r(R),"onUpdate:modelValue":e[2]||(e[2]=s=>U(R)?R.value=s:null),location:"right",temporary:"",width:r(B),class:"side-navigation"},{default:l(()=>[o("div",Pe,[v(L)])]),_:1},8,["modelValue","width"])]),_:1})}}},Ke=Y(Be,[["__scopeId","data-v-060727e3"]]);export{Ke as default};
