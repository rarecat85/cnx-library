import{_ as ee,a as se}from"./D8qTLWOZ.js";import{F as te,u as oe,$ as re,r,o as le,O as R,L as a,g as m,H as c,K as n,I as o,G as z,P as s,M as i,J as y,T as N,U as ae,S as ne,Q as S}from"./CvDJqPe-.js";import{u as ie}from"./BcFuV-z-.js";import{u as ue}from"./Dbt3lYbw.js";const ce={key:0,class:"text-center py-8"},de={key:1,class:"text-center"},pe={class:"success-text mb-6"},me={key:2,class:"text-center"},ve={class:"error-text mb-6"},fe={key:0,class:"mb-6"},be={class:"logo-bottom text-center mt-6"},ye={class:"logo-with-credit"},_e={__name:"reset-password",setup(ge){const{verifyPasswordResetToken:U,confirmPasswordReset:E,loading:_,user:H}=ie(),T=oe(),g=re(),f=r(""),h=r(""),l=r(!0),L=r(!1),d=r(!1),p=r(""),k=r(""),F=r(),w=r(!1),x=r(!1),b=r(!1),u=r(!1),C=g.query.token,P=g.query.uid,I=g.query.mode,M=g.query.oobCode,W=[t=>!!t||"비밀번호를 입력해주세요",t=>t&&t.length>=6||"비밀번호는 6자 이상이어야 합니다"],X=[t=>!!t||"비밀번호 확인을 입력해주세요",t=>t===f.value||"비밀번호가 일치하지 않습니다"];le(async()=>{if(b.value=!!H.value,C&&P){await A();return}if(I&&M){await D();return}d.value=!0,p.value="잘못된 재설정 링크입니다.",u.value=!0,l.value=!1});const A=async()=>{try{const t=await U(C,P);t.success||(d.value=!0,p.value=t.error||"유효하지 않은 재설정 링크입니다.",u.value=t.errorType==="invalid_token"||t.errorType==="expired_token"),l.value=!1}catch(t){console.error("토큰 검증 오류:",t),d.value=!0,p.value="재설정 링크 검증 중 오류가 발생했습니다.",u.value=!0,l.value=!1}},D=async()=>{if(I!=="resetPassword"){d.value=!0,p.value="지원하지 않는 재설정 모드입니다.",l.value=!1;return}l.value=!1},G=async()=>{k.value="";const{valid:t}=await F.value.validate();if(t)try{l.value=!0;let e;C&&P?e=await E(C,P,f.value):M?e={success:!1,error:"이 링크는 더 이상 유효하지 않습니다. 새로운 비밀번호 재설정을 요청해주세요."}:e={success:!1,error:"재설정 정보가 없습니다."},e.success?(L.value=!0,l.value=!1):(d.value=!0,p.value=e.error||"비밀번호 재설정에 실패했습니다.",u.value=!0,l.value=!1)}catch(e){d.value=!0,p.value=e.message||"비밀번호 재설정에 실패했습니다.",u.value=!0,l.value=!1}},q=()=>{b.value?T.push("/mypage"):T.push("/login")},J=()=>{T.push("/forgot-password")};return ue({title:"비밀번호 재설정 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(t,e)=>{const K=m("v-progress-circular"),B=m("v-icon"),V=m("v-btn"),$=m("v-text-field"),O=m("v-alert"),Q=m("v-form"),j=se,Y=ee,Z=m("v-app");return c(),R(Z,null,{default:a(()=>[n(Y,null,{default:a(()=>[e[14]||(e[14]=o("div",{class:"text-center mb-8"},[o("h1",{class:"login-title mb-2"}," CNX Library "),o("p",{class:"login-subtitle"}," 비밀번호 재설정 ")],-1)),s(l)?(c(),z("div",ce,[n(K,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[5]||(e[5]=o("p",{class:"processing-text"}," 비밀번호 재설정을 처리하는 중입니다... ",-1))])):s(L)?(c(),z("div",de,[n(B,{color:"success",size:"64",class:"mb-4"},{default:a(()=>[...e[6]||(e[6]=[i(" mdi-check-circle ",-1)])]),_:1}),e[7]||(e[7]=o("h2",{class:"success-title mb-4"}," 비밀번호가 재설정되었습니다! ",-1)),o("p",pe,y(s(b)?"비밀번호가 성공적으로 변경되었습니다.":"새로운 비밀번호로 로그인해주세요."),1),n(V,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:q},{default:a(()=>[i(y(s(b)?"마이페이지로 돌아가기":"로그인하기"),1)]),_:1})])):s(d)?(c(),z("div",me,[n(B,{color:"error",size:"64",class:"mb-4"},{default:a(()=>[...e[8]||(e[8]=[i(" mdi-alert-circle ",-1)])]),_:1}),e[11]||(e[11]=o("h2",{class:"error-title mb-4"}," 재설정에 실패했습니다 ",-1)),o("p",ve,y(s(p)),1),s(u)?(c(),z("div",fe,[...e[9]||(e[9]=[o("p",{class:"info-text mb-4"},[i(" 새로운 비밀번호 재설정 링크를 받으시려면"),o("br"),i(" 비밀번호 찾기 페이지에서 다시 요청해주세요. ")],-1)])])):N("",!0),s(u)?(c(),R(V,{key:1,block:"",size:"large",class:"login-btn mb-3",elevation:"2",onClick:J},{default:a(()=>[...e[10]||(e[10]=[i(" 비밀번호 찾기로 이동 ",-1)])]),_:1})):N("",!0),n(V,{block:"",size:"large",class:ae(s(u)?"secondary-btn":"login-btn"),elevation:"2",onClick:q},{default:a(()=>[i(y(s(b)?"마이페이지로 돌아가기":"로그인 페이지로 이동"),1)]),_:1},8,["class"])])):(c(),R(Q,{key:3,ref_key:"resetPasswordForm",ref:F,"validate-on":"submit",onSubmit:ne(G,["prevent"])},{default:a(()=>[n($,{modelValue:s(f),"onUpdate:modelValue":e[0]||(e[0]=v=>S(f)?f.value=v:null),label:"새 비밀번호",type:s(w)?"text":"password","prepend-inner-icon":"mdi-lock-outline","append-inner-icon":s(w)?"mdi-eye-off-outline":"mdi-eye-outline",variant:"outlined",rules:W,disabled:s(_),class:"mb-2",density:"comfortable","onClick:appendInner":e[1]||(e[1]=v=>w.value=!s(w))},null,8,["modelValue","type","append-inner-icon","disabled"]),n($,{modelValue:s(h),"onUpdate:modelValue":e[2]||(e[2]=v=>S(h)?h.value=v:null),label:"비밀번호 확인",type:s(x)?"text":"password","prepend-inner-icon":"mdi-lock-check-outline","append-inner-icon":s(x)?"mdi-eye-off-outline":"mdi-eye-outline",variant:"outlined",rules:X,disabled:s(_),class:"mb-2",density:"comfortable","onClick:appendInner":e[3]||(e[3]=v=>x.value=!s(x))},null,8,["modelValue","type","append-inner-icon","disabled"]),s(k)?(c(),R(O,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert mb-4","onClick:close":e[4]||(e[4]=v=>k.value="")},{default:a(()=>[i(y(s(k)),1)]),_:1})):N("",!0),n(V,{type:"submit",block:"",size:"large",loading:s(_),disabled:s(_),class:"reset-btn",elevation:"2"},{default:a(()=>[...e[12]||(e[12]=[i(" 비밀번호 재설정 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},512)),o("div",be,[o("div",ye,[n(j),e[13]||(e[13]=o("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},Pe=te(_e,[["__scopeId","data-v-8def1fea"]]);export{Pe as default};
