const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BPJYhxNG.js","./entry.DYRcaxkF.css"])))=>i.map(i=>d[i]);
import{F as K,c as Q,g as U,h as Y}from"./Cc9NgCqJ.js";import{F as Z,a as B,u as ee,$ as te,r as b,o as oe,_ as V,O as se,L as d,g as C,H as g,K as c,I as o,G as T,T as M,P as h,M as p,J as re}from"./BPJYhxNG.js";import{_ as ae,a as ne}from"./D9Ck4Lzi.js";import{u as ie}from"./DbFZYpR8.js";const le=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:K,connectFunctionsEmulator:Q,getFunctions:U,httpsCallable:Y},Symbol.toStringTag,{value:"Module"})),ce={key:0,class:"text-center py-8"},ue={key:1,class:"text-center"},de={key:2,class:"text-center"},pe={class:"error-text mb-6"},me={key:0,class:"mb-6"},fe={class:"logo-bottom text-center mt-6"},ve={class:"logo-with-credit"},_e={__name:"verify-email",setup(ye){const{$firebaseApp:S}=B(),N=ee(),k=te(),a=b(!0),E=b(!1),i=b(!1),s=b(""),l=b(!1),R=k.query.token,I=k.query.uid,w=k.query.mode,x=k.query.oobCode;oe(async()=>{if(R&&I){await $();return}if(w&&x){await X();return}i.value=!0,s.value="유효하지 않은 인증 링크입니다.",l.value=!0,a.value=!1});const $=async()=>{try{const{getFunctions:t,httpsCallable:e}=await V(async()=>{const{getFunctions:v,httpsCallable:_}=await Promise.resolve().then(()=>le);return{getFunctions:v,httpsCallable:_}},void 0,import.meta.url),m=t(S),r=await e(m,"verifyEmailToken")({token:R,uid:I});r.data.success?(E.value=!0,a.value=!1):(i.value=!0,s.value=r.data.error||"인증에 실패했습니다.",a.value=!1,(r.data.errorType==="invalid_token"||r.data.errorType==="expired_token"||r.data.errorType==="no_token")&&(l.value=!0))}catch(t){console.error("토큰 인증 오류:",t),i.value=!0,s.value="인증 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",l.value=!0,a.value=!1}},X=async()=>{if(w==="resetPassword"){await N.push({path:"/reset-password",query:{mode:w,oobCode:x}});return}if(w!=="verifyEmail"){i.value=!0,s.value="지원하지 않는 인증 모드입니다.",a.value=!1;return}try{const{applyActionCode:t,checkActionCode:e}=await V(async()=>{const{applyActionCode:n,checkActionCode:y}=await import("./BPJYhxNG.js").then(u=>u.aA);return{applyActionCode:n,checkActionCode:y}},__vite__mapDeps([0,1]),import.meta.url),{collection:m,query:f,where:r,getDocs:v,doc:_,setDoc:A,serverTimestamp:O}=await V(async()=>{const{collection:n,query:y,where:u,getDocs:D,doc:P,setDoc:W,serverTimestamp:G}=await import("./BPJYhxNG.js").then(J=>J.aB);return{collection:n,query:y,where:u,getDocs:D,doc:P,setDoc:W,serverTimestamp:G}},__vite__mapDeps([0,1]),import.meta.url),{$firebaseAuth:j,$firebaseFirestore:H}=B(),F=j,L=H;if(!F||!L)throw new Error("Firebase가 초기화되지 않았습니다.");let q=null;try{q=(await e(F,x)).data.email}catch(n){if(n.code==="auth/invalid-action-code"){i.value=!0,s.value="이미 사용되었거나 유효하지 않은 인증 링크입니다.",l.value=!0,a.value=!1;return}throw n}if(await t(F,x),q){const n=m(L,"users"),y=f(n,r("email","==",q)),u=await v(y);if(!u.empty){const D=u.docs[0],P=_(L,"users",D.id);await A(P,{emailVerified:!0,emailVerifiedAt:O(),verificationToken:null,verificationTokenCreatedAt:null,verificationTokenExpiresAt:null,updatedAt:O()},{merge:!0})}}E.value=!0,a.value=!1}catch(t){console.error("Firebase 인증 오류:",t),i.value=!0,a.value=!1,t.code==="auth/expired-action-code"?(s.value="인증 링크가 만료되었습니다. 새로운 인증 링크를 요청해주세요.",l.value=!0):t.code==="auth/invalid-action-code"?(s.value="이미 인증된 이메일이거나 유효하지 않은 인증 링크입니다.",l.value=!0):t.code==="auth/user-disabled"?s.value="비활성화된 계정입니다.":t.code==="auth/user-not-found"?s.value="사용자를 찾을 수 없습니다.":s.value=t.message||"이메일 인증에 실패했습니다."}},z=()=>{N.push("/login")};return ie({title:"이메일 인증 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(t,e)=>{const m=C("v-progress-circular"),f=C("v-icon"),r=C("v-btn"),v=ne,_=ae,A=C("v-app");return g(),se(A,null,{default:d(()=>[c(_,null,{default:d(()=>[e[10]||(e[10]=o("div",{class:"text-center mb-8"},[o("h1",{class:"login-title mb-2"}," CNX Library "),o("p",{class:"login-subtitle"}," 이메일 인증 ")],-1)),h(a)?(g(),T("div",ce,[c(m,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[0]||(e[0]=o("p",{class:"verifying-text"}," 이메일 인증을 처리하는 중입니다... ",-1))])):h(E)?(g(),T("div",ue,[c(f,{color:"success",size:"64",class:"mb-4"},{default:d(()=>[...e[1]||(e[1]=[p(" mdi-check-circle ",-1)])]),_:1}),e[3]||(e[3]=o("h2",{class:"success-title mb-4"}," 이메일 인증이 완료되었습니다! ",-1)),e[4]||(e[4]=o("p",{class:"success-text mb-6"}," 이제 로그인하여 CNX Library를 이용하실 수 있습니다. ",-1)),c(r,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:z},{default:d(()=>[...e[2]||(e[2]=[p(" 로그인하기 ",-1)])]),_:1})])):h(i)?(g(),T("div",de,[c(f,{color:"error",size:"64",class:"mb-4"},{default:d(()=>[...e[5]||(e[5]=[p(" mdi-alert-circle ",-1)])]),_:1}),e[8]||(e[8]=o("h2",{class:"error-title mb-4"}," 인증에 실패했습니다 ",-1)),o("p",pe,re(h(s)),1),h(l)?(g(),T("div",me,[...e[6]||(e[6]=[o("p",{class:"info-text mb-4"},[p(" 새로운 인증 메일을 받으시려면 로그인 페이지에서"),o("br"),p(' "인증 이메일 재전송"을 클릭해주세요. ')],-1)])])):M("",!0),c(r,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:z},{default:d(()=>[...e[7]||(e[7]=[p(" 로그인 페이지로 이동 ",-1)])]),_:1})])):M("",!0),o("div",fe,[o("div",ve,[c(v),e[9]||(e[9]=o("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},we=Z(_e,[["__scopeId","data-v-8ec1835a"]]);export{we as default};
