const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dw84HrPm.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as _e,N as ge,a as he,r,k as O,o as X,e as ye,_ as M,O as Y,L as y,g as i,H as c,K as l,P as s,I as a,G as b,U as Z,J as L,Q as z,$ as be,M as v,R as F,S as fe}from"./Dw84HrPm.js";import{_ as we}from"./Br9hWO33.js";import{_ as ke}from"./CLxtAmYj.js";import{g as qe,C as xe,_ as Be}from"./BmY9MuGI.js";import{u as De,_ as Re}from"./Co5Ttkt1.js";import{u as Ve}from"./DjMHYbGS.js";import{u as Ce}from"./2Ftor6gv.js";import{u as $e}from"./DaFGRQh7.js";import"./Bmka-bGZ.js";import"./Doj8Tdqm.js";import"./C-xtXPWq.js";const Ee={class:"books-request-page"},Le={class:"center-header mb-6"},Se={class:"center-header-inner"},Ne={class:"page-title mb-0"},Te={class:"search-section mb-6"},Pe={key:0,class:"search-loading-section mb-8"},Ie={class:"text-center py-8"},Ae={key:1,class:"search-empty-section mb-8"},Ue={class:"text-center py-8 text-medium-emphasis empty-state"},We={class:"mb-2"},Oe={key:2,class:"search-results-section mb-8"},Me={class:"search-results-header mb-4"},ze={class:"text-body-1"},Fe={key:0,class:"d-flex justify-center mt-6"},Ke={class:"drawer-content"},He={__name:"request",setup(Qe){const{user:V}=Ve(),{searchBooks:ee,getBooksByCenter:te,getBestsellers:se}=Ce(),{alert:C}=ge(),{$firebaseFirestore:oe}=he(),f=oe,{drawer:q,drawerWidth:K}=De(),H=[...xe],o=r(""),ae=r(""),_=r(""),w=r([]),x=r(10),$=r(!1),Q=r(null),S=r(!1),B=O(()=>w.value.slice(0,x.value)),re=O(()=>w.value.length),ne=O(()=>x.value<w.value.length),N=r([]),T=r(!1),E=r([]),D=r([]),P=r(new Set);X(()=>{const e=()=>{K.value=window.innerWidth>=769?360:280};e(),window.addEventListener("resize",e),ye(()=>{window.removeEventListener("resize",e)})});const le=async()=>{if(!V.value||!f)return"";try{const{doc:e,getDoc:t}=await M(async()=>{const{doc:d,getDoc:g}=await import("./Dw84HrPm.js").then(h=>h.b2);return{doc:d,getDoc:g}},__vite__mapDeps([0,1]),import.meta.url),n=e(f,"users",V.value.uid),u=await t(n);if(u.exists())return u.data().workplace||""}catch(e){console.error("사용자 근무지 정보 가져오기 오류:",e)}return""};X(async()=>{const e=await le();ae.value=e,o.value=e?qe(e):H[0],await Promise.all([j(),G(),I()])});const ie=async()=>{await Promise.all([j(),G(),I()])},ce=async()=>{if(_.value.trim())try{$.value=!0,Q.value=null,x.value=10,S.value=!0;const e=await ee(_.value);w.value=e.items||[]}catch(e){console.error("도서 검색 오류:",e),Q.value=e.message||"도서 검색에 실패했습니다.",w.value=[]}finally{$.value=!1}},ue=()=>{_.value="",w.value=[],x.value=10,S.value=!1},de=()=>{x.value+=10},j=async()=>{try{T.value=!0;const e=await se(10);N.value=e.items||[]}catch(e){console.error("베스트셀러 로드 오류:",e),N.value=[]}finally{T.value=!1}},G=async()=>{try{const e=await te(o.value);E.value=e}catch(e){console.error("등록된 도서 로드 오류:",e),E.value=[]}},I=async()=>{try{if(!f){D.value=[];return}const{collection:e,query:t,where:n,getDocs:u}=await M(async()=>{const{collection:m,query:R,where:A,getDocs:U}=await import("./Dw84HrPm.js").then(W=>W.b2);return{collection:m,query:R,where:A,getDocs:U}},__vite__mapDeps([0,1]),import.meta.url),d=e(f,"bookRequests"),g=t(d,n("center","==",o.value),n("status","==","pending")),h=await u(g),k=[];h.forEach(m=>{k.push({id:m.id,...m.data()})}),D.value=k}catch(e){console.error("신청된 도서 로드 오류:",e),D.value=[]}},J=async e=>{const t=e.isbn13||e.isbn||"";if(!t){await C("ISBN 정보가 없어 신청할 수 없습니다.",{type:"error"});return}if(!P.value.has(t))try{if(P.value.add(t),!f||!V.value){await C("로그인이 필요합니다.",{type:"warning"});return}const{collection:n,addDoc:u,serverTimestamp:d}=await M(async()=>{const{collection:h,addDoc:k,serverTimestamp:m}=await import("./Dw84HrPm.js").then(R=>R.b2);return{collection:h,addDoc:k,serverTimestamp:m}},__vite__mapDeps([0,1]),import.meta.url);await u(n(f,"bookRequests"),{isbn13:e.isbn13||"",isbn:e.isbn||"",title:e.title||"",author:e.author||"",publisher:e.publisher||"",cover:e.cover||e.image||"",description:e.description||"",pubDate:e.pubDate||"",center:o.value,status:"pending",requestedBy:V.value.uid,requestedAt:d()}),await I();const g=e.title||"도서";await C(`"${g}"이(가) ${o.value}에 신청되었습니다.

관리자 승인 후 등록됩니다.`,{type:"success"})}catch(n){console.error("도서 신청 오류:",n),await C(n.message||"도서 신청에 실패했습니다.",{type:"error"})}finally{P.value.delete(t)}};return $e({title:"도서 신청 - CNX Library",meta:[{name:"description",content:"센터별 도서 신청"}]}),(e,t)=>{const n=i("v-select"),u=i("v-text-field"),d=i("v-progress-circular"),g=i("v-icon"),h=we,k=i("v-col"),m=i("v-row"),R=i("v-btn"),A=ke,U=Be,W=Re,me=i("v-navigation-drawer"),pe=i("v-app");return c(),Y(pe,null,{default:y(()=>[l(U,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:t[2]||(t[2]=p=>q.value=!s(q))},{default:y(()=>[a("div",Ee,[a("div",Le,[a("div",Se,[a("h1",Ne,L(s(o))+" 도서 신청 ",1),l(n,{modelValue:s(o),"onUpdate:modelValue":[t[0]||(t[0]=p=>z(o)?o.value=p:null),ie],items:H,variant:"outlined",density:"comfortable","hide-details":"",class:"center-select"},null,8,["modelValue"])])]),a("div",Te,[l(u,{modelValue:s(_),"onUpdate:modelValue":t[1]||(t[1]=p=>z(_)?_.value=p:null),label:"도서 검색",placeholder:"도서명 또는 ISBN-13으로 검색","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable",loading:s($),clearable:"",class:"search-input",onKeyup:be(ce,["enter"]),"onClick:clear":ue},null,8,["modelValue","loading"])]),s($)?(c(),b("div",Pe,[a("div",Ie,[l(d,{indeterminate:"",color:"primary"}),t[4]||(t[4]=a("p",{class:"mt-4 text-medium-emphasis"}," 검색 중... ",-1))])])):s(S)&&s(B).length===0?(c(),b("div",Ae,[a("div",Ue,[l(g,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:y(()=>[...t[5]||(t[5]=[v(" mdi-book-search-outline ",-1)])]),_:1}),a("p",We,[t[6]||(t[6]=v(" '",-1)),a("strong",null,L(s(_)),1),t[7]||(t[7]=v("'에 대한 검색 결과가 없습니다. ",-1))]),t[8]||(t[8]=a("p",{class:"text-body-2"}," 다른 검색어로 시도해보세요. ",-1))])])):s(B).length>0?(c(),b("div",Oe,[a("div",Me,[a("div",ze,[s(re)>=10?(c(),b(F,{key:0},[t[9]||(t[9]=v(" 검색 결과가 많습니다. (현재 ",-1)),a("strong",null,L(s(B).length),1),t[10]||(t[10]=v("개 표시 중) ",-1))],64)):(c(),b(F,{key:1},[t[11]||(t[11]=v(" 총 ",-1)),a("strong",null,L(s(B).length),1),t[12]||(t[12]=v("개의 검색 결과 ",-1))],64))])]),l(m,{class:"book-list-row"},{default:y(()=>[(c(!0),b(F,null,fe(s(B),(p,ve)=>(c(),Y(k,{key:`search-${ve}`,cols:"12",sm:"6",class:"book-list-col"},{default:y(()=>[l(h,{book:p,center:s(o),"registered-books":s(E),"requested-books":s(D),selectable:!1,"show-action":!0,"action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,onRegister:J},null,8,["book","center","registered-books","requested-books","action-button-text","registered-message","requested-message"])]),_:2},1024))),128))]),_:1}),s(ne)?(c(),b("div",Fe,[l(R,{variant:"outlined",color:"primary",onClick:de},{default:y(()=>[...t[13]||(t[13]=[v(" 더보기 ",-1)])]),_:1})])):Z("",!0)])):Z("",!0),l(A,{books:s(N),center:s(o),"registered-books":s(E),"requested-books":s(D),title:"베스트셀러",loading:s(T),"empty-message":"베스트셀러를 불러올 수 없습니다.","action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,"nav-id":"bestseller",class:"mb-8",onRegister:J},null,8,["books","center","registered-books","requested-books","loading","action-button-text","registered-message","requested-message"])])]),_:1}),l(me,{modelValue:s(q),"onUpdate:modelValue":t[3]||(t[3]=p=>z(q)?q.value=p:null),location:"right",temporary:"",width:s(K),class:"side-navigation"},{default:y(()=>[a("div",Ke,[l(W)])]),_:1},8,["modelValue","width"])]),_:1})}}},rt=_e(He,[["__scopeId","data-v-6ed1d256"]]);export{rt as default};
