const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./820eoStb.js","./entry.DNw42TVG.css"])))=>i.map(i=>d[i]);
import{ah as de,ai as fe,aj as V,ak as me,al as z,am as ge,an as he,ao as pe,ap as we,aq as ye,ar as q,as as ve,a as Ee,u as Ae,D as R,at as Te,k as ke,a0 as J,_ as j,au as k,av as G,a1 as H,a3 as De,a5 as B,a4 as U,aw as Se}from"./820eoStb.js";const Pe="type.googleapis.com/google.protobuf.Int64Value",be="type.googleapis.com/google.protobuf.UInt64Value";function K(e,t){const r={};for(const n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function F(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>F(t));if(typeof e=="function"||typeof e=="object")return K(e,t=>F(t));throw new Error("Data cannot be encoded in JSON: "+e)}function N(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Pe:case be:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>N(t)):typeof e=="function"||typeof e=="object"?K(e,t=>N(t)):e}const M="functions";const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class E extends pe{constructor(t,r,n){super(`${M}/${t}`,r||""),this.details=n,Object.setPrototypeOf(this,E.prototype)}}function Ie(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function L(e,t){let r=Ie(e),n=r,s;try{const c=t&&t.error;if(c){const i=c.status;if(typeof i=="string"){if(!W[i])return new E("internal","internal");r=W[i],n=i}const a=c.message;typeof a=="string"&&(n=a),s=c.details,s!==void 0&&(s=N(s))}}catch{}return r==="ok"?null:new E(r,n,s)}class Ne{constructor(t,r,n,s){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,ve(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||r.get().then(c=>this.auth=c,()=>{}),this.messaging||n.get().then(c=>this.messaging=c,()=>{}),this.appCheck||s?.get().then(c=>this.appCheck=c,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const r=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return r.error?null:r.token}return null}async getContext(t){const r=await this.getAuthToken(),n=await this.getMessagingToken(),s=await this.getAppCheckToken(t);return{authToken:r,messagingToken:n,appCheckToken:s}}}const x="us-central1",Re=/^data: (.*?)(?:\n|$)/;function Ce(e){let t=null;return{promise:new Promise((r,n)=>{t=setTimeout(()=>{n(new E("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class _e{constructor(t,r,n,s,c=x,i=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new Ne(t,r,n,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(c);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=x}catch{this.customDomain=null,this.region=c}}_delete(){return this.deleteService()}_url(t){const r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${r}.cloudfunctions.net/${t}`}}function Oe(e,t,r){const n=z(t);e.emulatorOrigin=`http${n?"s":""}://${t}:${r}`,n&&(ge(e.emulatorOrigin+"/backends"),he("Functions",!0))}function Fe(e,t,r){const n=s=>Ue(e,t,s,r||{});return n.stream=(s,c)=>Ve(e,t,s,c),n}function Q(e){return e.emulatorOrigin&&z(e.emulatorOrigin)?"include":void 0}async function Le(e,t,r,n,s){r["Content-Type"]="application/json";let c;try{c=await n(e,{method:"POST",body:JSON.stringify(t),headers:r,credentials:Q(s)})}catch{return{status:0,json:null}}let i=null;try{i=await c.json()}catch{}return{status:c.status,json:i}}async function Z(e,t){const r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),n.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}function Ue(e,t,r,n){const s=e._url(t);return xe(e,s,r,n)}async function xe(e,t,r,n){r=F(r);const s={data:r},c=await Z(e,n),i=n.timeout||7e4,a=Ce(i),h=await Promise.race([Le(t,s,c,e.fetchImpl,e),a.promise,e.cancelAllRequests]);if(a.cancel(),!h)throw new E("cancelled","Firebase Functions instance was deleted.");const p=L(h.status,h.json);if(p)throw p;if(!h.json)throw new E("internal","Response is not valid JSON object.");let m=h.json.data;if(typeof m>"u"&&(m=h.json.result),typeof m>"u")throw new E("internal","Response is missing data field.");return{data:N(m)}}function Ve(e,t,r,n){const s=e._url(t);return Me(e,s,r,n||{})}async function Me(e,t,r,n){r=F(r);const s={data:r},c=await Z(e,n);c["Content-Type"]="application/json",c.Accept="text/event-stream";let i;try{i=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(s),headers:c,signal:n?.signal,credentials:Q(e)})}catch(y){if(y instanceof Error&&y.name==="AbortError"){const I=new E("cancelled","Request was cancelled.");return{data:Promise.reject(I),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(I)}}}}}}const P=L(0,null);return{data:Promise.reject(P),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(P)}}}}}}let a,h;const p=new Promise((y,P)=>{a=y,h=P});n?.signal?.addEventListener("abort",()=>{const y=new E("cancelled","Request was cancelled.");h(y)});const m=i.body.getReader(),D=$e(m,a,h,n?.signal);return{stream:{[Symbol.asyncIterator](){const y=D.getReader();return{async next(){const{value:P,done:I}=await y.read();return{value:P,done:I}},async return(){return await y.cancel(),{done:!0,value:void 0}}}}},data:p}}function $e(e,t,r,n){const s=(i,a)=>{const h=i.match(Re);if(!h)return;const p=h[1];try{const m=JSON.parse(p);if("result"in m){t(N(m.result));return}if("message"in m){a.enqueue(N(m.message));return}if("error"in m){const D=L(0,m);a.error(D),r(D);return}}catch(m){if(m instanceof E){a.error(m),r(m);return}}},c=new TextDecoder;return new ReadableStream({start(i){let a="";return h();async function h(){if(n?.aborted){const p=new E("cancelled","Request was cancelled");return i.error(p),r(p),Promise.resolve()}try{const{value:p,done:m}=await e.read();if(m){a.trim()&&s(a.trim(),i),i.close();return}if(n?.aborted){const y=new E("cancelled","Request was cancelled");i.error(y),r(y),await e.cancel();return}a+=c.decode(p,{stream:!0});const D=a.split(`
`);a=D.pop()||"";for(const y of D)y.trim()&&s(y.trim(),i);return h()}catch(p){const m=p instanceof E?p:L(0,null);i.error(m),r(m)}}},cancel(){return e.cancel()}})}const X="@firebase/functions",Y="0.13.1";const qe="auth-internal",Je="app-check-internal",je="messaging-internal";function Ge(e){const t=(r,{instanceIdentifier:n})=>{const s=r.getProvider("app").getImmediate(),c=r.getProvider(qe),i=r.getProvider(je),a=r.getProvider(Je);return new _e(s,c,i,a,n)};we(new ye(M,t,"PUBLIC").setMultipleInstances(!0)),q(X,Y,e),q(X,Y,"esm2020")}function C(e=de(),t=x){const n=fe(V(e),M).getImmediate({identifier:t}),s=me("functions");return s&&He(n,...s),n}function He(e,t,r){Oe(V(e),t,r)}function _(e,t,r){return Fe(V(e),t,r)}Ge();const Xe=()=>{const{$firebaseAuth:e,$firebaseFirestore:t,$firebaseApp:r}=Ee(),n=Ae(),s=e,c=t,i=R("firebase_user",()=>null),a=R("auth_loading",()=>!0),h=R("auth_initialized",()=>!1),p=R("is_signing_up",()=>!1);if(s){(async()=>{try{const o=s.currentUser;if(o){const{doc:d,getDoc:S}=await j(async()=>{const{doc:A,getDoc:b}=await import("./820eoStb.js").then(w=>w.aE);return{doc:A,getDoc:b}},__vite__mapDeps([0,1]),import.meta.url),v=d(t,"users",o.uid),T=await S(v);T.exists()?T.data().emailVerified===!0?(await o.reload(),i.value=o):(await k(s),i.value=null):(await k(s),i.value=null),a.value=!1}}catch(o){console.error("초기 사용자 확인 실패:",o)}})();let f=null;const g=new Promise(o=>{f=o});let u=!0;Te(s,async o=>{if(console.log("[onAuthStateChanged] 콜백 실행됨, firebaseUser:",o?.uid||"null",", isSigningUp:",p.value),p.value){console.log("[onAuthStateChanged] 회원가입 진행 중 - 스킵"),u&&f&&(u=!1,h.value=!0,f(),f=null);return}if(o){try{const{doc:d,getDoc:S}=await j(async()=>{const{doc:A,getDoc:b}=await import("./820eoStb.js").then(w=>w.aE);return{doc:A,getDoc:b}},__vite__mapDeps([0,1]),import.meta.url),v=d(t,"users",o.uid),T=await S(v);T.exists()?T.data().emailVerified===!0?i.value=o:(await k(s),i.value=null):(await k(s),i.value=null)}catch(d){console.error("사용자 인증 상태 확인 오류:",d),await k(s),i.value=null}a.value=!1}else i.value=null,a.value=!1;u&&f&&(u=!1,h.value=!0,f(),f=null)}),R("auth_state_ready",()=>g)}else s||(a.value=!1,h.value=!0);const m=async(l,f,g,u)=>{if(console.log("[회원가입] signup 함수 시작"),!s||!c)return console.error("[회원가입] Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{a.value=!0,p.value=!0,console.log("[회원가입] Firebase Auth 계정 생성 시작...");const d=(await Se(s,l,f)).user;console.log("[회원가입] Firebase Auth 계정 생성 완료:",d.uid),console.log("[회원가입] Firestore 사용자 정보 저장 시작...");try{const w=H(c,"users",d.uid),O={uid:d.uid,email:l,name:g,workplace:u,role:"user",emailVerified:!1,emailVerifiedAt:null,createdAt:U(),updatedAt:U()};console.log("[회원가입] setDoc 호출 직전, userData:",JSON.stringify({...O,createdAt:"timestamp",updatedAt:"timestamp"}));const ce=B(w,O),ue=new Promise((Be,le)=>setTimeout(()=>le(new Error("setDoc 타임아웃 (10초)")),1e4));await Promise.race([ce,ue]),console.log("[회원가입] Firestore 사용자 정보 저장 완료")}catch(w){throw console.error("[회원가입] Firestore 저장 에러:",w),console.error("[회원가입] Firestore 에러 상세:",w.code,w.message),w}console.log("[회원가입] 로그아웃 시작..."),await k(s),console.log("[회원가입] 로그아웃 완료"),console.log("[회원가입] 인증 메일 발송 시작...");const S=C(r),v=_(S,"sendSignupVerificationEmail");let T=!1,A=null;const b=new Promise((w,O)=>setTimeout(()=>{console.log("[회원가입] 타임아웃 발생!"),O(new Error("타임아웃: 인증 메일 발송 응답 없음"))},5e3));try{console.log("[회원가입] sendSignupVerificationEmail 호출 중...");const w=await Promise.race([v({uid:d.uid,email:l,name:g}),b]);console.log("[회원가입] 응답 받음:",w),w.data.success?(T=!0,console.log("[회원가입] 메일 발송 성공")):(A=w.data.error,console.error("[회원가입] 인증 메일 발송 실패:",A))}catch(w){A=w.message,console.error("[회원가입] 인증 메일 발송 오류:",w)}return console.log("[회원가입] emailSent:",T,"emailError:",A),a.value=!1,p.value=!1,T?{success:!0,user:d}:{success:!0,user:d,warning:"회원가입은 완료되었지만 인증 메일 발송에 실패했습니다. 로그인 페이지에서 인증 메일을 재전송해주세요."}}catch(o){a.value=!1,p.value=!1;let d="회원가입에 실패했습니다.";return o.code==="auth/email-already-in-use"?d="이미 사용 중인 이메일입니다.":o.code==="auth/invalid-email"?d="이메일 형식이 올바르지 않습니다.":o.code==="auth/weak-password"?d="비밀번호가 너무 약합니다.":o.code==="auth/operation-not-allowed"&&(d="이메일/비밀번호 로그인이 비활성화되어 있습니다."),{success:!1,error:d}}},D=async(l,f,g=!1)=>{if(!s||!c)return{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{const o=(await G(s,l,f)).user;await k(s);const d=C(r),v=await _(d,"resendVerificationEmail")({email:l,password:f,isReauth:g});return v.data.success?{success:!0,message:v.data.message}:{success:!1,error:v.data.error||"인증 이메일 발송에 실패했습니다."}}catch(u){let o="이메일 발송에 실패했습니다.";return u.code==="auth/invalid-credential"?o="이메일 또는 비밀번호가 올바르지 않습니다.":u.code==="auth/user-not-found"?o="등록되지 않은 이메일입니다.":u.code==="auth/wrong-password"?o="비밀번호가 올바르지 않습니다.":u.code==="auth/too-many-requests"&&(o="너무 많은 요청이 있습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:o}}},y=async()=>!s||!s.currentUser?{verified:!1}:(await s.currentUser.reload(),{verified:s.currentUser.emailVerified}),P=l=>{try{return btoa(encodeURIComponent(l))}catch{return l}},I=l=>{try{return decodeURIComponent(atob(l))}catch{return l}},ee=(l,f)=>{if(f){const g=new Date;g.setMonth(g.getMonth()+1);const u=P(l);localStorage.setItem("autoLoginEmail",u),localStorage.setItem("autoLoginExpiry",g.toISOString()),localStorage.setItem("rememberMe","true")}else localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},te=()=>{const l=localStorage.getItem("autoLoginEmail"),f=localStorage.getItem("autoLoginExpiry");if(!l||!f)return null;const g=new Date(f);return new Date>g?(localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe"),null):{email:I(l),expiry:g}},$=()=>{localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},re=async(l,f,g=!1)=>{if(!s||!c)return console.error("Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{a.value=!0;const o=(await G(s,l,f)).user,d=H(c,"users",o.uid),S=await De(d);if(!S.exists())return await k(s),i.value=null,a.value=!1,{success:!1,error:"사용자 정보를 찾을 수 없습니다. 회원가입을 다시 진행해주세요."};const v=S.data();if(v.emailVerified!==!0)return await k(s),i.value=null,a.value=!1,{success:!1,error:"이메일 인증이 완료되지 않았습니다. 이메일을 확인하여 인증을 완료해주세요."};if(v.emailVerified===!0&&v.emailVerifiedAt){const T=v.emailVerifiedAt.toDate(),A=new Date,b=new Date(A.getTime()-2160*60*60*1e3);if(T<b)return await B(d,{emailVerified:!1,updatedAt:U()},{merge:!0}),await k(s),i.value=null,a.value=!1,{success:!1,error:"이메일 재인증이 필요합니다. 마지막 인증으로부터 3개월이 지났습니다.",requiresReauth:!0}}return ee(l,g),i.value=o,a.value=!1,{success:!0,user:o}}catch(u){a.value=!1;let o="로그인에 실패했습니다.";return u.code==="auth/invalid-credential"?o="이메일 또는 비밀번호가 올바르지 않습니다.":u.code==="auth/user-not-found"?o="등록되지 않은 이메일입니다.":u.code==="auth/wrong-password"?o="비밀번호가 올바르지 않습니다.":u.code==="auth/invalid-email"?o="이메일 형식이 올바르지 않습니다.":u.code==="auth/too-many-requests"&&(o="너무 많은 시도가 있었습니다. 나중에 다시 시도해주세요."),{success:!1,error:o}}},se=async()=>{if(!s)return console.error("Firebase Auth가 초기화되지 않았습니다."),{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await k(s),i.value=null,$(),await n.push("/login"),{success:!0}}catch(l){return{success:!1,error:l.message}}},ne=async l=>{try{const f=C(r),u=await _(f,"sendPasswordResetEmail")({email:l});return u.data.success?{success:!0,message:u.data.message}:{success:!1,error:u.data.error||"이메일 발송에 실패했습니다."}}catch(f){return console.error("비밀번호 재설정 이메일 발송 오류:",f),{success:!1,error:"이메일 발송에 실패했습니다."}}},ae=async(l,f)=>{try{const g=C(r),o=await _(g,"verifyPasswordResetToken")({token:l,uid:f});return o.data.success?{success:!0,email:o.data.email}:{success:!1,error:o.data.error||"유효하지 않은 토큰입니다.",errorType:o.data.errorType}}catch(g){return console.error("토큰 검증 오류:",g),{success:!1,error:"토큰 검증에 실패했습니다."}}},oe=async(l,f,g)=>{try{const u=C(r),d=await _(u,"verifyPasswordResetToken")({token:l,uid:f,newPassword:g});return d.data.success?{success:!0,message:d.data.message}:{success:!1,error:d.data.error||"비밀번호 재설정에 실패했습니다.",errorType:d.data.errorType}}catch(u){return console.error("비밀번호 재설정 오류:",u),{success:!1,error:"비밀번호 재설정에 실패했습니다."}}},ie=ke(()=>!!i.value);return{user:J(i),loading:J(a),isAuthenticated:ie,signup:m,login:re,logout:se,resendVerificationEmailForLogin:D,checkEmailVerificationStatus:y,sendPasswordResetEmail:ne,verifyPasswordResetToken:ae,confirmPasswordReset:oe,getAutoLoginInfo:te,clearAutoLoginInfo:$}};export{E as F,He as c,C as g,_ as h,Xe as u};
