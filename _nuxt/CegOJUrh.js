const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CWgZd2SI.js","./entry.DNw42TVG.css"])))=>i.map(i=>d[i]);
import{F as U,c as Y,g as Z,h as ee}from"./BslKsjqr.js";import{F as te,a as B,u as oe,$ as se,r as _,o as re,O as ae,L as l,g as E,H as y,K as i,I as t,G as x,T as S,P as c,M as u,J as ne,_ as R}from"./CWgZd2SI.js";import{_ as ie,a as le}from"./DWDJZdXV.js";import{u as ce}from"./B-m16083.js";const ue=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:U,connectFunctionsEmulator:Y,getFunctions:Z,httpsCallable:ee},Symbol.toStringTag,{value:"Module"})),de={key:0,class:"text-center"},fe={key:1,class:"text-center py-8"},me={key:2,class:"text-center"},pe={key:3,class:"text-center"},ve={class:"error-text mb-6"},_e={key:0,class:"mb-6"},ye={class:"logo-bottom text-center mt-6"},be={class:"logo-with-credit"},ge={__name:"verify-email",setup(ke){const{$firebaseApp:$}=B(),I=oe(),C=se(),T=_(!1),s=_(!1),A=_(!1),d=_(!1),r=_(""),f=_(!1),F=C.query.token,V=C.query.uid,b=C.query.mode,g=C.query.oobCode;re(()=>{if(F&&V){T.value=!0;return}if(b&&g){T.value=!0;return}d.value=!0,r.value="유효하지 않은 인증 링크입니다.",f.value=!0});const X=async()=>{T.value=!1,s.value=!0,F&&V?await j():b&&g&&await H()},j=async()=>{try{const{getFunctions:o,httpsCallable:e}=await R(async()=>{const{getFunctions:k,httpsCallable:h}=await Promise.resolve().then(()=>ue);return{getFunctions:k,httpsCallable:h}},void 0,import.meta.url),m=o($),a=await e(m,"verifyEmailToken")({token:F,uid:V});a.data.success?(A.value=!0,s.value=!1):(d.value=!0,r.value=a.data.error||"인증에 실패했습니다.",s.value=!1,(a.data.errorType==="invalid_token"||a.data.errorType==="expired_token"||a.data.errorType==="no_token")&&(f.value=!0))}catch(o){console.error("토큰 인증 오류:",o),d.value=!0,r.value="인증 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",f.value=!0,s.value=!1}},H=async()=>{if(b==="resetPassword"){await I.push({path:"/reset-password",query:{mode:b,oobCode:g}});return}if(b!=="verifyEmail"){d.value=!0,r.value="지원하지 않는 인증 모드입니다.",s.value=!1;return}try{const{applyActionCode:o,checkActionCode:e}=await R(async()=>{const{applyActionCode:n,checkActionCode:w}=await import("./CWgZd2SI.js").then(v=>v.aD);return{applyActionCode:n,checkActionCode:w}},__vite__mapDeps([0,1]),import.meta.url),{collection:m,query:p,where:a,getDocs:k,doc:h,setDoc:D,serverTimestamp:M}=await R(async()=>{const{collection:n,query:w,where:v,getDocs:z,doc:N,setDoc:J,serverTimestamp:K}=await import("./CWgZd2SI.js").then(Q=>Q.aE);return{collection:n,query:w,where:v,getDocs:z,doc:N,setDoc:J,serverTimestamp:K}},__vite__mapDeps([0,1]),import.meta.url),{$firebaseAuth:W,$firebaseFirestore:G}=B(),L=W,q=G;if(!L||!q)throw new Error("Firebase가 초기화되지 않았습니다.");let P=null;try{P=(await e(L,g)).data.email}catch(n){if(n.code==="auth/invalid-action-code"){d.value=!0,r.value="이미 사용되었거나 유효하지 않은 인증 링크입니다.",f.value=!0,s.value=!1;return}throw n}if(await o(L,g),P){const n=m(q,"users"),w=p(n,a("email","==",P)),v=await k(w);if(!v.empty){const z=v.docs[0],N=h(q,"users",z.id);await D(N,{emailVerified:!0,emailVerifiedAt:M(),verificationToken:null,verificationTokenCreatedAt:null,verificationTokenExpiresAt:null,updatedAt:M()},{merge:!0})}}A.value=!0,s.value=!1}catch(o){console.error("Firebase 인증 오류:",o),d.value=!0,s.value=!1,o.code==="auth/expired-action-code"?(r.value="인증 링크가 만료되었습니다. 새로운 인증 링크를 요청해주세요.",f.value=!0):o.code==="auth/invalid-action-code"?(r.value="이미 인증된 이메일이거나 유효하지 않은 인증 링크입니다.",f.value=!0):o.code==="auth/user-disabled"?r.value="비활성화된 계정입니다.":o.code==="auth/user-not-found"?r.value="사용자를 찾을 수 없습니다.":r.value=o.message||"이메일 인증에 실패했습니다."}},O=()=>{I.push("/login")};return ce({title:"이메일 인증 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(o,e)=>{const m=E("v-icon"),p=E("v-btn"),a=E("v-progress-circular"),k=le,h=ie,D=E("v-app");return y(),ae(D,null,{default:l(()=>[i(h,null,{default:l(()=>[e[14]||(e[14]=t("div",{class:"text-center mb-8"},[t("h1",{class:"login-title mb-2"}," CNX Library "),t("p",{class:"login-subtitle"}," 이메일 인증 ")],-1)),c(T)?(y(),x("div",de,[i(m,{color:"primary",size:"64",class:"mb-4"},{default:l(()=>[...e[0]||(e[0]=[u(" mdi-email-check-outline ",-1)])]),_:1}),e[2]||(e[2]=t("h2",{class:"pending-title mb-4"}," 이메일 인증을 진행하시겠습니까? ",-1)),e[3]||(e[3]=t("p",{class:"pending-text mb-6"}," 아래 버튼을 클릭하여 이메일 인증을 완료해주세요. ",-1)),i(p,{block:"",size:"large",class:"verify-btn",elevation:"2",loading:c(s),disabled:c(s),onClick:X},{default:l(()=>[...e[1]||(e[1]=[u(" 이메일 인증하기 ",-1)])]),_:1},8,["loading","disabled"])])):c(s)?(y(),x("div",fe,[i(a,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[4]||(e[4]=t("p",{class:"verifying-text"}," 이메일 인증을 처리하는 중입니다... ",-1))])):c(A)?(y(),x("div",me,[i(m,{color:"success",size:"64",class:"mb-4"},{default:l(()=>[...e[5]||(e[5]=[u(" mdi-check-circle ",-1)])]),_:1}),e[7]||(e[7]=t("h2",{class:"success-title mb-4"}," 이메일 인증이 완료되었습니다! ",-1)),e[8]||(e[8]=t("p",{class:"success-text mb-6"}," 이제 로그인하여 CNX Library를 이용하실 수 있습니다. ",-1)),i(p,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:O},{default:l(()=>[...e[6]||(e[6]=[u(" 로그인하기 ",-1)])]),_:1})])):c(d)?(y(),x("div",pe,[i(m,{color:"error",size:"64",class:"mb-4"},{default:l(()=>[...e[9]||(e[9]=[u(" mdi-alert-circle ",-1)])]),_:1}),e[12]||(e[12]=t("h2",{class:"error-title mb-4"}," 인증에 실패했습니다 ",-1)),t("p",ve,ne(c(r)),1),c(f)?(y(),x("div",_e,[...e[10]||(e[10]=[t("p",{class:"info-text mb-4"},[u(" 새로운 인증 메일을 받으시려면 로그인 페이지에서"),t("br"),u(' "인증 이메일 재전송"을 클릭해주세요. ')],-1)])])):S("",!0),i(p,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:O},{default:l(()=>[...e[11]||(e[11]=[u(" 로그인 페이지로 이동 ",-1)])]),_:1})])):S("",!0),t("div",ye,[t("div",be,[i(k),e[13]||(e[13]=t("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},Te=te(ge,[["__scopeId","data-v-14dccac9"]]);export{Te as default};
