const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D3YUa0Cc.js","./entry.DYRcaxkF.css"])))=>i.map(i=>d[i]);
import{F as _e,N as ge,a as he,D as ye,r as n,k as O,o as X,e as fe,_ as U,O as Y,L as y,g as i,H as c,K as l,P as s,I as a,G as f,S as Z,J as S,Q as M,Y as be,M as p,V as z,W as we}from"./D3YUa0Cc.js";import{u as ke,_ as qe}from"./D9AfA5as.js";import{_ as xe}from"./M5KcxPjM.js";import{g as Be,C as De,_ as Re}from"./CJEW9Xdq.js";import{_ as Ve}from"./DXetfdD1.js";import{u as Ce}from"./CRJr_llW.js";import{u as Ee}from"./BLOrbh-U.js";import"./BtPLMiox.js";const Le={class:"books-request-page"},Se={class:"center-header mb-6"},$e={class:"center-header-inner"},Ne={class:"page-title mb-0"},Te={class:"search-section mb-6"},Pe={key:0,class:"search-loading-section mb-8"},We={class:"text-center py-8"},Ae={key:1,class:"search-empty-section mb-8"},Fe={class:"text-center py-8 text-medium-emphasis empty-state"},Ie={class:"mb-2"},Oe={key:2,class:"search-results-section mb-8"},Ue={class:"search-results-header mb-4"},Me={class:"text-body-1"},ze={key:0,class:"d-flex justify-center mt-6"},Ke={class:"drawer-content"},He={__name:"request",setup(Qe){const{user:V}=Ce(),{searchBooks:ee,getBooksByCenter:te,getBestsellers:se}=ke(),{alert:C}=ge(),{$firebaseFirestore:oe}=he(),b=oe,q=ye("navigationDrawer",()=>!1),K=n(280),H=[...De],o=n(""),ae=n(""),_=n(""),w=n([]),x=n(10),E=n(!1),Q=n(null),$=n(!1),B=O(()=>w.value.slice(0,x.value)),ne=O(()=>w.value.length),re=O(()=>x.value<w.value.length),N=n([]),T=n(!1),L=n([]),D=n([]),P=n(new Set);X(()=>{const e=()=>{K.value=window.innerWidth>=769?360:280};e(),window.addEventListener("resize",e),fe(()=>{window.removeEventListener("resize",e)})});const le=async()=>{if(!V.value||!b)return"";try{const{doc:e,getDoc:t}=await U(async()=>{const{doc:d,getDoc:g}=await import("./D3YUa0Cc.js").then(h=>h.aF);return{doc:d,getDoc:g}},__vite__mapDeps([0,1]),import.meta.url),r=e(b,"users",V.value.uid),u=await t(r);if(u.exists())return u.data().workplace||""}catch(e){console.error("사용자 근무지 정보 가져오기 오류:",e)}return""};X(async()=>{const e=await le();ae.value=e,o.value=e?Be(e):H[0],await Promise.all([j(),G(),W()])});const ie=async()=>{await Promise.all([j(),G(),W()])},ce=async()=>{if(_.value.trim())try{E.value=!0,Q.value=null,x.value=10,$.value=!0;const e=await ee(_.value);w.value=e.items||[]}catch(e){console.error("도서 검색 오류:",e),Q.value=e.message||"도서 검색에 실패했습니다.",w.value=[]}finally{E.value=!1}},ue=()=>{_.value="",w.value=[],x.value=10,$.value=!1},de=()=>{x.value+=10},j=async()=>{try{T.value=!0;const e=await se(10);N.value=e.items||[]}catch(e){console.error("베스트셀러 로드 오류:",e),N.value=[]}finally{T.value=!1}},G=async()=>{try{const e=await te(o.value);L.value=e}catch(e){console.error("등록된 도서 로드 오류:",e),L.value=[]}},W=async()=>{try{if(!b){D.value=[];return}const{collection:e,query:t,where:r,getDocs:u}=await U(async()=>{const{collection:m,query:R,where:A,getDocs:F}=await import("./D3YUa0Cc.js").then(I=>I.aF);return{collection:m,query:R,where:A,getDocs:F}},__vite__mapDeps([0,1]),import.meta.url),d=e(b,"bookRequests"),g=t(d,r("center","==",o.value),r("status","==","pending")),h=await u(g),k=[];h.forEach(m=>{k.push({id:m.id,...m.data()})}),D.value=k}catch(e){console.error("신청된 도서 로드 오류:",e),D.value=[]}},J=async e=>{const t=e.isbn13||e.isbn||"";if(!t){await C("ISBN 정보가 없어 신청할 수 없습니다.",{type:"error"});return}if(!P.value.has(t))try{if(P.value.add(t),!b||!V.value){await C("로그인이 필요합니다.",{type:"warning"});return}const{collection:r,addDoc:u,serverTimestamp:d}=await U(async()=>{const{collection:h,addDoc:k,serverTimestamp:m}=await import("./D3YUa0Cc.js").then(R=>R.aF);return{collection:h,addDoc:k,serverTimestamp:m}},__vite__mapDeps([0,1]),import.meta.url);await u(r(b,"bookRequests"),{isbn13:e.isbn13||"",isbn:e.isbn||"",title:e.title||"",author:e.author||"",publisher:e.publisher||"",cover:e.cover||e.image||"",description:e.description||"",pubDate:e.pubDate||"",center:o.value,status:"pending",requestedBy:V.value.uid,requestedAt:d()}),await W();const g=e.title||"도서";await C(`"${g}"이(가) ${o.value}에 신청되었습니다.

관리자 승인 후 등록됩니다.`,{type:"success"})}catch(r){console.error("도서 신청 오류:",r),await C(r.message||"도서 신청에 실패했습니다.",{type:"error"})}finally{P.value.delete(t)}};return Ee({title:"도서 신청 - CNX Library",meta:[{name:"description",content:"센터별 도서 신청"}]}),(e,t)=>{const r=i("v-select"),u=i("v-text-field"),d=i("v-progress-circular"),g=i("v-icon"),h=qe,k=i("v-col"),m=i("v-row"),R=i("v-btn"),A=xe,F=Re,I=Ve,me=i("v-navigation-drawer"),ve=i("v-app");return c(),Y(ve,null,{default:y(()=>[l(F,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:t[2]||(t[2]=v=>q.value=!s(q))},{default:y(()=>[a("div",Le,[a("div",Se,[a("div",$e,[a("h1",Ne,S(s(o))+" 도서 신청 ",1),l(r,{modelValue:s(o),"onUpdate:modelValue":[t[0]||(t[0]=v=>M(o)?o.value=v:null),ie],items:H,variant:"outlined",density:"comfortable","hide-details":"",class:"center-select"},null,8,["modelValue"])])]),a("div",Te,[l(u,{modelValue:s(_),"onUpdate:modelValue":t[1]||(t[1]=v=>M(_)?_.value=v:null),label:"도서 검색","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable",loading:s(E),clearable:"",class:"search-input",onKeyup:be(ce,["enter"]),"onClick:clear":ue},null,8,["modelValue","loading"])]),s(E)?(c(),f("div",Pe,[a("div",We,[l(d,{indeterminate:"",color:"primary"}),t[4]||(t[4]=a("p",{class:"mt-4 text-medium-emphasis"}," 검색 중... ",-1))])])):s($)&&s(B).length===0?(c(),f("div",Ae,[a("div",Fe,[l(g,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:y(()=>[...t[5]||(t[5]=[p(" mdi-book-search-outline ",-1)])]),_:1}),a("p",Ie,[t[6]||(t[6]=p(" '",-1)),a("strong",null,S(s(_)),1),t[7]||(t[7]=p("'에 대한 검색 결과가 없습니다. ",-1))]),t[8]||(t[8]=a("p",{class:"text-body-2"}," 다른 검색어로 시도해보세요. ",-1))])])):s(B).length>0?(c(),f("div",Oe,[a("div",Ue,[a("div",Me,[s(ne)>=10?(c(),f(z,{key:0},[t[9]||(t[9]=p(" 검색 결과가 많습니다. (현재 ",-1)),a("strong",null,S(s(B).length),1),t[10]||(t[10]=p("개 표시 중) ",-1))],64)):(c(),f(z,{key:1},[t[11]||(t[11]=p(" 총 ",-1)),a("strong",null,S(s(B).length),1),t[12]||(t[12]=p("개의 검색 결과 ",-1))],64))])]),l(m,{class:"book-list-row"},{default:y(()=>[(c(!0),f(z,null,we(s(B),(v,pe)=>(c(),Y(k,{key:`search-${pe}`,cols:"12",sm:"6",class:"book-list-col"},{default:y(()=>[l(h,{book:v,center:s(o),"registered-books":s(L),"requested-books":s(D),selectable:!1,"show-action":!0,"action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,onRegister:J},null,8,["book","center","registered-books","requested-books","action-button-text","registered-message","requested-message"])]),_:2},1024))),128))]),_:1}),s(re)?(c(),f("div",ze,[l(R,{variant:"outlined",color:"primary",onClick:de},{default:y(()=>[...t[13]||(t[13]=[p(" 더보기 ",-1)])]),_:1})])):Z("",!0)])):Z("",!0),l(A,{books:s(N),center:s(o),"registered-books":s(L),"requested-books":s(D),title:"베스트셀러",loading:s(T),"empty-message":"베스트셀러를 불러올 수 없습니다.","action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,"nav-id":"bestseller",class:"mb-8",onRegister:J},null,8,["books","center","registered-books","requested-books","loading","action-button-text","registered-message","requested-message"])])]),_:1}),l(me,{modelValue:s(q),"onUpdate:modelValue":t[3]||(t[3]=v=>M(q)?q.value=v:null),location:"right",temporary:"",width:s(K),class:"side-navigation"},{default:y(()=>[a("div",Ke,[l(I)])]),_:1},8,["modelValue","width"])]),_:1})}}},st=_e(He,[["__scopeId","data-v-a7dfa05b"]]);export{st as default};
