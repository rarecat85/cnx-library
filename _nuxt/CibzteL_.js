const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ES9emHaY.js","./entry.DNw42TVG.css"])))=>i.map(i=>d[i]);
import{F as j,N as Y,a as ee,D as te,r as w,o as S,e as oe,_ as $,O as C,L as l,g,H as i,K as v,P as r,I as o,G as x,T as W,Z as se,Q as q,J as y,W as F,X as K,M as d}from"./ES9emHaY.js";import{_ as ae,g as ne}from"./soG2X86W.js";import{_ as re}from"./BE83yxxI.js";import{u as ie}from"./eEf3qI-Q.js";import"./WvfOeGZd.js";import"./7PxgnCfE.js";const le={class:"managers-admin-page"},ce={class:"search-section mb-6"},de={key:0,class:"search-results-section mb-8"},ue={class:"section-header mb-4"},me={class:"text-body-2 text-medium-emphasis"},_e={key:0,class:"text-center py-6"},ve={class:"user-card"},pe={class:"user-card-header"},fe={class:"user-card-content"},ye={class:"user-name"},ge={class:"user-info text-body-2"},he={class:"user-info text-body-2"},we={class:"user-card-action"},xe={key:2,class:"admin-text text-body-2"},be={key:2,class:"text-center py-6 text-medium-emphasis empty-state"},ke={class:"managers-list-section"},De={class:"section-header mb-4"},Le={class:"text-body-2 text-medium-emphasis"},Ce={key:0,class:"text-center py-8"},Ee={class:"user-card"},Ve={class:"user-card-header"},Re={class:"user-card-content"},Te={class:"user-name"},$e={class:"user-info text-body-2"},ze={class:"user-info text-body-2"},Ae={class:"user-card-action"},Ie={key:2,class:"text-center py-8 text-medium-emphasis empty-state"},Ne={class:"drawer-content"},Pe={__name:"index",setup(Be){const{confirm:P,alert:T}=Y(),{$firebaseFirestore:Q}=ee(),h=Q,E=te("navigationDrawer",()=>!1),B=w(280),V=w([]),z=w(!1),b=w(""),m=w([]),A=w(!1),I=w(!1),k=w(null);S(()=>{const t=()=>{B.value=window.innerWidth>=769?360:280};t(),window.addEventListener("resize",t),oe(()=>{window.removeEventListener("resize",t)})}),S(async()=>{await N()});const N=async()=>{if(h)try{z.value=!0;const{collection:t,query:e,where:p,getDocs:u}=await $(async()=>{const{collection:a,query:f,where:D,getDocs:L}=await import("./ES9emHaY.js").then(R=>R.aE);return{collection:a,query:f,where:D,getDocs:L}},__vite__mapDeps([0,1]),import.meta.url),_=t(h,"users"),n=e(_,p("role","==","manager")),c=await u(n);V.value=c.docs.map(a=>({uid:a.id,...a.data()}))}catch(t){console.error("매니저 목록 로드 오류:",t),V.value=[]}finally{z.value=!1}},U=async()=>{if(!(!h||!b.value.trim()))try{A.value=!0,I.value=!0;const{collection:t,getDocs:e}=await $(async()=>{const{collection:n,getDocs:c}=await import("./ES9emHaY.js").then(a=>a.aE);return{collection:n,getDocs:c}},__vite__mapDeps([0,1]),import.meta.url),p=t(h,"users"),u=await e(p),_=b.value.toLowerCase().trim();m.value=u.docs.map(n=>({uid:n.id,...n.data()})).filter(n=>{const c=(n.name||"").toLowerCase(),a=(n.email||"").toLowerCase();return c.includes(_)||a.includes(_)}).slice(0,20)}catch(t){console.error("사용자 검색 오류:",t),m.value=[]}finally{A.value=!1}},H=()=>{b.value="",m.value=[],I.value=!1},X=t=>{switch(t){case"admin":return"최고관리자";case"manager":return"매니저";default:return"일반 사용자"}},G=t=>{switch(t){case"admin":return"warning";case"manager":return"primary";default:return"grey"}},J=async t=>{if(!h)return;const e=ne(t.workplace);if(await P(`"${t.name||t.email}"님을 매니저로 지정하시겠습니까?

소속 센터: ${e}`))try{k.value=t.uid;const{doc:u,updateDoc:_,serverTimestamp:n}=await $(async()=>{const{doc:f,updateDoc:D,serverTimestamp:L}=await import("./ES9emHaY.js").then(R=>R.aE);return{doc:f,updateDoc:D,serverTimestamp:L}},__vite__mapDeps([0,1]),import.meta.url),c=u(h,"users",t.uid);await _(c,{role:"manager",center:e,updatedAt:n()});const a=m.value.findIndex(f=>f.uid===t.uid);a!==-1&&(m.value[a].role="manager",m.value[a].center=e),await N(),await T(`"${t.name||t.email}"님이 매니저로 지정되었습니다.`,{type:"success"})}catch(u){console.error("매니저 지정 오류:",u),await T("매니저 지정에 실패했습니다.",{type:"error"})}finally{k.value=null}},M=async t=>{if(!(!h||!await P(`"${t.name||t.email}"님의 매니저 권한을 해제하시겠습니까?`)))try{k.value=t.uid;const{doc:p,updateDoc:u,serverTimestamp:_}=await $(async()=>{const{doc:a,updateDoc:f,serverTimestamp:D}=await import("./ES9emHaY.js").then(L=>L.aE);return{doc:a,updateDoc:f,serverTimestamp:D}},__vite__mapDeps([0,1]),import.meta.url),n=p(h,"users",t.uid);await u(n,{role:"user",updatedAt:_()});const c=m.value.findIndex(a=>a.uid===t.uid);c!==-1&&(m.value[c].role="user"),await N(),await T(`"${t.name||t.email}"님의 매니저 권한이 해제되었습니다.`,{type:"success"})}catch(p){console.error("매니저 해제 오류:",p),await T("매니저 해제에 실패했습니다.",{type:"error"})}finally{k.value=null}};return ie({title:"매니저 관리 - CNX Library",meta:[{name:"description",content:"매니저 지정 및 관리"}]}),(t,e)=>{const p=g("v-text-field"),u=g("v-progress-circular"),_=g("v-chip"),n=g("v-btn"),c=g("v-col"),a=g("v-row"),f=g("v-icon"),D=ae,L=re,R=g("v-navigation-drawer"),Z=g("v-app");return i(),C(Z,null,{default:l(()=>[v(D,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:e[1]||(e[1]=s=>E.value=!r(E))},{default:l(()=>[o("div",le,[e[18]||(e[18]=o("div",{class:"page-header mb-6"},[o("h1",{class:"page-title mb-0"}," 매니저 관리 ")],-1)),o("div",ce,[v(p,{modelValue:r(b),"onUpdate:modelValue":e[0]||(e[0]=s=>q(b)?b.value=s:null),label:"사용자 검색 (이름 또는 이메일)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"search-input",onKeyup:se(U,["enter"]),"onClick:clear":H},null,8,["modelValue"])]),r(I)?(i(),x("div",de,[o("div",ue,[e[3]||(e[3]=o("h2",{class:"section-title"}," 검색 결과 ",-1)),o("div",me,y(r(m).length)+"명 ",1)]),r(A)?(i(),x("div",_e,[v(u,{indeterminate:"",color:"primary"})])):r(m).length>0?(i(),C(a,{key:1,class:"users-grid"},{default:l(()=>[(i(!0),x(F,null,K(r(m),s=>(i(),C(c,{key:s.uid,cols:"12",sm:"6"},{default:l(()=>[o("div",ve,[o("div",pe,[v(_,{color:G(s.role),size:"x-small",variant:"flat",class:"role-chip"},{default:l(()=>[d(y(X(s.role)),1)]),_:2},1032,["color"])]),o("div",fe,[o("div",ye,y(s.name||"이름 없음"),1),o("div",ge,[e[4]||(e[4]=o("strong",null,"이메일:",-1)),d(" "+y(s.email),1)]),o("div",he,[e[5]||(e[5]=o("strong",null,"근무지:",-1)),d(" "+y(s.workplace||"-"),1)])]),o("div",we,[!s.role||s.role==="user"?(i(),C(n,{key:0,color:"primary",size:"small",class:"action-btn",loading:r(k)===s.uid,onClick:O=>J(s)},{default:l(()=>[...e[6]||(e[6]=[d(" 매니저 지정 ",-1)])]),_:1},8,["loading","onClick"])):s.role==="manager"?(i(),C(n,{key:1,size:"small",variant:"outlined",color:"error",class:"action-btn",loading:r(k)===s.uid,onClick:O=>M(s)},{default:l(()=>[...e[7]||(e[7]=[d(" 해제 ",-1)])]),_:1},8,["loading","onClick"])):s.role==="admin"?(i(),x("div",xe," 최고관리자는 변경할 수 없습니다. ")):W("",!0)])])]),_:2},1024))),128))]),_:1})):(i(),x("div",be,[v(f,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>[...e[8]||(e[8]=[d(" mdi-account-search-outline ",-1)])]),_:1}),o("p",null,[e[9]||(e[9]=d("'",-1)),o("strong",null,y(r(b)),1),e[10]||(e[10]=d("'에 대한 검색 결과가 없습니다.",-1))])]))])):W("",!0),o("div",ke,[o("div",De,[e[11]||(e[11]=o("h2",{class:"section-title"}," 매니저 목록 ",-1)),o("div",Le," 총 "+y(r(V).length)+"명 ",1)]),r(z)?(i(),x("div",Ce,[v(u,{indeterminate:"",color:"primary"})])):r(V).length>0?(i(),C(a,{key:1,class:"managers-grid"},{default:l(()=>[(i(!0),x(F,null,K(r(V),s=>(i(),C(c,{key:s.uid,cols:"12",sm:"6"},{default:l(()=>[o("div",Ee,[o("div",Ve,[v(_,{color:"primary",size:"x-small",variant:"flat",class:"role-chip"},{default:l(()=>[...e[12]||(e[12]=[d(" 매니저 ",-1)])]),_:1})]),o("div",Re,[o("div",Te,y(s.name||"이름 없음"),1),o("div",$e,[e[13]||(e[13]=o("strong",null,"이메일:",-1)),d(" "+y(s.email),1)]),o("div",ze,[e[14]||(e[14]=o("strong",null,"근무지:",-1)),d(" "+y(s.workplace||"-"),1)])]),o("div",Ae,[v(n,{size:"small",variant:"outlined",color:"error",class:"action-btn",loading:r(k)===s.uid,onClick:O=>M(s)},{default:l(()=>[...e[15]||(e[15]=[d(" 해제 ",-1)])]),_:1},8,["loading","onClick"])])])]),_:2},1024))),128))]),_:1})):(i(),x("div",Ie,[v(f,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>[...e[16]||(e[16]=[d(" mdi-account-off-outline ",-1)])]),_:1}),e[17]||(e[17]=o("p",null,"등록된 매니저가 없습니다.",-1))]))])])]),_:1}),v(R,{modelValue:r(E),"onUpdate:modelValue":e[2]||(e[2]=s=>q(E)?E.value=s:null),location:"right",temporary:"",width:r(B),class:"side-navigation"},{default:l(()=>[o("div",Ne,[v(L)])]),_:1},8,["modelValue","width"])]),_:1})}}},Ke=j(Pe,[["__scopeId","data-v-5ae1abd3"]]);export{Ke as default};
