const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dw84HrPm.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as Q,a as N,u as Y,a0 as Z,r as f,o as ee,O as te,L as l,g as P,H as _,K as i,I as t,G as C,U as W,P as c,M as u,J as se,_ as z,aE as oe,aF as ae,aG as re,aH as ne,aI as ie,aJ as le,aK as ce,aL as ue,aM as de,aN as me,aO as pe,aP as ve,aQ as fe,aR as _e,aS as be,aT as ye,aq as ge,aU as he,aV as ke,aW as Ce,aX as Ae,aY as we,ai as xe,aZ as Pe,a_ as Ee,a$ as Te,b0 as Le,b1 as Fe,an as Re,am as Ie}from"./Dw84HrPm.js";import{F as Ve,c as Oe,g as qe,h as ze}from"./DjMHYbGS.js";import{_ as De,a as Se}from"./BmY9MuGI.js";import{u as Me}from"./DaFGRQh7.js";const Ne=Object.freeze(Object.defineProperty({__proto__:null,ActionCodeURL:oe,AuthCredential:ae,EmailAuthCredential:re,EmailAuthProvider:ne,FacebookAuthProvider:ie,GithubAuthProvider:le,GoogleAuthProvider:ce,OAuthCredential:ue,TwitterAuthProvider:de,applyActionCode:me,beforeAuthStateChanged:pe,browserLocalPersistence:ve,browserPopupRedirectResolver:fe,browserSessionPersistence:_e,checkActionCode:be,connectAuthEmulator:ye,createUserWithEmailAndPassword:ge,getAuth:he,getIdTokenResult:ke,inMemoryPersistence:Ce,indexedDBLocalPersistence:Ae,initializeAuth:we,onAuthStateChanged:xe,onIdTokenChanged:Pe,prodErrorMap:Ee,reload:Te,setPersistence:Le,signInWithCredential:Fe,signInWithEmailAndPassword:Re,signOut:Ie},Symbol.toStringTag,{value:"Module"})),We=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:Ve,connectFunctionsEmulator:Oe,getFunctions:qe,httpsCallable:ze},Symbol.toStringTag,{value:"Module"})),Be={key:0,class:"text-center"},$e={key:1,class:"text-center py-8"},je={key:2,class:"text-center"},Ge={key:3,class:"text-center"},Ue={class:"error-text mb-6"},Xe={key:0,class:"mb-6"},He={class:"logo-bottom text-center mt-6"},Je={class:"logo-with-credit"},Ke={__name:"verify-email",setup(Qe){const{$firebaseApp:B}=N(),D=Y(),A=Z(),w=f(!1),o=f(!1),E=f(!1),d=f(!1),a=f(""),m=f(!1),T=A.query.token,L=A.query.uid,b=A.query.mode,y=A.query.oobCode;ee(()=>{if(T&&L){w.value=!0;return}if(b&&y){w.value=!0;return}d.value=!0,a.value="유효하지 않은 인증 링크입니다.",m.value=!0});const $=async()=>{w.value=!1,o.value=!0,T&&L?await j():b&&y&&await G()},j=async()=>{try{const{getFunctions:s,httpsCallable:e}=await z(async()=>{const{getFunctions:g,httpsCallable:h}=await Promise.resolve().then(()=>We);return{getFunctions:g,httpsCallable:h}},void 0,import.meta.url),p=s(B),r=await e(p,"verifyEmailToken")({token:T,uid:L});r.data.success?(E.value=!0,o.value=!1):(d.value=!0,a.value=r.data.error||"인증에 실패했습니다.",o.value=!1,(r.data.errorType==="invalid_token"||r.data.errorType==="expired_token"||r.data.errorType==="no_token")&&(m.value=!0))}catch(s){console.error("토큰 인증 오류:",s),d.value=!0,a.value="인증 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",m.value=!0,o.value=!1}},G=async()=>{if(b==="resetPassword"){await D.push({path:"/reset-password",query:{mode:b,oobCode:y}});return}if(b!=="verifyEmail"){d.value=!0,a.value="지원하지 않는 인증 모드입니다.",o.value=!1;return}try{const{applyActionCode:s,checkActionCode:e}=await z(async()=>{const{applyActionCode:n,checkActionCode:k}=await Promise.resolve().then(()=>Ne);return{applyActionCode:n,checkActionCode:k}},void 0,import.meta.url),{collection:p,query:v,where:r,getDocs:g,doc:h,setDoc:F,serverTimestamp:M}=await z(async()=>{const{collection:n,query:k,where:x,getDocs:O,doc:q,setDoc:H,serverTimestamp:J}=await import("./Dw84HrPm.js").then(K=>K.b2);return{collection:n,query:k,where:x,getDocs:O,doc:q,setDoc:H,serverTimestamp:J}},__vite__mapDeps([0,1]),import.meta.url),{$firebaseAuth:U,$firebaseFirestore:X}=N(),R=U,I=X;if(!R||!I)throw new Error("Firebase가 초기화되지 않았습니다.");let V=null;try{V=(await e(R,y)).data.email}catch(n){if(n.code==="auth/invalid-action-code"){d.value=!0,a.value="이미 사용되었거나 유효하지 않은 인증 링크입니다.",m.value=!0,o.value=!1;return}throw n}if(await s(R,y),V){const n=p(I,"users"),k=v(n,r("email","==",V)),x=await g(k);if(!x.empty){const O=x.docs[0],q=h(I,"users",O.id);await F(q,{emailVerified:!0,emailVerifiedAt:M(),verificationToken:null,verificationTokenCreatedAt:null,verificationTokenExpiresAt:null,updatedAt:M()},{merge:!0})}}E.value=!0,o.value=!1}catch(s){console.error("Firebase 인증 오류:",s),d.value=!0,o.value=!1,s.code==="auth/expired-action-code"?(a.value="인증 링크가 만료되었습니다. 새로운 인증 링크를 요청해주세요.",m.value=!0):s.code==="auth/invalid-action-code"?(a.value="이미 인증된 이메일이거나 유효하지 않은 인증 링크입니다.",m.value=!0):s.code==="auth/user-disabled"?a.value="비활성화된 계정입니다.":s.code==="auth/user-not-found"?a.value="사용자를 찾을 수 없습니다.":a.value=s.message||"이메일 인증에 실패했습니다."}},S=()=>{D.push("/login")};return Me({title:"이메일 인증 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(s,e)=>{const p=P("v-icon"),v=P("v-btn"),r=P("v-progress-circular"),g=Se,h=De,F=P("v-app");return _(),te(F,null,{default:l(()=>[i(h,null,{default:l(()=>[e[14]||(e[14]=t("div",{class:"text-center mb-8"},[t("h1",{class:"login-title mb-2"}," CNX Library "),t("p",{class:"login-subtitle"}," 이메일 인증 ")],-1)),c(w)?(_(),C("div",Be,[i(p,{color:"primary",size:"64",class:"mb-4"},{default:l(()=>[...e[0]||(e[0]=[u(" mdi-email-check-outline ",-1)])]),_:1}),e[2]||(e[2]=t("h2",{class:"pending-title mb-4"}," 이메일 인증을 진행하시겠습니까? ",-1)),e[3]||(e[3]=t("p",{class:"pending-text mb-6"}," 아래 버튼을 클릭하여 이메일 인증을 완료해주세요. ",-1)),i(v,{block:"",size:"large",class:"verify-btn",elevation:"2",loading:c(o),disabled:c(o),onClick:$},{default:l(()=>[...e[1]||(e[1]=[u(" 이메일 인증하기 ",-1)])]),_:1},8,["loading","disabled"])])):c(o)?(_(),C("div",$e,[i(r,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),e[4]||(e[4]=t("p",{class:"verifying-text"}," 이메일 인증을 처리하는 중입니다... ",-1))])):c(E)?(_(),C("div",je,[i(p,{color:"success",size:"64",class:"mb-4"},{default:l(()=>[...e[5]||(e[5]=[u(" mdi-check-circle ",-1)])]),_:1}),e[7]||(e[7]=t("h2",{class:"success-title mb-4"}," 이메일 인증이 완료되었습니다! ",-1)),e[8]||(e[8]=t("p",{class:"success-text mb-6"}," 이제 로그인하여 CNX Library를 이용하실 수 있습니다. ",-1)),i(v,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:S},{default:l(()=>[...e[6]||(e[6]=[u(" 로그인하기 ",-1)])]),_:1})])):c(d)?(_(),C("div",Ge,[i(p,{color:"error",size:"64",class:"mb-4"},{default:l(()=>[...e[9]||(e[9]=[u(" mdi-alert-circle ",-1)])]),_:1}),e[12]||(e[12]=t("h2",{class:"error-title mb-4"}," 인증에 실패했습니다 ",-1)),t("p",Ue,se(c(a)),1),c(m)?(_(),C("div",Xe,[...e[10]||(e[10]=[t("p",{class:"info-text mb-4"},[u(" 새로운 인증 메일을 받으시려면 로그인 페이지에서"),t("br"),u(' "인증 이메일 재전송"을 클릭해주세요. ')],-1)])])):W("",!0),i(v,{block:"",size:"large",class:"login-btn",elevation:"2",onClick:S},{default:l(()=>[...e[11]||(e[11]=[u(" 로그인 페이지로 이동 ",-1)])]),_:1})])):W("",!0),t("div",He,[t("div",Je,[i(g),e[13]||(e[13]=t("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},st=Q(Ke,[["__scopeId","data-v-14dccac9"]]);export{st as default};
