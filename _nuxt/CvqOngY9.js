const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DTWtb0Lw.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{a as tt,D as S,o as rt,Y as et,V as lt,_ as Z,F as X,u as ot,r as ct,k as x,g as b,G as N,H as p,K as n,a2 as ut,U as F,L as e,O,P as k,M as V,ay as dt,I as A,W as ft,R as _t,S as vt,T as at,J,az as mt,X as pt}from"./DTWtb0Lw.js";import{u as Y}from"./jE5KqEc9.js";const Ot=["강남","잠실","수원","판교","용산","증미","여의도"],Ft=["강남센터","용산센터"],Q={강남:"강남센터",잠실:"강남센터",수원:"강남센터",판교:"강남센터",용산:"용산센터",증미:"용산센터",여의도:"용산센터"};function Ct(u){return u in Q?Q[u]:"강남센터"}function Ut(u,d){return d==="강남센터"?u==="강남":d==="용산센터"?u==="용산":!1}let U=null;const ht=()=>{const{$firebaseFirestore:u}=tt(),{user:d}=Y(),a=u,s=S("notifications",()=>[]),w=S("unreadCount",()=>0),E=S("notificationsLoading",()=>!1),L=S("notificationsError",()=>null),T=S("notificationsSubscribed",()=>!1),_=async()=>{if(!d.value||!a){s.value=[],w.value=0;return}if(!T.value)try{const{collection:t,query:o,where:r,orderBy:f,limit:m,onSnapshot:y}=await Z(async()=>{const{collection:M,query:c,where:H,orderBy:q,limit:z,onSnapshot:P}=await import("./DTWtb0Lw.js").then($=>$.b2);return{collection:M,query:c,where:H,orderBy:q,limit:z,onSnapshot:P}},__vite__mapDeps([0,1]),import.meta.url),h=t(a,"notifications"),I=o(h,r("userId","==",d.value.uid),f("createdAt","desc"),m(50));U=y(I,M=>{const c=[];M.forEach(H=>{c.push({id:H.id,...H.data()})}),s.value=c,w.value=c.filter(H=>!H.isRead).length},M=>{console.error("알림 구독 오류:",M),L.value=M.message}),T.value=!0}catch(t){console.error("알림 구독 시작 오류:",t),L.value=t.message}},v=()=>{U&&(U(),U=null,T.value=!1)},B=async t=>{if(a)try{const{doc:o,updateDoc:r}=await Z(async()=>{const{doc:m,updateDoc:y}=await import("./DTWtb0Lw.js").then(h=>h.b2);return{doc:m,updateDoc:y}},__vite__mapDeps([0,1]),import.meta.url),f=o(a,"notifications",t);await r(f,{isRead:!0})}catch(o){console.error("알림 읽음 처리 오류:",o),L.value=o.message}},R=async()=>{if(!(!a||!d.value))try{const{collection:t,query:o,where:r,getDocs:f,doc:m,updateDoc:y,writeBatch:h}=await Z(async()=>{const{collection:q,query:z,where:P,getDocs:$,doc:W,updateDoc:K,writeBatch:j}=await import("./DTWtb0Lw.js").then(G=>G.b2);return{collection:q,query:z,where:P,getDocs:$,doc:W,updateDoc:K,writeBatch:j}},__vite__mapDeps([0,1]),import.meta.url),I=t(a,"notifications"),M=o(I,r("userId","==",d.value.uid),r("isRead","==",!1)),c=await f(M);if(c.empty)return;const H=h(a);c.forEach(q=>{H.update(q.ref,{isRead:!0})}),await H.commit()}catch(t){console.error("모든 알림 읽음 처리 오류:",t),L.value=t.message}},l=async t=>{if(a)try{const{doc:o,deleteDoc:r}=await Z(async()=>{const{doc:m,deleteDoc:y}=await import("./DTWtb0Lw.js").then(h=>h.b2);return{doc:m,deleteDoc:y}},__vite__mapDeps([0,1]),import.meta.url),f=o(a,"notifications",t);await r(f)}catch(o){console.error("알림 삭제 오류:",o),L.value=o.message}},D=async(t=20,o=null)=>{if(!a||!d.value)return{items:[],lastDoc:null};try{E.value=!0;const{collection:r,query:f,where:m,orderBy:y,limit:h,getDocs:I,startAfter:M}=await Z(async()=>{const{collection:$,query:W,where:K,orderBy:j,limit:G,getDocs:nt,startAfter:st}=await import("./DTWtb0Lw.js").then(it=>it.b2);return{collection:$,query:W,where:K,orderBy:j,limit:G,getDocs:nt,startAfter:st}},__vite__mapDeps([0,1]),import.meta.url),c=r(a,"notifications");let H=f(c,m("userId","==",d.value.uid),y("createdAt","desc"),h(t));o&&(H=f(c,m("userId","==",d.value.uid),y("createdAt","desc"),M(o),h(t)));const q=await I(H),z=[];let P=null;return q.forEach($=>{z.push({id:$.id,...$.data()}),P=$}),{items:z,lastDoc:P}}catch(r){return console.error("알림 목록 조회 오류:",r),L.value=r.message,{items:[],lastDoc:null}}finally{E.value=!1}},C=t=>({return_reminder:"mdi-calendar-clock",overdue:"mdi-alert-circle",overdue_admin:"mdi-alert-circle",book_registered:"mdi-book-check",book_request:"mdi-book-plus",rent_request:"mdi-book-arrow-right",book_available:"mdi-book-check"})[t]||"mdi-bell",g=t=>({return_reminder:"warning",overdue:"error",overdue_admin:"error",book_registered:"success",book_request:"info",rent_request:"info",book_available:"success"})[t]||"primary",i=t=>{if(!t)return"";const o=t.toDate?t.toDate():new Date(t),f=new Date-o,m=Math.floor(f/(1e3*60)),y=Math.floor(f/(1e3*60*60)),h=Math.floor(f/(1e3*60*60*24));return m<1?"방금 전":m<60?`${m}분 전`:y<24?`${y}시간 전`:h<7?`${h}일 전`:o.toLocaleDateString("ko-KR",{month:"long",day:"numeric"})};return rt(()=>{d.value&&_()}),et(d,t=>{v(),t?_():(s.value=[],w.value=0)}),lt(()=>{v()}),{notifications:s,unreadCount:w,loading:E,error:L,subscribeToNotifications:_,unsubscribeFromNotifications:v,markAsRead:B,markAllAsRead:R,deleteNotification:l,getNotifications:D,getNotificationIcon:C,getNotificationColor:g,formatNotificationTime:i}},bt={class:"notification-bell-wrapper"},gt={class:"notification-header"},yt={key:0,class:"notification-empty"},kt={class:"notification-time"},wt={class:"notification-footer"},Lt={__name:"NotificationBell",setup(u){const{notifications:d,unreadCount:a,markAsRead:s,markAllAsRead:w,getNotificationIcon:E,getNotificationColor:L,formatNotificationTime:T}=ht(),_=ot(),v=ct(!1),B=()=>{console.log("알림 버튼 클릭됨, 현재 상태:",v.value),v.value=!v.value},R=x(()=>d.value.slice(0,5)),l=async g=>{switch(g.isRead||await s(g.id),v.value=!1,g.type){case"book_request":_.push("/admin/books/register");break;case"rent_request":case"overdue_admin":_.push("/admin/books");break;case"book_registered":_.push("/books");break;case"return_reminder":case"overdue":_.push("/mypage");break;default:_.push("/notifications")}},D=async()=>{await w()},C=()=>{v.value=!1,_.push("/notifications")};return(g,i)=>{const t=b("v-icon"),o=b("v-badge"),r=b("v-btn"),f=b("v-divider"),m=b("v-list-item-title"),y=b("v-list-item-subtitle"),h=b("v-list-item"),I=b("v-list"),M=b("v-card");return p(),N("div",bt,[n(r,{icon:"",variant:"text",class:"notification-btn",onClick:B},{default:e(()=>[k(a)>0?(p(),O(o,{key:0,content:k(a)>99?"99+":k(a),color:"error","offset-x":"-2","offset-y":"-2"},{default:e(()=>[n(t,{size:"24"},{default:e(()=>[...i[1]||(i[1]=[V(" mdi-bell ",-1)])]),_:1})]),_:1},8,["content"])):(p(),O(t,{key:1,size:"24"},{default:e(()=>[...i[2]||(i[2]=[V(" mdi-bell-outline ",-1)])]),_:1}))]),_:1}),ut(n(M,{class:"notification-dropdown"},{default:e(()=>[A("div",gt,[i[4]||(i[4]=A("span",{class:"notification-title"},"알림",-1)),k(a)>0?(p(),O(r,{key:0,variant:"text",size:"small",class:"mark-all-btn",onClick:ft(D,["stop"])},{default:e(()=>[...i[3]||(i[3]=[V(" 모두 읽음 ",-1)])]),_:1})):F("",!0)]),n(f),k(R).length===0?(p(),N("div",yt,[n(t,{size:"48",color:"grey-lighten-1"},{default:e(()=>[...i[5]||(i[5]=[V(" mdi-bell-off-outline ",-1)])]),_:1}),i[6]||(i[6]=A("p",null,"알림이 없습니다",-1))])):(p(),O(I,{key:1,class:"notification-list"},{default:e(()=>[(p(!0),N(_t,null,vt(k(R),c=>(p(),O(h,{key:c.id,class:at([{"notification-unread":!c.isRead},"notification-item"]),onClick:H=>l(c)},{prepend:e(()=>[n(t,{icon:k(E)(c.type),color:k(L)(c.type),size:"24"},null,8,["icon","color"])]),append:e(()=>[A("span",kt,J(k(T)(c.createdAt)),1)]),default:e(()=>[n(m,{class:"notification-item-title"},{default:e(()=>[V(J(c.title),1)]),_:2},1024),n(y,{class:"notification-item-message"},{default:e(()=>[V(J(c.message),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})),n(f),A("div",wt,[n(r,{variant:"text",block:"",class:"view-all-btn",onClick:C},{default:e(()=>[...i[7]||(i[7]=[V(" 전체 알림 보기 ",-1)])]),_:1})])]),_:1},512),[[dt,k(v)]]),k(v)?(p(),N("div",{key:0,class:"notification-overlay",onClick:i[0]||(i[0]=c=>v.value=!1)})):F("",!0)])}}},Dt=X(Lt,[["__scopeId","data-v-215dc4da"]]),Ht=()=>{const{user:u}=Y(),{$firebaseFirestore:d}=tt(),a=d,s=S("currentUserData",()=>null),w=S("userDataLoading",()=>!1),E=x(()=>s.value?.workplace||""),L=x(()=>s.value?.name||""),T=x(()=>s.value?.email||""),_=x(()=>s.value?.role||"user"),v=x(()=>s.value?.center||""),B=x(()=>_.value==="admin"||_.value==="manager"),R=x(()=>_.value==="admin"),l=async(C=!1)=>{if(s.value&&!C)return s.value;if(!u.value||!a)return s.value=null,null;w.value=!0;try{const{doc:g,getDoc:i}=await Z(async()=>{const{doc:r,getDoc:f}=await import("./DTWtb0Lw.js").then(m=>m.b2);return{doc:r,getDoc:f}},__vite__mapDeps([0,1]),import.meta.url),t=g(a,"users",u.value.uid),o=await i(t);return o.exists()?(s.value=o.data(),s.value):(s.value=null,null)}catch(g){return console.error("사용자 데이터 로드 오류:",g),s.value=null,null}finally{w.value=!1}},D=()=>{s.value=null};return et(()=>u.value,async(C,g)=>{C&&C.uid!==g?.uid?await l(!0):C||D()},{immediate:!0}),{userData:s,userDataLoading:w,workplace:E,name:L,email:T,role:_,center:v,isAdmin:B,isSuperAdmin:R,loadUserData:l,clearUserData:D}},Vt={class:"page-layout"},Mt={class:"page-background"},Rt={class:"page-header"},xt={class:"page-header-inner"},At={class:"page-header-top"},Nt={class:"page-header-left"},Et={key:0,class:"page-icon"},Tt={key:2,class:"header-icons"},$t={key:0,class:"page-header-actions"},Bt={key:0,class:"header-text-content"},It=["innerHTML"],qt={__name:"PageLayout",props:{headerType:{type:String,default:"icon",validator:u=>["icon","home","back-home"].includes(u)},showHeaderActions:{type:Boolean,default:!1}},emits:["toggle-drawer"],setup(u){const d=ot(),{isAuthenticated:a}=Y(),{userData:s,workplace:w,name:E}=Ht(),L=x(()=>{if(a.value&&s.value){const R=w.value?Ct(w.value):"";return`안녕하세요, ${E.value}님<br>이용하실 도서관은 ${R} 입니다.`}else return"The world belongs to<br>those who read."}),T=x(()=>!a.value),_=x(()=>!0),v=()=>{d.push("/")},B=()=>{d.back()};return(R,l)=>{const D=b("v-icon"),C=b("v-btn"),g=Dt,i=b("v-card"),t=b("v-col"),o=b("v-row"),r=b("v-container");return p(),N("div",Vt,[A("div",Mt,[A("div",Rt,[A("div",xt,[A("div",At,[A("div",Nt,[u.headerType==="icon"?(p(),N("div",Et,[n(D,{size:"28"},{default:e(()=>[...l[1]||(l[1]=[V(" mdi-book-open-variant ",-1)])]),_:1})])):u.headerType==="home"?(p(),O(C,{key:1,icon:"",variant:"text",class:"header-icon-btn",onClick:v},{default:e(()=>[n(D,{size:"28"},{default:e(()=>[...l[2]||(l[2]=[V(" mdi-book-open-variant ",-1)])]),_:1})]),_:1})):u.headerType==="back-home"?(p(),N("div",Tt,[n(C,{icon:"",variant:"text",class:"header-icon-btn",onClick:B},{default:e(()=>[n(D,{size:"24"},{default:e(()=>[...l[3]||(l[3]=[V(" mdi-arrow-left ",-1)])]),_:1})]),_:1}),n(C,{icon:"",variant:"text",class:"header-icon-btn",onClick:v},{default:e(()=>[n(D,{size:"28"},{default:e(()=>[...l[4]||(l[4]=[V(" mdi-book-open-variant ",-1)])]),_:1})]),_:1})])):F("",!0)]),u.showHeaderActions?(p(),N("div",$t,[n(C,{icon:"",variant:"text",class:"header-action-btn",to:"/mypage"},{default:e(()=>[n(D,{size:"24"},{default:e(()=>[...l[5]||(l[5]=[V(" mdi-account-circle-outline ",-1)])]),_:1})]),_:1}),n(g),n(C,{icon:"",variant:"text",class:"header-action-btn",onClick:l[0]||(l[0]=f=>R.$emit("toggle-drawer"))},{default:e(()=>[n(D,{size:"24"},{default:e(()=>[...l[6]||(l[6]=[V(" mdi-menu ",-1)])]),_:1})]),_:1})])):F("",!0)]),k(_)?(p(),N("div",Bt,[A("div",{class:at(["header-text-line",{"english-text":k(T)}]),innerHTML:k(L)},null,10,It)])):F("",!0)])]),n(r,{fluid:"",class:"page-container"},{default:e(()=>[n(o,{justify:"center",class:"page-row"},{default:e(()=>[n(t,{cols:"12",class:"page-col"},{default:e(()=>[n(i,{class:"page-card",rounded:"t-lg"},{default:e(()=>[mt(R.$slots,"default",{},void 0,!0)]),_:3})]),_:3})]),_:3})]),_:3})])])}}},Wt=X(qt,[["__scopeId","data-v-c0bef313"]]),St={role:"img",width:"182",height:"28",viewBox:"0 0 182 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"logo-svg"},zt={__name:"ConcentrixLogo",setup(u){return(d,a)=>(p(),N("svg",St,[...a[0]||(a[0]=[pt('<title data-v-89b90546>Concentrix</title><path d="M153.044 6.75281H146.291C145.395 6.75281 144.536 6.39709 143.903 5.76389C143.27 5.13069 142.914 4.27189 142.914 3.37641C142.914 2.48093 143.27 1.62213 143.903 0.988927C144.536 0.355728 145.395 0 146.291 0L153.044 0C153.939 0 154.798 0.355728 155.431 0.988927C156.065 1.62213 156.42 2.48093 156.42 3.37641C156.42 4.27189 156.065 5.13069 155.431 5.76389C154.798 6.39709 153.939 6.75281 153.044 6.75281Z" fill="#25E2CC" data-v-89b90546></path><path d="M0 18.6087C0 13.3502 4.2774 9.22977 9.9288 9.22977C12.2993 9.14979 14.6302 9.85307 16.5608 11.2308L14.4813 15.1154C13.3173 14.3104 11.9326 13.8855 10.5175 13.8989C7.37818 13.8989 5.25873 15.8587 5.25873 18.608C5.25873 21.3573 7.33829 23.317 10.4384 23.317C11.8804 23.3484 13.2954 22.9226 14.4806 22.1006L16.5188 25.9466C14.598 27.3183 12.2859 28.0338 9.926 27.9869C4.15981 27.9869 0 23.9057 0 18.6087Z" fill="currentColor" data-v-89b90546></path><path d="M17.4141 18.6055C17.4141 13.2686 21.7699 9.22656 27.1854 9.22656C32.6009 9.22656 36.9567 13.2686 36.9567 18.6055C36.9567 23.9423 32.6009 27.9844 27.1854 27.9844C21.7699 27.9844 17.4141 23.9423 17.4141 18.6055ZM31.7771 18.6055C31.7542 17.7023 31.4655 16.826 30.947 16.0861C30.4286 15.3462 29.7034 14.7757 28.8623 14.4458C28.0212 14.116 27.1015 14.0415 26.2183 14.2318C25.3351 14.422 24.5276 14.8685 23.8969 15.5153C23.2661 16.1622 22.8402 16.9807 22.6723 17.8684C22.5045 18.7561 22.6022 19.6736 22.9532 20.506C23.3042 21.3385 23.8929 22.0489 24.6457 22.5485C25.3985 23.0481 26.2819 23.3145 27.1854 23.3145C27.7981 23.3138 28.4045 23.1906 28.969 22.9522C29.5334 22.7138 30.0445 22.365 30.4723 21.9263C30.9001 21.4876 31.2358 20.9679 31.4599 20.3976C31.684 19.8273 31.7918 19.218 31.7771 18.6055Z" fill="currentColor" data-v-89b90546></path><path d="M57.9849 17.6627V27.6302H52.8437V18.3689C52.8437 15.6217 51.2338 13.8558 48.8799 13.8558C48.3118 13.8441 47.7474 13.9499 47.2222 14.1667C46.697 14.3835 46.2223 14.7066 45.8279 15.1156C45.4335 15.5247 45.128 16.0108 44.9305 16.5436C44.733 17.0763 44.6477 17.6442 44.6802 18.2114V27.6302H39.5391V9.57932H43.2278L43.4238 12.6408C44.4835 10.7566 46.7598 9.22656 50.0558 9.22656C54.8855 9.22656 57.9828 12.5232 57.9828 17.6634" fill="currentColor" data-v-89b90546></path><path d="M60.3679 18.6087C60.3679 13.3502 64.6453 9.22977 70.296 9.22977C72.6665 9.14979 74.9974 9.85307 76.928 11.2308L74.8485 15.1154C73.6844 14.3105 72.2998 13.8856 70.8846 13.8989C67.7447 13.8989 65.6259 15.8587 65.6259 18.608C65.6259 21.3573 67.7055 23.317 70.8056 23.317C72.2476 23.3484 73.6626 22.9226 74.8478 22.1006L76.8881 25.9466C74.9673 27.3183 72.6552 28.0338 70.2953 27.9869C64.5263 27.9869 60.3672 23.9057 60.3672 18.608" fill="currentColor" data-v-89b90546></path><path d="M96.1821 20.0198H82.9173C83.506 22.0992 85.5072 23.6691 88.3329 23.6691C90.1056 23.6879 91.8185 23.028 93.1205 21.8249L95.24 25.5134C94.1411 26.4933 91.904 27.9855 87.7834 27.9855C82.0543 27.9855 77.8546 23.9043 77.8546 18.6066C77.8225 17.3629 78.0445 16.1257 78.507 14.9707C78.9695 13.8157 79.6627 12.7672 80.5444 11.8893C81.426 11.0114 82.4774 10.3226 83.6344 9.86494C84.7913 9.4073 86.0295 9.19048 87.2731 9.22773C92.7279 9.22773 96.2598 13.2306 96.2598 18.6458C96.2598 19.3129 96.1814 20.0191 96.1814 20.0191M82.9565 16.7225H91.3559C91.2626 15.7665 90.8092 14.8819 90.0877 14.2479C89.3662 13.6139 88.4306 13.278 87.4705 13.3083C86.4352 13.2481 85.4122 13.5587 84.5852 14.1843C83.7581 14.81 83.1803 15.7098 82.9565 16.7225Z" fill="currentColor" data-v-89b90546></path><path d="M117.274 17.6627V27.6302H112.133V18.3689C112.133 15.6217 110.523 13.8558 108.169 13.8558C107.601 13.8441 107.037 13.9499 106.511 14.1667C105.986 14.3835 105.511 14.7066 105.117 15.1156C104.723 15.5247 104.417 16.0108 104.22 16.5436C104.022 17.0763 103.937 17.6442 103.969 18.2114V27.6302H98.8281V9.57932H102.517L102.713 12.6408C103.773 10.7566 106.049 9.22656 109.345 9.22656C114.175 9.22656 117.272 12.5232 117.272 17.6634" fill="currentColor" data-v-89b90546></path><path d="M148.087 9.38356L147.655 14.4853C147.085 14.2442 146.47 14.125 145.85 14.1353C142.985 14.1353 141.219 16.0188 141.219 18.5693V27.6304H136.078V9.57954H140.356L140.552 13.1113C141.181 10.9143 143.416 9.22678 146.516 9.22678C147.044 9.21678 147.571 9.26965 148.086 9.38426" fill="currentColor" data-v-89b90546></path><path d="M155.59 9.58105H150.449V27.6327H155.59V9.58105Z" fill="currentColor" data-v-89b90546></path><path d="M170.785 27.6327L167.018 21.9031L163.25 27.6327H157.363L163.838 18.568L157.678 9.58105H163.643L167.136 15.1146L170.786 9.58105H176.633L170.235 18.4504L176.828 27.6327H170.785Z" fill="currentColor" data-v-89b90546></path><path d="M132.273 22.3778C131.397 22.9923 130.359 23.3333 129.29 23.3576C127.446 23.3576 126.112 22.5723 126.112 20.4537V13.901H132.822V9.58464H126.112V3.38477H121.125V9.59234H118.309C120.102 11.8964 121.041 14.7502 120.968 17.6687V20.9646C120.968 25.477 123.676 27.989 128.108 27.989C130.23 28.0721 132.318 27.4361 134.034 26.1839L132.273 22.3778Z" fill="currentColor" data-v-89b90546></path><path d="M156.411 3.37641C156.411 4.0442 156.213 4.69699 155.842 5.25224C155.471 5.80749 154.944 6.24025 154.327 6.4958C153.71 6.75135 153.031 6.81822 152.376 6.68794C151.721 6.55766 151.119 6.23609 150.647 5.76389C150.175 5.29169 149.853 4.69007 149.723 4.03511C149.593 3.38015 149.66 2.70127 149.915 2.08431C150.171 1.46735 150.604 0.940032 151.159 0.569027C151.714 0.198023 152.367 0 153.035 0C153.93 0 154.789 0.355728 155.422 0.988927C156.056 1.62213 156.411 2.48093 156.411 3.37641Z" fill="currentColor" data-v-89b90546></path><path d="M177.766 9.95621H178.403V11.573H178.865V9.95621H179.502V9.58105H177.766L177.766 9.95621Z" fill="currentColor" data-v-89b90546></path><path d="M182 11.5737L181.994 9.58105H181.616L180.882 10.8185L180.135 9.58105H179.754V11.5737H180.186V10.4042L180.77 11.3637H180.98L181.566 10.379V11.5744L182 11.5737Z" fill="currentColor" data-v-89b90546></path>',15)])]))}},Kt=X(zt,[["__scopeId","data-v-89b90546"]]);export{Ft as C,Ot as W,Wt as _,Kt as a,Ht as b,Ut as c,Ct as g,ht as u};
