const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CvDJqPe-.js","./entry.DNw42TVG.css"])))=>i.map(i=>d[i]);
import{F as te,N as se,a as oe,r as i,D as ae,o as M,e as ne,u as re,O as ie,L as C,_ as O,g as R,H as ce,K as m,P as o,I as s,J as v,Q as U,M as le}from"./CvDJqPe-.js";import{_ as de}from"./BybGCtKG.js";import{g as ue,C as _e,_ as me,c as ve}from"./D8qTLWOZ.js";import{_ as pe}from"./WwNgRz5i.js";import{u as we}from"./BcFuV-z-.js";import{u as he}from"./BFdgS7Lg.js";import{u as fe}from"./Dbt3lYbw.js";import"./DUdIsili.js";import"./BnKtqovu.js";const ge={class:"home-page"},ye={class:"my-rental-status-section"},be={class:"rental-status-header mb-6"},ke={class:"page-title mb-0"},De={class:"rental-dashboard"},Ce={class:"dashboard-number"},Re={class:"dashboard-number"},Be={class:"dashboard-number"},Ne={class:"center-header mb-6"},xe={class:"center-header-inner"},Ee={class:"page-title mb-0"},Le={class:"new-books-section"},Ve={class:"more-books-btn-wrapper"},Se={class:"drawer-content"},W=5,Ae={__name:"index",setup(Pe){const{user:c}=we(),{getBooksByCenter:H,rentBook:q,requestRent:z}=he(),{confirm:Q,alert:y}=se(),{$firebaseFirestore:X}=oe(),p=X,L=i(!1),w=ae("navigationDrawer",()=>!1),V=i(280);M(()=>{const e=()=>{V.value=window.innerWidth>=769?360:280};e(),window.addEventListener("resize",e),ne(()=>{window.removeEventListener("resize",e)})});const S=[..._e],n=i(""),A=i(""),h=i([]),B=i(!1),P=i(""),N=i(0),T=i(0),I=i(0),F=re(),x=()=>{F.push("/mypage")},J=async()=>{if(!c.value||!p)return{workplace:"",name:""};try{const{doc:e,getDoc:t}=await O(async()=>{const{doc:d,getDoc:f}=await import("./CvDJqPe-.js").then(k=>k.aE);return{doc:d,getDoc:f}},__vite__mapDeps([0,1]),import.meta.url),l=e(p,"users",c.value.uid),a=await t(l);if(a.exists()){const d=a.data();return{workplace:d.workplace||"",name:d.name||""}}}catch(e){console.error("사용자 정보 가져오기 오류:",e)}return{workplace:"",name:""}},$=async()=>{if(!(!c.value||!p))try{const{collection:e,query:t,where:l,getDocs:a}=await O(async()=>{const{collection:r,query:E,where:g,getDocs:Z}=await import("./CvDJqPe-.js").then(ee=>ee.aE);return{collection:r,query:E,where:g,getDocs:Z}},__vite__mapDeps([0,1]),import.meta.url),d=e(p,"books"),f=t(d,l("rentedBy","==",c.value.uid)),D=(await a(f)).docs.map(r=>r.data()).filter(r=>r.status==="rented"||r.status==="overdue");N.value=D.length;const u=new Date;u.setDate(u.getDate()+1),u.setHours(23,59,59,999),T.value=D.filter(r=>{if(r.rentedAt){const E=r.rentedAt?.toDate?.()||new Date(r.rentedAt),g=new Date(E);return g.setDate(g.getDate()+7),g<=u}return!1}).length;const _=e(p,"rentalHistory"),G=t(_,l("userId","==",c.value.uid)),Y=await a(G);I.value=Y.docs.length}catch(e){console.error("대여 현황 로드 오류:",e)}};M(async()=>{const e=await J();A.value=e.workplace,P.value=e.name,n.value=e.workplace?ue(e.workplace):S[0],await Promise.all([b(),$()])});const K=async()=>{await b()},b=async()=>{try{B.value=!0;const e=await H(n.value);h.value=e.filter(t=>t.location==="구매칸")}catch(e){console.error("신규 도서 로드 오류:",e),h.value=[]}finally{B.value=!1}},j=async e=>{if(!c.value||!e)return;const t=ve(A.value,n.value);if(t&&N.value>=W){await y(`${W}권을 대여중입니다. 대여중인 도서를 반납 후 대여해주세요.`,{type:"warning"});return}const l=t?`"${e.title}"을(를) 대여 신청하시겠습니까?`:`"${e.title}"을(를) 대여 신청하시겠습니까?
(관리자 승인 후 대여 가능)`;if(await Q(l))try{L.value=!0;const a=e.isbn13||e.isbn;t?(await q(a,n.value,c.value.uid),await Promise.all([b(),$()]),await y("도서 대여가 완료되었습니다.",{type:"success"})):(await z(a,n.value,c.value.uid),await b(),await y(`도서 대여가 신청되었습니다.
관리자 승인 후 대여가 완료됩니다.`,{type:"success"}))}catch(a){console.error("대여 신청 오류:",a),await y(a.message||"대여 신청에 실패했습니다.",{type:"error"})}finally{L.value=!1}};return fe({title:"홈 - CNX Library",meta:[{name:"description",content:"CNX Library 도서 관리 시스템"}]}),(e,t)=>{const l=R("v-select"),a=de,d=R("v-btn"),f=me,k=pe,D=R("v-navigation-drawer"),u=R("v-app");return ce(),ie(u,null,{default:C(()=>[m(f,{"header-type":"home","show-header-actions":!0,onToggleDrawer:t[1]||(t[1]=_=>w.value=!o(w))},{default:C(()=>[s("div",ge,[s("div",ye,[s("div",be,[s("h1",ke,v(o(P))+"님의 도서 대여 현황 ",1)]),s("div",De,[s("div",{class:"dashboard-card",onClick:x},[s("div",Ce,v(o(N)),1),t[3]||(t[3]=s("div",{class:"dashboard-label"}," 대여중 도서 ",-1))]),s("div",{class:"dashboard-card warning",onClick:x},[s("div",Re,v(o(T)),1),t[4]||(t[4]=s("div",{class:"dashboard-label"}," 반납 예정 도서 ",-1))]),s("div",{class:"dashboard-card",onClick:x},[s("div",Be,v(o(I)),1),t[5]||(t[5]=s("div",{class:"dashboard-label"}," 내가 읽은 책 ",-1))])])]),s("div",Ne,[s("div",xe,[s("h1",Ee,v(o(n))+" 신규 도서 ",1),m(l,{modelValue:o(n),"onUpdate:modelValue":[t[0]||(t[0]=_=>U(n)?n.value=_:null),K],items:S,variant:"outlined",density:"comfortable","hide-details":"",class:"center-select"},null,8,["modelValue"])])]),s("div",Le,[m(a,{books:o(h),center:o(n),"registered-books":o(h),loading:o(B),title:`총 ${o(h).length}권`,"empty-message":"신규 입고된 도서가 없습니다.","nav-id":"new-books","show-action":!1,"show-status-flags":!0,"show-rent-button":!0,"hide-overdue-status":!0,onRent:j},null,8,["books","center","registered-books","loading","title"]),s("div",Ve,[m(d,{class:"more-books-btn",variant:"flat",size:"large",block:"",to:"/books"},{default:C(()=>[le(v(o(n))+" 도서 더보기 ",1)]),_:1})])])])]),_:1}),m(D,{modelValue:o(w),"onUpdate:modelValue":t[2]||(t[2]=_=>U(w)?w.value=_:null),location:"right",temporary:"",width:o(V),class:"side-navigation"},{default:C(()=>[s("div",Se,[m(k)])]),_:1},8,["modelValue","width"])]),_:1})}}},ze=te(Ae,[["__scopeId","data-v-f96cce31"]]);export{ze as default};
