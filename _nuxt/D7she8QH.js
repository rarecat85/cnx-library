import{a4 as ne,a5 as se,a6 as L,a7 as ae,a8 as B,a9 as oe,aa as ie,ab as ce,ac as ue,ad as le,ae as x,af as de,a as fe,u as me,D as N,ag as he,k as pe,ah as F,ai as ge,aj as we,ak as ye,al as M,am as T,an as V,ao as ve,ap as $,aq as R,ar as Ae}from"./ycURoG9Y.js";const Ee="type.googleapis.com/google.protobuf.Int64Value",ke="type.googleapis.com/google.protobuf.UInt64Value";function W(e,t){const r={};for(const s in e)e.hasOwnProperty(s)&&(r[s]=t(e[s]));return r}function C(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>C(t));if(typeof e=="function"||typeof e=="object")return W(e,t=>C(t));throw new Error("Data cannot be encoded in JSON: "+e)}function S(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Ee:case ke:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>S(t)):typeof e=="function"||typeof e=="object"?W(e,t=>S(t)):e}const _="functions";const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends ce{constructor(t,r,s){super(`${_}/${t}`,r||""),this.details=s,Object.setPrototypeOf(this,y.prototype)}}function be(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function D(e,t){let r=be(e),s=r,n;try{const o=t&&t.error;if(o){const i=o.status;if(typeof i=="string"){if(!q[i])return new y("internal","internal");r=q[i],s=i}const a=o.message;typeof a=="string"&&(s=a),n=o.details,n!==void 0&&(n=S(n))}}catch{}return r==="ok"?null:new y(r,s,n)}class Te{constructor(t,r,s,n){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,de(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||r.get().then(o=>this.auth=o,()=>{}),this.messaging||s.get().then(o=>this.messaging=o,()=>{}),this.appCheck||n?.get().then(o=>this.appCheck=o,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const r=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return r.error?null:r.token}return null}async getContext(t){const r=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(t);return{authToken:r,messagingToken:s,appCheckToken:n}}}const O="us-central1",Se=/^data: (.*?)(?:\n|$)/;function Ie(e){let t=null;return{promise:new Promise((r,s)=>{t=setTimeout(()=>{s(new y("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class Ne{constructor(t,r,s,n,o=O,i=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new Te(t,r,s,n),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(o);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=O}catch{this.customDomain=null,this.region=o}}_delete(){return this.deleteService()}_url(t){const r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${r}.cloudfunctions.net/${t}`}}function Ce(e,t,r){const s=B(t);e.emulatorOrigin=`http${s?"s":""}://${t}:${r}`,s&&(oe(e.emulatorOrigin+"/backends"),ie("Functions",!0))}function De(e,t,r){const s=n=>Re(e,t,n,r||{});return s.stream=(n,o)=>Le(e,t,n,o),s}function X(e){return e.emulatorOrigin&&B(e.emulatorOrigin)?"include":void 0}async function Pe(e,t,r,s,n){r["Content-Type"]="application/json";let o;try{o=await s(e,{method:"POST",body:JSON.stringify(t),headers:r,credentials:X(n)})}catch{return{status:0,json:null}}let i=null;try{i=await o.json()}catch{}return{status:o.status,json:i}}async function Y(e,t){const r={},s=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return s.authToken&&(r.Authorization="Bearer "+s.authToken),s.messagingToken&&(r["Firebase-Instance-ID-Token"]=s.messagingToken),s.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=s.appCheckToken),r}function Re(e,t,r,s){const n=e._url(t);return Oe(e,n,r,s)}async function Oe(e,t,r,s){r=C(r);const n={data:r},o=await Y(e,s),i=s.timeout||7e4,a=Ie(i),h=await Promise.race([Pe(t,n,o,e.fetchImpl,e),a.promise,e.cancelAllRequests]);if(a.cancel(),!h)throw new y("cancelled","Firebase Functions instance was deleted.");const g=D(h.status,h.json);if(g)throw g;if(!h.json)throw new y("internal","Response is not valid JSON object.");let f=h.json.data;if(typeof f>"u"&&(f=h.json.result),typeof f>"u")throw new y("internal","Response is missing data field.");return{data:S(f)}}function Le(e,t,r,s){const n=e._url(t);return _e(e,n,r,s||{})}async function _e(e,t,r,s){r=C(r);const n={data:r},o=await Y(e,s);o["Content-Type"]="application/json",o.Accept="text/event-stream";let i;try{i=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(n),headers:o,signal:s?.signal,credentials:X(e)})}catch(p){if(p instanceof Error&&p.name==="AbortError"){const k=new y("cancelled","Request was cancelled.");return{data:Promise.reject(k),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(k)}}}}}}const E=D(0,null);return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}let a,h;const g=new Promise((p,E)=>{a=p,h=E});s?.signal?.addEventListener("abort",()=>{const p=new y("cancelled","Request was cancelled.");h(p)});const f=i.body.getReader(),v=Ue(f,a,h,s?.signal);return{stream:{[Symbol.asyncIterator](){const p=v.getReader();return{async next(){const{value:E,done:k}=await p.read();return{value:E,done:k}},async return(){return await p.cancel(),{done:!0,value:void 0}}}}},data:g}}function Ue(e,t,r,s){const n=(i,a)=>{const h=i.match(Se);if(!h)return;const g=h[1];try{const f=JSON.parse(g);if("result"in f){t(S(f.result));return}if("message"in f){a.enqueue(S(f.message));return}if("error"in f){const v=D(0,f);a.error(v),r(v);return}}catch(f){if(f instanceof y){a.error(f),r(f);return}}},o=new TextDecoder;return new ReadableStream({start(i){let a="";return h();async function h(){if(s?.aborted){const g=new y("cancelled","Request was cancelled");return i.error(g),r(g),Promise.resolve()}try{const{value:g,done:f}=await e.read();if(f){a.trim()&&n(a.trim(),i),i.close();return}if(s?.aborted){const p=new y("cancelled","Request was cancelled");i.error(p),r(p),await e.cancel();return}a+=o.decode(g,{stream:!0});const v=a.split(`
`);a=v.pop()||"";for(const p of v)p.trim()&&n(p.trim(),i);return h()}catch(g){const f=g instanceof y?g:D(0,null);i.error(f),r(f)}}},cancel(){return e.cancel()}})}const j="@firebase/functions",G="0.13.1";const xe="auth-internal",Fe="app-check-internal",Me="messaging-internal";function Ve(e){const t=(r,{instanceIdentifier:s})=>{const n=r.getProvider("app").getImmediate(),o=r.getProvider(xe),i=r.getProvider(Me),a=r.getProvider(Fe);return new Ne(n,o,i,a,s)};ue(new le(_,t,"PUBLIC").setMultipleInstances(!0)),x(j,G,e),x(j,G,"esm2020")}function H(e=ne(),t=O){const s=se(L(e),_).getImmediate({identifier:t}),n=ae("functions");return n&&$e(s,...n),s}function $e(e,t,r){Ce(L(e),t,r)}function J(e,t,r){return De(L(e),t,r)}Ve();const je=()=>{const{$firebaseAuth:e,$firebaseFirestore:t,$firebaseApp:r}=fe(),s=me(),n=e,o=t,i=N("firebase_user",()=>null),a=N("auth_loading",()=>!0),h=N("auth_initialized",()=>!1);if(n){(async()=>{try{const c=n.currentUser;c&&(await c.reload(),i.value=c,a.value=!1)}catch(c){console.error("초기 사용자 확인 실패:",c)}})();let m=null;const d=new Promise(c=>{m=c});let l=!0;he(n,async c=>{c?(i.value=c,a.value=!1):(i.value=null,a.value=!1),l&&m&&(l=!1,h.value=!0,m(),m=null)}),N("auth_state_ready",()=>d)}else n||(a.value=!1,h.value=!0);const g=async(u,m,d,l)=>{if(!n||!o)return console.error("Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{a.value=!0;const w=(await Ae(n,u,m)).user,I=V(o,"users",w.uid);await $(I,{uid:w.uid,email:u,name:d,workplace:l,emailVerified:!1,emailVerifiedAt:null,createdAt:R(),updatedAt:R()});const A=H(r),P=J(A,"sendSignupVerificationEmail");try{const b=await P({uid:w.uid,email:u,name:d});b.data.success||console.error("인증 메일 발송 실패:",b.data.error)}catch(b){console.error("인증 메일 발송 오류:",b)}return await T(n),a.value=!1,{success:!0,user:w}}catch(c){a.value=!1;let w="회원가입에 실패했습니다.";return c.code==="auth/email-already-in-use"?w="이미 사용 중인 이메일입니다.":c.code==="auth/invalid-email"?w="이메일 형식이 올바르지 않습니다.":c.code==="auth/weak-password"?w="비밀번호가 너무 약합니다.":c.code==="auth/operation-not-allowed"&&(w="이메일/비밀번호 로그인이 비활성화되어 있습니다."),{success:!1,error:w}}},f=async(u,m,d=!1)=>{if(!n||!o)return{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{const c=(await M(n,u,m)).user;await T(n);const w=H(r),A=await J(w,"resendVerificationEmail")({email:u,password:m,isReauth:d});return A.data.success?{success:!0,message:A.data.message}:{success:!1,error:A.data.error||"인증 이메일 발송에 실패했습니다."}}catch(l){let c="이메일 발송에 실패했습니다.";return l.code==="auth/invalid-credential"?c="이메일 또는 비밀번호가 올바르지 않습니다.":l.code==="auth/user-not-found"?c="등록되지 않은 이메일입니다.":l.code==="auth/wrong-password"?c="비밀번호가 올바르지 않습니다.":l.code==="auth/too-many-requests"&&(c="너무 많은 요청이 있습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:c}}},v=async()=>!n||!n.currentUser?{verified:!1}:(await n.currentUser.reload(),{verified:n.currentUser.emailVerified}),p=u=>{try{return btoa(encodeURIComponent(u))}catch{return u}},E=u=>{try{return decodeURIComponent(atob(u))}catch{return u}},k=(u,m)=>{if(m){const d=new Date;d.setMonth(d.getMonth()+1);const l=p(u);localStorage.setItem("autoLoginEmail",l),localStorage.setItem("autoLoginExpiry",d.toISOString()),localStorage.setItem("rememberMe","true")}else localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},z=()=>{const u=localStorage.getItem("autoLoginEmail"),m=localStorage.getItem("autoLoginExpiry");if(!u||!m)return null;const d=new Date(m);return new Date>d?(localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe"),null):{email:E(u),expiry:d}},U=()=>{localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},K=async(u,m,d=!1)=>{if(!n||!o)return console.error("Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{a.value=!0;const c=(await M(n,u,m)).user,w=V(o,"users",c.uid),I=await ve(w);if(!I.exists())return await T(n),i.value=null,a.value=!1,{success:!1,error:"사용자 정보를 찾을 수 없습니다. 회원가입을 다시 진행해주세요."};const A=I.data();if(A.emailVerified!==!0)return await T(n),i.value=null,a.value=!1,{success:!1,error:"이메일 인증이 완료되지 않았습니다. 이메일을 확인하여 인증을 완료해주세요."};if(A.emailVerified===!0&&A.emailVerifiedAt){const P=A.emailVerifiedAt.toDate(),b=new Date,re=new Date(b.getTime()-2160*60*60*1e3);if(P<re)return await $(w,{emailVerified:!1,updatedAt:R()},{merge:!0}),await T(n),i.value=null,a.value=!1,{success:!1,error:"이메일 재인증이 필요합니다. 마지막 인증으로부터 3개월이 지났습니다.",requiresReauth:!0}}return k(u,d),i.value=c,a.value=!1,{success:!0,user:c}}catch(l){a.value=!1;let c="로그인에 실패했습니다.";return l.code==="auth/invalid-credential"?c="이메일 또는 비밀번호가 올바르지 않습니다.":l.code==="auth/user-not-found"?c="등록되지 않은 이메일입니다.":l.code==="auth/wrong-password"?c="비밀번호가 올바르지 않습니다.":l.code==="auth/invalid-email"?c="이메일 형식이 올바르지 않습니다.":l.code==="auth/too-many-requests"&&(c="너무 많은 시도가 있었습니다. 나중에 다시 시도해주세요."),{success:!1,error:c}}},Q=async()=>{if(!n)return console.error("Firebase Auth가 초기화되지 않았습니다."),{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await T(n),i.value=null,U(),await s.push("/login"),{success:!0}}catch(u){return{success:!1,error:u.message}}},Z=async u=>{if(!n)return{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await ye(n,u),{success:!0}}catch(m){let d="이메일 발송에 실패했습니다.";return m.code==="auth/user-not-found"?d="등록되지 않은 이메일입니다.":m.code==="auth/invalid-email"?d="이메일 형식이 올바르지 않습니다.":m.code==="auth/too-many-requests"&&(d="너무 많은 요청이 있었습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:d}}},ee=async(u,m)=>{if(!n)return{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await ge(n,u),await we(n,u,m),{success:!0}}catch(d){let l="비밀번호 재설정에 실패했습니다.";return d.code==="auth/expired-action-code"?l="비밀번호 재설정 링크가 만료되었습니다. 새로운 링크를 요청해주세요.":d.code==="auth/invalid-action-code"?l="유효하지 않은 재설정 링크입니다.":d.code==="auth/user-disabled"?l="비활성화된 계정입니다.":d.code==="auth/weak-password"&&(l="비밀번호가 너무 약합니다."),{success:!1,error:l}}},te=pe(()=>!!i.value);return{user:F(i),loading:F(a),isAuthenticated:te,signup:g,login:K,logout:Q,resendVerificationEmailForLogin:f,checkEmailVerificationStatus:v,sendPasswordResetEmail:Z,confirmPasswordReset:ee,getAutoLoginInfo:z,clearAutoLoginInfo:U}};export{y as F,$e as c,H as g,J as h,je as u};
