const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./H8Z8LE6b.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as re,u as le,N as ce,a as de,r as N,o as U,e as ue,k as z,Y as _e,O as L,L as n,_ as F,g as l,H as c,K as i,P as o,I as s,G as p,U as T,M as _,Q as M,J as C,R as me,S as pe,T as ve,W as fe}from"./H8Z8LE6b.js";import{u as ge,_ as he}from"./BbFETXTL.js";import{u as ye,_ as ke}from"./B_JeLZBQ.js";import{u as we}from"./9l_XyyT8.js";import{u as be}from"./B54HU3Ip.js";import"./teippYbc.js";const Ne={class:"notifications-page"},Ce={class:"page-header mb-4"},Ve={class:"email-notification-setting mb-6"},xe={class:"setting-content"},Re={class:"setting-info"},De={class:"filter-section mb-4"},Ee={key:0,class:"text-center py-8"},Ae={key:1,class:"empty-state"},ze={class:"empty-text"},Le={key:2,class:"notification-list"},Te=["onClick"],Me={class:"notification-icon"},Pe={class:"notification-content"},Se={class:"notification-title"},Ie={class:"notification-message"},Be={class:"notification-time"},Ue={class:"notification-actions"},Fe={key:3,class:"load-more-section"},We={class:"drawer-content"},W=10,$e={__name:"notifications",setup(Oe){const y=le(),{user:k}=we(),{alert:P}=ce(),{$firebaseFirestore:$}=de(),w=$,{notifications:S,unreadCount:V,loading:O,markAsRead:q,markAllAsRead:G,deleteNotification:H,getNotificationIcon:J,getNotificationColor:K,formatNotificationTime:Q}=ge(),{drawer:v,drawerWidth:I}=ye(),m=N("all"),b=N(10),f=N(!0),x=N(!1),X=async()=>{if(!(!k.value||!w))try{const{doc:t,getDoc:e}=await F(async()=>{const{doc:u,getDoc:g}=await import("./H8Z8LE6b.js").then(h=>h.b2);return{doc:u,getDoc:g}},__vite__mapDeps([0,1]),import.meta.url),d=t(w,"users",k.value.uid),r=await e(d);if(r.exists()){const u=r.data();f.value=u.emailNotification!==!1}}catch(t){console.error("이메일 알림 설정 로드 오류:",t)}},Y=async t=>{if(!(!k.value||!w))try{x.value=!0;const{doc:e,updateDoc:d,serverTimestamp:r}=await F(async()=>{const{doc:h,updateDoc:D,serverTimestamp:E}=await import("./H8Z8LE6b.js").then(A=>A.b2);return{doc:h,updateDoc:D,serverTimestamp:E}},__vite__mapDeps([0,1]),import.meta.url),u=e(w,"users",k.value.uid);await d(u,{emailNotification:t,updatedAt:r()}),await P(t?"이메일 알림이 활성화되었습니다.":"이메일 알림이 비활성화되었습니다.",{type:"success"})}catch(e){console.error("이메일 알림 설정 변경 오류:",e),f.value=!t,await P("설정 변경에 실패했습니다.",{type:"error"})}finally{x.value=!1}};U(()=>{X()}),U(()=>{const t=()=>{I.value=window.innerWidth>=769?360:280};t(),window.addEventListener("resize",t),ue(()=>{window.removeEventListener("resize",t)})});const R=z(()=>m.value==="unread"?S.value.filter(t=>!t.isRead):S.value),B=z(()=>R.value.slice(0,b.value)),j=z(()=>R.value.length>b.value);_e(m,()=>{b.value=W});const Z=async t=>{switch(t.isRead||await q(t.id),t.type){case"book_request":y.push("/admin/books/register");break;case"rent_request":case"overdue_admin":y.push("/admin/books");break;case"book_registered":case"book_available":y.push("/books");break;case"return_reminder":case"overdue":y.push("/mypage");break}},ee=async()=>{await G()},te=async t=>{await H(t)},oe=()=>{b.value+=W};return be({title:"알림 - CNX Library",meta:[{name:"description",content:"알림 목록"}]}),(t,e)=>{const d=l("v-btn"),r=l("v-icon"),u=l("v-switch"),g=l("v-chip"),h=l("v-badge"),D=l("v-chip-group"),E=l("v-progress-circular"),A=he,se=ke,ae=l("v-navigation-drawer"),ie=l("v-app");return c(),L(ie,null,{default:n(()=>[i(A,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:e[2]||(e[2]=a=>v.value=!o(v))},{default:n(()=>[s("div",Ne,[s("div",Ce,[e[5]||(e[5]=s("h1",{class:"page-title mb-0"}," 알림 ",-1)),o(V)>0?(c(),L(d,{key:0,variant:"text",size:"small",class:"mark-all-btn",onClick:ee},{default:n(()=>[...e[4]||(e[4]=[_(" 모두 읽음 ",-1)])]),_:1})):T("",!0)]),s("div",Ve,[s("div",xe,[s("div",Re,[i(r,{size:"20",class:"setting-icon"},{default:n(()=>[...e[6]||(e[6]=[_(" mdi-email-outline ",-1)])]),_:1}),e[7]||(e[7]=s("div",{class:"setting-text"},[s("span",{class:"setting-label"},"이메일로 알림 받기"),s("span",{class:"setting-description"},"알림을 이메일로도 받습니다")],-1))]),i(u,{modelValue:o(f),"onUpdate:modelValue":[e[0]||(e[0]=a=>M(f)?f.value=a:null),Y],color:"primary","hide-details":"",density:"compact",loading:o(x)},null,8,["modelValue","loading"])])]),s("div",De,[i(D,{modelValue:o(m),"onUpdate:modelValue":e[1]||(e[1]=a=>M(m)?m.value=a:null),mandatory:"","selected-class":"filter-chip-selected"},{default:n(()=>[i(g,{value:"all",variant:"outlined",class:"filter-chip"},{default:n(()=>[...e[8]||(e[8]=[_(" 전체 ",-1)])]),_:1}),i(g,{value:"unread",variant:"outlined",class:"filter-chip"},{default:n(()=>[e[9]||(e[9]=_(" 읽지 않음 ",-1)),o(V)>0?(c(),L(h,{key:0,content:o(V),inline:"",color:"error",class:"ml-1"},null,8,["content"])):T("",!0)]),_:1})]),_:1},8,["modelValue"])]),o(O)&&o(B).length===0?(c(),p("div",Ee,[i(E,{indeterminate:"",color:"primary"})])):o(R).length===0?(c(),p("div",Ae,[i(r,{size:"64",color:"grey-lighten-1"},{default:n(()=>[...e[10]||(e[10]=[_(" mdi-bell-off-outline ",-1)])]),_:1}),s("p",ze,C(o(m)==="unread"?"읽지 않은 알림이 없습니다":"알림이 없습니다"),1)])):(c(),p("div",Le,[(c(!0),p(me,null,pe(o(B),a=>(c(),p("div",{key:a.id,class:ve(["notification-card",{"notification-unread":!a.isRead}]),onClick:ne=>Z(a)},[s("div",Me,[i(r,{icon:o(J)(a.type),color:o(K)(a.type),size:"28"},null,8,["icon","color"])]),s("div",Pe,[s("div",Se,C(a.title),1),s("div",Ie,C(a.message),1),s("div",Be,C(o(Q)(a.createdAt)),1)]),s("div",Ue,[i(d,{icon:"",variant:"text",size:"small",onClick:fe(ne=>te(a.id),["stop"])},{default:n(()=>[i(r,{size:"20"},{default:n(()=>[...e[11]||(e[11]=[_(" mdi-close ",-1)])]),_:1})]),_:1},8,["onClick"])])],10,Te))),128))])),o(j)?(c(),p("div",Fe,[i(d,{variant:"outlined",color:"primary",onClick:oe},{default:n(()=>[...e[12]||(e[12]=[_(" 더 보기 ",-1)])]),_:1})])):T("",!0)])]),_:1}),i(ae,{modelValue:o(v),"onUpdate:modelValue":e[3]||(e[3]=a=>M(v)?v.value=a:null),location:"right",temporary:"",width:o(I),class:"side-navigation"},{default:n(()=>[s("div",We,[i(se)])]),_:1},8,["modelValue","width"])]),_:1})}}},Xe=re($e,[["__scopeId","data-v-ac5fcdbb"]]);export{Xe as default};
