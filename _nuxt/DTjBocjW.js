const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./L6FuJnzP.js","./entry.DNw42TVG.css"])))=>i.map(i=>d[i]);
import{F as _e,N as ge,a as he,D as ye,r,k as U,o as J,e as fe,_ as M,O as Z,L as y,g as i,H as c,K as l,P as s,I as a,G as f,T as Y,J as $,Q as z,Z as be,M as p,W as F,X as we}from"./L6FuJnzP.js";import{_ as ke}from"./dhdDFyB1.js";import{_ as qe}from"./BmkYwGuW.js";import{g as xe,C as Be,_ as De}from"./DrureYVY.js";import{_ as Re}from"./CyDEYjnW.js";import{u as Ee}from"./DwMBJ7NQ.js";import{u as Ve}from"./qjE2H_as.js";import{u as Ce}from"./Cl55hjl6.js";import"./D8RkMljw.js";const Le={class:"books-request-page"},$e={class:"center-header mb-6"},Se={class:"center-header-inner"},Ne={class:"page-title mb-0"},Te={class:"search-section mb-6"},Pe={key:0,class:"search-loading-section mb-8"},Ie={class:"text-center py-8"},We={key:1,class:"search-empty-section mb-8"},Ae={class:"text-center py-8 text-medium-emphasis empty-state"},Oe={class:"mb-2"},Ue={key:2,class:"search-results-section mb-8"},Me={class:"search-results-header mb-4"},ze={class:"text-body-1"},Fe={key:0,class:"d-flex justify-center mt-6"},Ke={class:"drawer-content"},He={__name:"request",setup(Qe){const{user:E}=Ee(),{searchBooks:ee,getBooksByCenter:te,getBestsellers:se}=Ve(),{alert:V}=ge(),{$firebaseFirestore:oe}=he(),b=oe,q=ye("navigationDrawer",()=>!1),K=r(280),H=[...Be],o=r(""),ae=r(""),_=r(""),w=r([]),x=r(10),C=r(!1),Q=r(null),S=r(!1),B=U(()=>w.value.slice(0,x.value)),re=U(()=>w.value.length),ne=U(()=>x.value<w.value.length),N=r([]),T=r(!1),L=r([]),D=r([]),P=r(new Set);J(()=>{const e=()=>{K.value=window.innerWidth>=769?360:280};e(),window.addEventListener("resize",e),fe(()=>{window.removeEventListener("resize",e)})});const le=async()=>{if(!E.value||!b)return"";try{const{doc:e,getDoc:t}=await M(async()=>{const{doc:d,getDoc:g}=await import("./L6FuJnzP.js").then(h=>h.aE);return{doc:d,getDoc:g}},__vite__mapDeps([0,1]),import.meta.url),n=e(b,"users",E.value.uid),u=await t(n);if(u.exists())return u.data().workplace||""}catch(e){console.error("사용자 근무지 정보 가져오기 오류:",e)}return""};J(async()=>{const e=await le();ae.value=e,o.value=e?xe(e):H[0],await Promise.all([X(),j(),I()])});const ie=async()=>{await Promise.all([X(),j(),I()])},ce=async()=>{if(_.value.trim())try{C.value=!0,Q.value=null,x.value=10,S.value=!0;const e=await ee(_.value);w.value=e.items||[]}catch(e){console.error("도서 검색 오류:",e),Q.value=e.message||"도서 검색에 실패했습니다.",w.value=[]}finally{C.value=!1}},ue=()=>{_.value="",w.value=[],x.value=10,S.value=!1},de=()=>{x.value+=10},X=async()=>{try{T.value=!0;const e=await se(10);N.value=e.items||[]}catch(e){console.error("베스트셀러 로드 오류:",e),N.value=[]}finally{T.value=!1}},j=async()=>{try{const e=await te(o.value);L.value=e}catch(e){console.error("등록된 도서 로드 오류:",e),L.value=[]}},I=async()=>{try{if(!b){D.value=[];return}const{collection:e,query:t,where:n,getDocs:u}=await M(async()=>{const{collection:m,query:R,where:W,getDocs:A}=await import("./L6FuJnzP.js").then(O=>O.aE);return{collection:m,query:R,where:W,getDocs:A}},__vite__mapDeps([0,1]),import.meta.url),d=e(b,"bookRequests"),g=t(d,n("center","==",o.value),n("status","==","pending")),h=await u(g),k=[];h.forEach(m=>{k.push({id:m.id,...m.data()})}),D.value=k}catch(e){console.error("신청된 도서 로드 오류:",e),D.value=[]}},G=async e=>{const t=e.isbn13||e.isbn||"";if(!t){await V("ISBN 정보가 없어 신청할 수 없습니다.",{type:"error"});return}if(!P.value.has(t))try{if(P.value.add(t),!b||!E.value){await V("로그인이 필요합니다.",{type:"warning"});return}const{collection:n,addDoc:u,serverTimestamp:d}=await M(async()=>{const{collection:h,addDoc:k,serverTimestamp:m}=await import("./L6FuJnzP.js").then(R=>R.aE);return{collection:h,addDoc:k,serverTimestamp:m}},__vite__mapDeps([0,1]),import.meta.url);await u(n(b,"bookRequests"),{isbn13:e.isbn13||"",isbn:e.isbn||"",title:e.title||"",author:e.author||"",publisher:e.publisher||"",cover:e.cover||e.image||"",description:e.description||"",pubDate:e.pubDate||"",center:o.value,status:"pending",requestedBy:E.value.uid,requestedAt:d()}),await I();const g=e.title||"도서";await V(`"${g}"이(가) ${o.value}에 신청되었습니다.

관리자 승인 후 등록됩니다.`,{type:"success"})}catch(n){console.error("도서 신청 오류:",n),await V(n.message||"도서 신청에 실패했습니다.",{type:"error"})}finally{P.value.delete(t)}};return Ce({title:"도서 신청 - CNX Library",meta:[{name:"description",content:"센터별 도서 신청"}]}),(e,t)=>{const n=i("v-select"),u=i("v-text-field"),d=i("v-progress-circular"),g=i("v-icon"),h=ke,k=i("v-col"),m=i("v-row"),R=i("v-btn"),W=qe,A=De,O=Re,me=i("v-navigation-drawer"),ve=i("v-app");return c(),Z(ve,null,{default:y(()=>[l(A,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:t[2]||(t[2]=v=>q.value=!s(q))},{default:y(()=>[a("div",Le,[a("div",$e,[a("div",Se,[a("h1",Ne,$(s(o))+" 도서 신청 ",1),l(n,{modelValue:s(o),"onUpdate:modelValue":[t[0]||(t[0]=v=>z(o)?o.value=v:null),ie],items:H,variant:"outlined",density:"comfortable","hide-details":"",class:"center-select"},null,8,["modelValue"])])]),a("div",Te,[l(u,{modelValue:s(_),"onUpdate:modelValue":t[1]||(t[1]=v=>z(_)?_.value=v:null),label:"도서 검색",placeholder:"도서명 또는 ISBN-13으로 검색","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable",loading:s(C),clearable:"",class:"search-input",onKeyup:be(ce,["enter"]),"onClick:clear":ue},null,8,["modelValue","loading"])]),s(C)?(c(),f("div",Pe,[a("div",Ie,[l(d,{indeterminate:"",color:"primary"}),t[4]||(t[4]=a("p",{class:"mt-4 text-medium-emphasis"}," 검색 중... ",-1))])])):s(S)&&s(B).length===0?(c(),f("div",We,[a("div",Ae,[l(g,{size:"48",color:"grey-lighten-1",class:"mb-4"},{default:y(()=>[...t[5]||(t[5]=[p(" mdi-book-search-outline ",-1)])]),_:1}),a("p",Oe,[t[6]||(t[6]=p(" '",-1)),a("strong",null,$(s(_)),1),t[7]||(t[7]=p("'에 대한 검색 결과가 없습니다. ",-1))]),t[8]||(t[8]=a("p",{class:"text-body-2"}," 다른 검색어로 시도해보세요. ",-1))])])):s(B).length>0?(c(),f("div",Ue,[a("div",Me,[a("div",ze,[s(re)>=10?(c(),f(F,{key:0},[t[9]||(t[9]=p(" 검색 결과가 많습니다. (현재 ",-1)),a("strong",null,$(s(B).length),1),t[10]||(t[10]=p("개 표시 중) ",-1))],64)):(c(),f(F,{key:1},[t[11]||(t[11]=p(" 총 ",-1)),a("strong",null,$(s(B).length),1),t[12]||(t[12]=p("개의 검색 결과 ",-1))],64))])]),l(m,{class:"book-list-row"},{default:y(()=>[(c(!0),f(F,null,we(s(B),(v,pe)=>(c(),Z(k,{key:`search-${pe}`,cols:"12",sm:"6",class:"book-list-col"},{default:y(()=>[l(h,{book:v,center:s(o),"registered-books":s(L),"requested-books":s(D),selectable:!1,"show-action":!0,"action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,onRegister:G},null,8,["book","center","registered-books","requested-books","action-button-text","registered-message","requested-message"])]),_:2},1024))),128))]),_:1}),s(ne)?(c(),f("div",Fe,[l(R,{variant:"outlined",color:"primary",onClick:de},{default:y(()=>[...t[13]||(t[13]=[p(" 더보기 ",-1)])]),_:1})])):Y("",!0)])):Y("",!0),l(W,{books:s(N),center:s(o),"registered-books":s(L),"requested-books":s(D),title:"베스트셀러",loading:s(T),"empty-message":"베스트셀러를 불러올 수 없습니다.","action-button-text":`${s(o)}에 신청하기`,"registered-message":`${s(o)}에 등록된 도서입니다.`,"requested-message":`${s(o)}에 이미 신청된 도서입니다.`,"nav-id":"bestseller",class:"mb-8",onRegister:G},null,8,["books","center","registered-books","requested-books","loading","action-button-text","registered-message","requested-message"])])]),_:1}),l(me,{modelValue:s(q),"onUpdate:modelValue":t[3]||(t[3]=v=>z(q)?q.value=v:null),location:"right",temporary:"",width:s(K),class:"side-navigation"},{default:y(()=>[a("div",Ke,[l(O)])]),_:1},8,["modelValue","width"])]),_:1})}}},ot=_e(He,[["__scopeId","data-v-c6c62a83"]]);export{ot as default};
