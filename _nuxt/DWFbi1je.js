import{a4 as oe,a5 as ce,a6 as M,a7 as ue,a8 as Y,a9 as le,aa as de,ab as fe,ac as me,ad as he,ae as j,af as ge,a as pe,u as we,D as U,ag as ye,k as Ae,ah as G,ai as N,aj as L,ak as R,al as b,am as Ee,an as ve,ao as ke,ap as V,aq as y,ar as P,as as be}from"./Ctv-B8Av.js";const Te="type.googleapis.com/google.protobuf.Int64Value",Se="type.googleapis.com/google.protobuf.UInt64Value";function z(e,r){const s={};for(const a in e)e.hasOwnProperty(a)&&(s[a]=r(e[a]));return s}function x(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(r=>x(r));if(typeof e=="function"||typeof e=="object")return z(e,r=>x(r));throw new Error("Data cannot be encoded in JSON: "+e)}function D(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case Te:case Se:{const r=Number(e.value);if(isNaN(r))throw new Error("Data cannot be decoded from JSON: "+e);return r}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(r=>D(r)):typeof e=="function"||typeof e=="object"?z(e,r=>D(r)):e}const $="functions";const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends fe{constructor(r,s,a){super(`${$}/${r}`,s||""),this.details=a,Object.setPrototypeOf(this,v.prototype)}}function Ie(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function F(e,r){let s=Ie(e),a=s,t;try{const o=r&&r.error;if(o){const c=o.status;if(typeof c=="string"){if(!H[c])return new v("internal","internal");s=H[c],a=c}const n=o.message;typeof n=="string"&&(a=n),t=o.details,t!==void 0&&(t=D(t))}}catch{}return s==="ok"?null:new v(s,a,t)}class Ce{constructor(r,s,a,t){this.app=r,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,ge(r)&&r.settings.appCheckToken&&(this.serverAppAppCheckToken=r.settings.appCheckToken),this.auth=s.getImmediate({optional:!0}),this.messaging=a.getImmediate({optional:!0}),this.auth||s.get().then(o=>this.auth=o,()=>{}),this.messaging||a.get().then(o=>this.messaging=o,()=>{}),this.appCheck||t?.get().then(o=>this.appCheck=o,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(r){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const s=r?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return s.error?null:s.token}return null}async getContext(r){const s=await this.getAuthToken(),a=await this.getMessagingToken(),t=await this.getAppCheckToken(r);return{authToken:s,messagingToken:a,appCheckToken:t}}}const _="us-central1",De=/^data: (.*?)(?:\n|$)/;function Ne(e){let r=null;return{promise:new Promise((s,a)=>{r=setTimeout(()=>{a(new v("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{r&&clearTimeout(r)}}}class Re{constructor(r,s,a,t,o=_,c=(...n)=>fetch(...n)){this.app=r,this.fetchImpl=c,this.emulatorOrigin=null,this.contextProvider=new Ce(r,s,a,t),this.cancelAllRequests=new Promise(n=>{this.deleteService=()=>Promise.resolve(n())});try{const n=new URL(o);this.customDomain=n.origin+(n.pathname==="/"?"":n.pathname),this.region=_}catch{this.customDomain=null,this.region=o}}_delete(){return this.deleteService()}_url(r){const s=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${s}/${this.region}/${r}`:this.customDomain!==null?`${this.customDomain}/${r}`:`https://${this.region}-${s}.cloudfunctions.net/${r}`}}function Pe(e,r,s){const a=Y(r);e.emulatorOrigin=`http${a?"s":""}://${r}:${s}`,a&&(le(e.emulatorOrigin+"/backends"),de("Functions",!0))}function Oe(e,r,s){const a=t=>Le(e,r,t,s||{});return a.stream=(t,o)=>xe(e,r,t,o),a}function K(e){return e.emulatorOrigin&&Y(e.emulatorOrigin)?"include":void 0}async function Ue(e,r,s,a,t){s["Content-Type"]="application/json";let o;try{o=await a(e,{method:"POST",body:JSON.stringify(r),headers:s,credentials:K(t)})}catch{return{status:0,json:null}}let c=null;try{c=await o.json()}catch{}return{status:o.status,json:c}}async function Q(e,r){const s={},a=await e.contextProvider.getContext(r.limitedUseAppCheckTokens);return a.authToken&&(s.Authorization="Bearer "+a.authToken),a.messagingToken&&(s["Firebase-Instance-ID-Token"]=a.messagingToken),a.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=a.appCheckToken),s}function Le(e,r,s,a){const t=e._url(r);return Ve(e,t,s,a)}async function Ve(e,r,s,a){s=x(s);const t={data:s},o=await Q(e,a),c=a.timeout||7e4,n=Ne(c),g=await Promise.race([Ue(r,t,o,e.fetchImpl,e),n.promise,e.cancelAllRequests]);if(n.cancel(),!g)throw new v("cancelled","Firebase Functions instance was deleted.");const w=F(g.status,g.json);if(w)throw w;if(!g.json)throw new v("internal","Response is not valid JSON object.");let h=g.json.data;if(typeof h>"u"&&(h=g.json.result),typeof h>"u")throw new v("internal","Response is missing data field.");return{data:D(h)}}function xe(e,r,s,a){const t=e._url(r);return Fe(e,t,s,a||{})}async function Fe(e,r,s,a){s=x(s);const t={data:s},o=await Q(e,a);o["Content-Type"]="application/json",o.Accept="text/event-stream";let c;try{c=await e.fetchImpl(r,{method:"POST",body:JSON.stringify(t),headers:o,signal:a?.signal,credentials:K(e)})}catch(p){if(p instanceof Error&&p.name==="AbortError"){const C=new v("cancelled","Request was cancelled.");return{data:Promise.reject(C),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(C)}}}}}}const T=F(0,null);return{data:Promise.reject(T),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(T)}}}}}}let n,g;const w=new Promise((p,T)=>{n=p,g=T});a?.signal?.addEventListener("abort",()=>{const p=new v("cancelled","Request was cancelled.");g(p)});const h=c.body.getReader(),k=_e(h,n,g,a?.signal);return{stream:{[Symbol.asyncIterator](){const p=k.getReader();return{async next(){const{value:T,done:C}=await p.read();return{value:T,done:C}},async return(){return await p.cancel(),{done:!0,value:void 0}}}}},data:w}}function _e(e,r,s,a){const t=(c,n)=>{const g=c.match(De);if(!g)return;const w=g[1];try{const h=JSON.parse(w);if("result"in h){r(D(h.result));return}if("message"in h){n.enqueue(D(h.message));return}if("error"in h){const k=F(0,h);n.error(k),s(k);return}}catch(h){if(h instanceof v){n.error(h),s(h);return}}},o=new TextDecoder;return new ReadableStream({start(c){let n="";return g();async function g(){if(a?.aborted){const w=new v("cancelled","Request was cancelled");return c.error(w),s(w),Promise.resolve()}try{const{value:w,done:h}=await e.read();if(h){n.trim()&&t(n.trim(),c),c.close();return}if(a?.aborted){const p=new v("cancelled","Request was cancelled");c.error(p),s(p),await e.cancel();return}n+=o.decode(w,{stream:!0});const k=n.split(`
`);n=k.pop()||"";for(const p of k)p.trim()&&t(p.trim(),c);return g()}catch(w){const h=w instanceof v?w:F(0,null);c.error(h),s(h)}}},cancel(){return e.cancel()}})}const J="@firebase/functions",W="0.13.1";const Me="auth-internal",$e="app-check-internal",qe="messaging-internal";function je(e){const r=(s,{instanceIdentifier:a})=>{const t=s.getProvider("app").getImmediate(),o=s.getProvider(Me),c=s.getProvider(qe),n=s.getProvider($e);return new Re(t,o,c,n,a)};me(new he($,r,"PUBLIC").setMultipleInstances(!0)),j(J,W,e),j(J,W,"esm2020")}function B(e=oe(),r=_){const a=ce(M(e),$).getImmediate({identifier:r}),t=ue("functions");return t&&Ge(a,...t),a}function Ge(e,r,s){Pe(M(e),r,s)}function X(e,r,s){return Oe(M(e),r,s)}je();const Je=()=>{const{$firebaseAuth:e,$firebaseFirestore:r,$firebaseApp:s}=pe(),a=we(),t=e,o=r,c=U("firebase_user",()=>null),n=U("auth_loading",()=>!0),g=U("auth_initialized",()=>!1);if(t){(async()=>{try{const i=t.currentUser;if(i&&(await i.reload(),c.value=i,n.value=!1,i.emailVerified&&o))try{const m=N(o,"users",i.uid),A=await L(m);A.exists()&&(A.data().emailVerifiedAt||await R(m,{emailVerified:!0,emailVerifiedAt:b(),updatedAt:b()},{merge:!0}))}catch(m){console.error("이메일 인증 상태 업데이트 실패:",m)}}catch(i){console.error("초기 사용자 확인 실패:",i)}})();let d=null;const f=new Promise(i=>{d=i});let l=!0;ye(t,async i=>{if(i){if(c.value=i,n.value=!1,i.emailVerified&&o)try{const m=N(o,"users",i.uid),A=await L(m);A.exists()&&(A.data().emailVerifiedAt||await R(m,{emailVerified:!0,emailVerifiedAt:b(),updatedAt:b()},{merge:!0}))}catch(m){console.error("이메일 인증 상태 업데이트 실패:",m)}}else c.value=null,n.value=!1;l&&d&&(l=!1,g.value=!0,d(),d=null)}),U("auth_state_ready",()=>f)}else t||(n.value=!1,g.value=!0);const w=async(u,d,f,l)=>{if(!t||!o)return console.error("Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{n.value=!0;const m=(await be(t,u,d)).user;await P(m);const A=N(o,"users",m.uid);return await R(A,{uid:m.uid,email:u,name:f,workplace:l,emailVerified:!1,emailVerifiedAt:null,createdAt:b(),updatedAt:b()}),await y(t),n.value=!1,{success:!0,user:m}}catch(i){n.value=!1;let m="회원가입에 실패했습니다.";return i.code==="auth/email-already-in-use"?m="이미 사용 중인 이메일입니다.":i.code==="auth/invalid-email"?m="이메일 형식이 올바르지 않습니다.":i.code==="auth/weak-password"?m="비밀번호가 너무 약합니다.":i.code==="auth/operation-not-allowed"&&(m="이메일/비밀번호 로그인이 비활성화되어 있습니다."),{success:!1,error:m}}},h=async()=>{if(!t||!t.currentUser)return{success:!1,error:"로그인이 필요합니다."};try{return await P(t.currentUser),{success:!0}}catch(u){let d="이메일 발송에 실패했습니다.";return u.code==="auth/too-many-requests"&&(d="너무 많은 요청이 있었습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:d}}},k=async(u,d)=>{if(!t||!o)return{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{const l=(await V(t,u,d)).user,i=N(o,"users",l.uid),m=await L(i);if(m.exists()){if(m.data().emailVerified===!0&&l.emailVerified){const E=B(s),S=X(E,"resendVerificationEmailWithReset");try{const I=await S({email:u,password:d});if(I.data.success){await y(t);const ie=(await V(t,u,d)).user;return await P(ie),await y(t),{success:!0}}else return await y(t),{success:!1,error:I.data.error||"재인증 이메일 발송에 실패했습니다."}}catch(I){return await y(t),console.error("Functions 호출 오류:",I),{success:!1,error:"재인증 이메일 발송에 실패했습니다."}}}}else if(l.emailVerified){const A=B(s),E=X(A,"resendVerificationEmailWithReset");try{const S=await E({email:u,password:d});if(S.data.success){await y(t);const O=(await V(t,u,d)).user;return await P(O),await y(t),{success:!0}}else return await y(t),{success:!1,error:S.data.error||"재인증 이메일 발송에 실패했습니다."}}catch(S){return await y(t),console.error("Functions 호출 오류:",S),{success:!1,error:"재인증 이메일 발송에 실패했습니다."}}}try{await P(l)}catch(A){await y(t);let E="이메일 발송에 실패했습니다.";return A.code==="auth/too-many-requests"&&(E="너무 많은 요청이 있었습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:E}}return await y(t),{success:!0}}catch(f){try{t.currentUser&&await y(t)}catch(i){console.error("로그아웃 처리 중 오류:",i)}let l="이메일 발송에 실패했습니다.";return f.code==="auth/invalid-credential"?l="이메일 또는 비밀번호가 올바르지 않습니다.":f.code==="auth/user-not-found"?l="등록되지 않은 이메일입니다.":f.code==="auth/wrong-password"?l="비밀번호가 올바르지 않습니다.":f.code==="auth/too-many-requests"&&(l="너무 많은 요청이 있었습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:l}}},p=async()=>!t||!t.currentUser?{verified:!1}:(await t.currentUser.reload(),{verified:t.currentUser.emailVerified}),T=u=>{try{return btoa(encodeURIComponent(u))}catch{return u}},C=u=>{try{return decodeURIComponent(atob(u))}catch{return u}},Z=(u,d)=>{if(d){const f=new Date;f.setMonth(f.getMonth()+1);const l=T(u);localStorage.setItem("autoLoginEmail",l),localStorage.setItem("autoLoginExpiry",f.toISOString()),localStorage.setItem("rememberMe","true")}else localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},ee=()=>{const u=localStorage.getItem("autoLoginEmail"),d=localStorage.getItem("autoLoginExpiry");if(!u||!d)return null;const f=new Date(d);return new Date>f?(localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe"),null):{email:C(u),expiry:f}},q=()=>{localStorage.removeItem("autoLoginEmail"),localStorage.removeItem("autoLoginExpiry"),localStorage.removeItem("rememberMe")},te=async(u,d,f=!1)=>{if(!t||!o)return console.error("Firebase가 초기화되지 않았습니다."),{success:!1,error:"Firebase가 초기화되지 않았습니다."};try{n.value=!0;const i=(await V(t,u,d)).user;if(await i.reload(),!i.emailVerified)return await y(t),c.value=null,n.value=!1,{success:!1,error:"이메일 인증이 완료되지 않았습니다. 이메일을 확인하여 인증을 완료해주세요."};const m=N(o,"users",i.uid),A=await L(m);if(!A.exists())return await R(m,{uid:i.uid,email:i.email,emailVerified:!0,emailVerifiedAt:b(),createdAt:b(),updatedAt:b()}),c.value=i,{success:!0,user:i};const E=A.data();if(E.emailVerified===!1||E.emailVerified===void 0)return await y(t),c.value=null,n.value=!1,{success:!1,error:"이메일 인증이 완료되지 않았습니다. 이메일을 확인하여 인증을 완료해주세요."};if(E.emailVerified===!0&&E.emailVerifiedAt){const S=E.emailVerifiedAt.toDate(),I=new Date,O=new Date(I.getTime()-2160*60*60*1e3);if(S<O)return await R(m,{emailVerified:!1,updatedAt:b()},{merge:!0}),await y(t),c.value=null,n.value=!1,{success:!1,error:"이메일 재인증이 필요합니다. 마지막 인증으로부터 3개월이 지났습니다. 재인증 이메일을 발송해주세요.",requiresReauth:!0}}return Z(u,f),c.value=i,{success:!0,user:i}}catch(l){n.value=!1;let i="로그인에 실패했습니다.";return l.code==="auth/invalid-credential"?i="이메일 또는 비밀번호가 올바르지 않습니다.":l.code==="auth/user-not-found"?i="등록되지 않은 이메일입니다.":l.code==="auth/wrong-password"?i="비밀번호가 올바르지 않습니다.":l.code==="auth/invalid-email"?i="이메일 형식이 올바르지 않습니다.":l.code==="auth/too-many-requests"&&(i="너무 많은 시도가 있었습니다. 나중에 다시 시도해주세요."),{success:!1,error:i}}},re=async()=>{if(!t)return console.error("Firebase Auth가 초기화되지 않았습니다."),{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await y(t),c.value=null,q(),await a.push("/login"),{success:!0}}catch(u){return{success:!1,error:u.message}}},se=async u=>{if(!t)return{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await ke(t,u),{success:!0}}catch(d){let f="이메일 발송에 실패했습니다.";return d.code==="auth/user-not-found"?f="등록되지 않은 이메일입니다.":d.code==="auth/invalid-email"?f="이메일 형식이 올바르지 않습니다.":d.code==="auth/too-many-requests"&&(f="너무 많은 요청이 있었습니다. 잠시 후 다시 시도해주세요."),{success:!1,error:f}}},ae=async(u,d)=>{if(!t)return{success:!1,error:"Firebase Auth가 초기화되지 않았습니다."};try{return await Ee(t,u),await ve(t,u,d),{success:!0}}catch(f){let l="비밀번호 재설정에 실패했습니다.";return f.code==="auth/expired-action-code"?l="비밀번호 재설정 링크가 만료되었습니다. 새로운 링크를 요청해주세요.":f.code==="auth/invalid-action-code"?l="유효하지 않은 재설정 링크입니다.":f.code==="auth/user-disabled"?l="비활성화된 계정입니다.":f.code==="auth/weak-password"&&(l="비밀번호가 너무 약합니다."),{success:!1,error:l}}},ne=Ae(()=>!!c.value);return{user:G(c),loading:G(n),isAuthenticated:ne,signup:w,login:te,logout:re,resendVerificationEmail:h,resendVerificationEmailForLogin:k,checkEmailVerificationStatus:p,sendPasswordResetEmail:se,confirmPasswordReset:ae,getAutoLoginInfo:ee,clearAutoLoginInfo:q}};export{v as F,Ge as c,B as g,X as h,Je as u};
