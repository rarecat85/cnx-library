const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./H8Z8LE6b.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as K,u as X,a as G,r as n,o as J,_ as T,O as h,L as u,g as m,H as k,K as r,I as i,G as Q,P as s,W as j,U as A,Q as E,M as x,J as M}from"./H8Z8LE6b.js";import{_ as q}from"./teippYbc.js";import{C as Y,_ as Z,W as ee,a as te}from"./BbFETXTL.js";import{s as se}from"./C-xtXPWq.js";import{u as ae}from"./9l_XyyT8.js";import{u as oe}from"./B54HU3Ip.js";const le={key:0,class:"text-center py-8"},ne={class:"password-change-section mb-2"},re={class:"auth-links text-center mt-4"},ie={class:"logo-bottom text-center mt-6"},ue={class:"logo-with-credit"},ce={__name:"edit",setup(de){const O=X(),{user:b,sendPasswordResetEmail:S}=ae(),{$firebaseFirestore:z}=G(),V=z,g=n(""),p=n(""),y=n(""),l=n(""),v=n(""),P=n(),C=n(!0),c=n(!1),R=n(!1),B=[...ee],F=[t=>!!t||"이름을 입력해주세요"],I=[t=>!!t||"근무지를 선택해주세요"];J(async()=>{if(!b.value||!V){C.value=!1;return}try{const{doc:t,getDoc:e}=await T(async()=>{const{doc:o,getDoc:a}=await import("./H8Z8LE6b.js").then(_=>_.b2);return{doc:o,getDoc:a}},__vite__mapDeps([0,1]),import.meta.url),w=t(V,"users",b.value.uid),d=await e(w);if(d.exists()){const o=d.data();g.value=o.name||"",p.value=o.email||b.value.email||"";let a=o.workplace||"";Y.includes(a)&&(a==="강남센터"?a="강남":a==="용산센터"&&(a="용산")),y.value=a}}catch(t){console.error("사용자 정보 로드 오류:",t),l.value="사용자 정보를 불러오는데 실패했습니다."}finally{C.value=!1}});const U=async()=>{if(p.value){l.value="",v.value="";try{R.value=!0;const t=await S(p.value);t.success?v.value="비밀번호 재설정 링크가 이메일로 발송되었습니다. 이메일을 확인해주세요.":l.value=t.error||"비밀번호 재설정 이메일 발송에 실패했습니다."}catch(t){console.error("비밀번호 재설정 오류:",t),l.value="비밀번호 재설정 이메일 발송에 실패했습니다."}finally{R.value=!1}}},W=async()=>{if(!b.value||!V)return;l.value="",v.value="";const{valid:t}=await P.value.validate();if(t)try{c.value=!0;const{doc:e,updateDoc:w,serverTimestamp:d}=await T(async()=>{const{doc:_,updateDoc:L,serverTimestamp:N}=await import("./H8Z8LE6b.js").then(D=>D.b2);return{doc:_,updateDoc:L,serverTimestamp:N}},__vite__mapDeps([0,1]),import.meta.url),o=e(V,"users",b.value.uid),a=se(g.value);await w(o,{name:a,workplace:y.value,updatedAt:d()}),v.value="정보가 수정되었습니다.",setTimeout(()=>{O.push("/mypage")},1500)}catch(e){console.error("정보 수정 오류:",e),l.value="정보 수정에 실패했습니다."}finally{c.value=!1}};return oe({title:"정보수정 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(t,e)=>{const w=m("v-progress-circular"),d=m("v-text-field"),o=m("v-btn"),a=m("v-select"),_=m("v-alert"),L=m("v-form"),N=q,D=te,$=Z,H=m("v-app");return k(),h(H,null,{default:u(()=>[r($,null,{default:u(()=>[e[9]||(e[9]=i("div",{class:"text-center mb-8"},[i("h1",{class:"login-title mb-2"}," CNX Library "),i("p",{class:"login-subtitle"}," 정보수정 ")],-1)),s(C)?(k(),Q("div",le,[r(w,{indeterminate:"",color:"primary"})])):(k(),h(L,{key:1,ref_key:"editForm",ref:P,"validate-on":"submit",onSubmit:j(W,["prevent"])},{default:u(()=>[r(d,{modelValue:s(g),"onUpdate:modelValue":e[0]||(e[0]=f=>E(g)?g.value=f:null),label:"이름","prepend-inner-icon":"mdi-account-outline",variant:"outlined",rules:F,disabled:s(c),class:"mb-2",density:"comfortable"},null,8,["modelValue","disabled"]),r(d,{modelValue:s(p),"onUpdate:modelValue":e[1]||(e[1]=f=>E(p)?p.value=f:null),label:"이메일",type:"email","prepend-inner-icon":"mdi-email-outline",variant:"outlined",disabled:"",class:"mb-2",density:"comfortable"},null,8,["modelValue"]),i("div",ne,[r(o,{variant:"flat",block:"",size:"large",loading:s(R),disabled:s(R)||s(c),class:"password-change-btn",onClick:U},{default:u(()=>[...e[4]||(e[4]=[x(" 비밀번호 변경 ",-1)])]),_:1},8,["loading","disabled"]),e[5]||(e[5]=i("p",{class:"password-hint"}," 비밀번호 변경 링크가 이메일로 발송됩니다. ",-1))]),r(a,{modelValue:s(y),"onUpdate:modelValue":e[2]||(e[2]=f=>E(y)?y.value=f:null),label:"근무지",items:B,"prepend-inner-icon":"mdi-office-building-outline",variant:"outlined",rules:I,disabled:s(c),class:"mb-2",density:"comfortable"},null,8,["modelValue","disabled"]),s(l)?(k(),h(_,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert mb-4","onClick:close":e[3]||(e[3]=f=>l.value="")},{default:u(()=>[x(M(s(l)),1)]),_:1})):A("",!0),s(v)?(k(),h(_,{key:1,type:"success",variant:"tonal",class:"success-alert mb-4"},{default:u(()=>[x(M(s(v)),1)]),_:1})):A("",!0),r(o,{type:"submit",block:"",size:"large",loading:s(c),disabled:s(c),class:"save-btn",elevation:"2"},{default:u(()=>[...e[6]||(e[6]=[x(" 저장 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},512)),i("div",re,[r(N,{to:"/mypage",class:"auth-link"},{default:u(()=>[...e[7]||(e[7]=[x(" 마이페이지로 돌아가기 ",-1)])]),_:1})]),i("div",ie,[i("div",ue,[r(D),e[8]||(e[8]=i("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},ge=K(ce,[["__scopeId","data-v-04033266"]]);export{ge as default};
