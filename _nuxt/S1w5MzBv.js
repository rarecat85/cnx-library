import{_ as q}from"./D9b46GtD.js";import{_ as Y,a as Z}from"./DWDJZdXV.js";import{F as ee,u as te,r as l,k as oe,R as ae,o as se,D as U,a as ne,O as R,L as c,g as d,H as V,K as r,I as a,S as B,T as M,P as o,Q as N,M as w,G as le,J as T,U as re}from"./CWgZd2SI.js";import{u as A}from"./BslKsjqr.js";import{s as ie}from"./DCnKJkJP.js";import{u as ue}from"./B-m16083.js";const ce={class:"remember-me-container mb-4"},de={class:"error-content"},me={class:"error-message"},pe=["disabled"],ve={class:"auth-links text-center mt-4"},fe={class:"logo-bottom text-center mt-6"},_e={class:"logo-with-credit"},be={__name:"login",setup(ge){const{login:D,loading:m,resendVerificationEmailForLogin:E,user:F,getAutoLoginInfo:$}=A(),L=te(),u=l(""),p=l(""),n=l(""),z=l(),y=l(!1),k=l(!1),v=l(!1),g=l(!1),f=l(0);let s=null;const H=oe(()=>f.value>0?`잠시 후 다시 시도해주세요. (${f.value}초 후)`:n.value.replace(/\s*\(\d+초 후\)/,"")),P=()=>{n.value="",f.value=0,s&&(clearInterval(s),s=null)},W=t=>{const e=t.match(/\((\d+)초 후\)/);if(e){const h=parseInt(e[1],10);f.value=h,s&&clearInterval(s),s=ie(()=>{f.value--,f.value<=0&&(clearInterval(s),s=null,n.value="")},1e3)}};ae(()=>{s&&clearInterval(s)}),se(async()=>{localStorage.getItem("rememberMe")==="true"&&(g.value=!0);const e=U("auth_state_ready");if(!U("auth_initialized",()=>!1).value&&e.value)try{await Promise.race([e.value,new Promise(i=>setTimeout(i,5e3))])}catch(i){console.error("인증 상태 확인 대기 중 오류:",i)}const{loading:x}=A();if(x.value){const _=Date.now();for(;x.value&&Date.now()-_<3e3;)await new Promise(C=>setTimeout(C,100))}if(F.value){await L.push("/");return}const I=$();if(I){const{$firebaseAuth:i}=ne(),_=i;if(_&&_.currentUser){await L.push("/");return}u.value=I.email}});const X=[t=>!!t||"이메일을 입력해주세요",t=>/.+@.+\..+/.test(t)||"올바른 이메일 형식이 아닙니다"],G=[t=>!!t||"비밀번호를 입력해주세요",t=>t&&t.length>=6||"비밀번호는 6자 이상이어야 합니다"],J=async()=>{n.value="",k.value=!1;const{valid:t}=await z.value.validate();if(!t)return;const e=await D(u.value,p.value,g.value);e.success?await L.push("/"):(n.value=e.error||"로그인에 실패했습니다.",e.error&&(e.error.includes("이메일 인증이 완료되지 않았습니다")||e.error.includes("이메일 재인증이 필요합니다"))&&(k.value=!0))},K=async()=>{if(!u.value||!p.value){n.value="이메일과 비밀번호를 입력해주세요.";return}v.value=!0,P();const t=await E(u.value,p.value);t.success?(n.value="인증 이메일이 재전송되었습니다. 이메일을 확인해주세요.",k.value=!1):(n.value=t.error||"이메일 재전송에 실패했습니다.",t.error&&t.error.includes("초 후")&&W(t.error)),v.value=!1};return ue({title:"로그인 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(t,e)=>{const h=d("v-text-field"),x=d("v-checkbox"),I=d("v-progress-circular"),i=d("v-alert"),_=d("v-btn"),C=d("v-form"),S=q,O=Z,Q=Y,j=d("v-app");return V(),R(j,null,{default:c(()=>[r(Q,null,{default:c(()=>[e[9]||(e[9]=a("div",{class:"text-center mb-8"},[a("h1",{class:"login-title mb-2"}," CNX Library "),a("p",{class:"login-subtitle"}," 로그인하여 시작하세요 ")],-1)),r(C,{ref_key:"loginForm",ref:z,"validate-on":"submit",onSubmit:B(J,["prevent"])},{default:c(()=>[r(h,{modelValue:o(u),"onUpdate:modelValue":e[0]||(e[0]=b=>N(u)?u.value=b:null),label:"이메일",type:"email","prepend-inner-icon":"mdi-email-outline",variant:"outlined",rules:X,disabled:o(m),class:"mb-2",density:"comfortable"},null,8,["modelValue","disabled"]),r(h,{modelValue:o(p),"onUpdate:modelValue":e[1]||(e[1]=b=>N(p)?p.value=b:null),label:"비밀번호",type:o(y)?"text":"password","prepend-inner-icon":"mdi-lock-outline","append-inner-icon":o(y)?"mdi-eye-off-outline":"mdi-eye-outline",variant:"outlined",rules:G,disabled:o(m),class:"mb-2",density:"comfortable","onClick:appendInner":e[2]||(e[2]=b=>y.value=!o(y))},null,8,["modelValue","type","append-inner-icon","disabled"]),a("div",ce,[r(x,{modelValue:o(g),"onUpdate:modelValue":e[3]||(e[3]=b=>N(g)?g.value=b:null),label:"자동로그인",color:"primary","hide-details":"",disabled:o(m),density:"compact"},null,8,["modelValue","disabled"])]),o(n)?(V(),R(i,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert mb-4","onClick:close":P},{default:c(()=>[a("div",de,[a("div",me,[w(T(o(H))+" ",1),o(k)?(V(),le("a",{key:0,href:"#",class:re(["resend-link",{resending:o(v)}]),disabled:o(v)||o(m),onClick:B(K,["prevent"])},[o(v)?(V(),R(I,{key:0,indeterminate:"",size:"14",width:"2",class:"mr-1"})):M("",!0),w(" "+T(o(v)?"재전송 중...":"인증 이메일 재전송"),1)],10,pe)):M("",!0)])])]),_:1})):M("",!0),r(_,{type:"submit",block:"",size:"large",loading:o(m),disabled:o(m),class:"login-btn",elevation:"2"},{default:c(()=>[...e[4]||(e[4]=[w(" 로그인 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},512),a("div",ve,[r(S,{to:"/signup",class:"auth-link"},{default:c(()=>[...e[5]||(e[5]=[w(" 회원가입 ",-1)])]),_:1}),e[7]||(e[7]=a("span",{class:"auth-link-divider"},null,-1)),r(S,{to:"/forgot-password",class:"auth-link"},{default:c(()=>[...e[6]||(e[6]=[w(" 비밀번호찾기 ",-1)])]),_:1})]),a("div",fe,[a("div",_e,[r(O),e[8]||(e[8]=a("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},Ve=ee(be,[["__scopeId","data-v-9b7f5ebb"]]);export{Ve as default};
