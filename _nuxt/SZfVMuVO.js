const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./H8Z8LE6b.js","./entry.yfGVSS21.css"])))=>i.map(i=>d[i]);
import{F as ga,N as ya,a as _a,r as c,k as Q,o as Ue,e as wa,Y as Ca,O as Ne,L as o,_ as Se,g as _,H as g,K as t,P as n,I as r,Q as b,G as y,R as ve,S as pe,U as fe,M as v,J as $,W as ka}from"./H8Z8LE6b.js";import{g as ba,C as X,_ as Va}from"./BbFETXTL.js";import{u as xa,_ as Ia}from"./B_JeLZBQ.js";import{u as Da,D as Ee}from"./yWPze8eg.js";import{u as La}from"./9l_XyyT8.js";import{u as ha}from"./B54HU3Ip.js";import"./teippYbc.js";const Ua={class:"settings-admin-page"},Na={class:"center-header mb-6"},Sa={class:"center-header-inner"},Ea={class:"section mb-8"},za={key:0,class:"text-center py-8"},Aa={key:1,class:"categories-grid"},$a={class:"category-label"},Fa={class:"category-count"},Ra={class:"section mb-8"},Ma={key:0,class:"text-center py-6"},Pa={key:1,class:"shelf-images-container"},Ta=["onClick"],Ba=["src","alt"],Oa={class:"image-overlay"},Wa={class:"shelf-image-name"},ja={class:"add-image-placeholder"},Ga={class:"section"},Ha={key:0,class:"text-center py-6"},Ka={key:1,class:"location-grid"},Ja={key:0,class:"location-edit-form"},Qa={class:"location-edit-actions mt-2"},Xa={key:1,class:"location-view"},Ya={class:"location-info"},qa={class:"location-name"},Za={class:"location-image-name"},et={key:0,class:"image-preview-small mt-4"},at=["src"],tt={class:"dialog-title"},lt={class:"preview-image-container"},ot=["src","alt"],nt={class:"drawer-content"},st={__name:"index",setup(it){const{confirm:ge,alert:f}=ya(),{user:ye}=La(),{$firebaseFirestore:ze}=_a(),Y=ze,{loadCategorySettings:_e,saveCategorySettings:Ae,loadAdditionalCategories:$e,addCategory:Fe,deleteCategory:Re,getBookCountByCategory:Me,loadShelfImages:Pe,uploadShelfImage:we,deleteShelfImage:Te,updateShelfImageName:Be,loadLocationMapping:Oe,saveLocationMapping:Ce,loadCenterLocations:We,addCenterLocation:je,updateLocationName:Ge}=Da(),{drawer:F,drawerWidth:ke}=xa(),j=c(null),q=[...X],m=c(""),Z=c(!1),ee=c([]),R=c(!1),G=c({name:""}),ae=c(!1),He=Q(()=>ee.value),te=c(!1),H=c([]),K=c(!1),J=c(!1),M=c(!1),be=c(null),S=c(null),w=c({name:"",file:null}),le=c({name:""}),V=c(!1),oe=c(!1),P=c({}),x=c({}),ne=c([]),T=c(!1),k=c({name:"",imageId:null}),B=c(!1),se=c(null),E=c(""),I=c(null),Ke=Q(()=>ne.value.map(a=>({value:a.name,text:a.name}))),ie=Q(()=>H.value.filter(a=>a.center===m.value)),Ve=Q(()=>ie.value.map(a=>({id:a.id,name:a.name})));Ue(()=>{const a=()=>{ke.value=window.innerWidth>=769?360:280};a(),window.addEventListener("resize",a),wa(()=>{window.removeEventListener("resize",a)})});const Je=async()=>{if(!ye.value||!Y)return"";try{const{doc:a,getDoc:e}=await Se(async()=>{const{doc:i,getDoc:d}=await import("./H8Z8LE6b.js").then(p=>p.b2);return{doc:i,getDoc:d}},__vite__mapDeps([0,1]),import.meta.url),s=a(Y,"users",ye.value.uid),u=await e(s);if(u.exists())return u.data().workplace||""}catch(a){console.error("근무지 정보 로드 오류:",a)}return""};Ue(async()=>{const a=await Je();if(a){const e=ba(a);m.value=e||q[0]}else m.value=q[0];await Promise.all([re(),O(),de(),W()])}),Ca(m,async()=>{ue(),await W()});const re=async()=>{try{Z.value=!0;let a={items:{}},e=[];try{a=await _e()}catch(i){console.warn("카테고리 설정 로드 실패, 기본값 사용:",i)}try{e=await $e()}catch(i){console.warn("추가 카테고리 로드 실패:",i)}const s=Ee.map(i=>({name:i,isDefault:!0,centers:a.items?.[i]||[...X],bookCount:0})),u=[...new Set(e.map(i=>i.name))];for(const i of u)s.find(d=>d.name===i)||s.push({name:i,isDefault:!1,centers:a.items?.[i]||[...X],bookCount:0});for(const i of s)try{i.bookCount=await Me(i.name)}catch(d){console.warn(`카테고리 ${i.name} 도서 수 로드 실패:`,d),i.bookCount=0}s.sort((i,d)=>i.name.localeCompare(d.name,"ko")),ee.value=s}catch(a){console.error("카테고리 로드 오류:",a),ee.value=Ee.map(e=>({name:e,isDefault:!0,centers:[...X],bookCount:0}))}finally{Z.value=!1}},Qe=()=>{G.value={name:""},R.value=!0},xe=()=>{R.value=!1},Xe=async()=>{try{ae.value=!0,await Fe(G.value.name,[m.value]),await f("카테고리가 추가되었습니다.",{type:"success"}),xe(),await re()}catch(a){console.error("카테고리 저장 오류:",a),await f(a.message||"카테고리 저장에 실패했습니다.",{type:"error"})}finally{ae.value=!1}},Ye=async(a,e)=>{const s=[...a.centers];try{let u=[...a.centers];e?u.includes(m.value)||u.push(m.value):u=u.filter(d=>d!==m.value),a.centers=u;let i={items:{}};try{i=await _e()}catch{}if(i.items=i.items||{},i.items[a.name]=u,await Ae(i),!a.isDefault){const{doc:d,setDoc:p,deleteDoc:L,serverTimestamp:ce}=await Se(async()=>{const{doc:z,setDoc:A,deleteDoc:U,serverTimestamp:N}=await import("./H8Z8LE6b.js").then(me=>me.b2);return{doc:z,setDoc:A,deleteDoc:U,serverTimestamp:N}},__vite__mapDeps([0,1]),import.meta.url),h=`${m.value}_${a.name}`,D=d(Y,"categories",h);e?await p(D,{center:m.value,name:a.name,createdAt:ce()}):await L(D)}}catch(u){console.error("센터 사용여부 저장 오류:",u),a.centers=s,await f("저장에 실패했습니다. Firestore 규칙이 배포되었는지 확인해주세요.",{type:"error"})}},qe=async a=>{if(a.bookCount>0){await f("해당 카테고리에 등록된 도서가 있어 삭제할 수 없습니다.",{type:"error"});return}if(await ge(`"${a.name}" 카테고리를 삭제하시겠습니까?`))try{await Re(a.name),await f("카테고리가 삭제되었습니다.",{type:"success"}),await re()}catch(s){console.error("카테고리 삭제 오류:",s),await f(s.message||"카테고리 삭제에 실패했습니다.",{type:"error"})}},O=async()=>{try{te.value=!0;const a=await Pe();H.value=a}catch(a){console.error("이미지 로드 오류:",a),H.value=[]}finally{te.value=!1}},Ie=()=>{K.value=!1},Ze=async()=>{try{V.value=!0,await we(w.value.file[0],w.value.name),await f("이미지가 업로드되었습니다.",{type:"success"}),Ie(),await O()}catch(a){console.error("이미지 업로드 오류:",a),await f(a.message||"이미지 업로드에 실패했습니다.",{type:"error"})}finally{V.value=!1}},De=()=>{J.value=!1,be.value=null},ea=a=>{S.value=a,M.value=!0},aa=()=>{M.value=!1,S.value=null},ta=async()=>{try{V.value=!0,await Be(be.value.id,le.value.name),await f("이미지 이름이 수정되었습니다.",{type:"success"}),De(),await O()}catch(a){console.error("이미지 이름 수정 오류:",a),await f(a.message||"이미지 이름 수정에 실패했습니다.",{type:"error"})}finally{V.value=!1}},la=async a=>{if(await ge(`"${a.name}" 이미지를 삭제하시겠습니까?`))try{await Te(a.id),await f("이미지가 삭제되었습니다.",{type:"success"}),await O()}catch(s){console.error("이미지 삭제 오류:",s),await f(s.message||"이미지 삭제에 실패했습니다.",{type:"error"})}},oa=a=>a?URL.createObjectURL(a):"",na=()=>{j.value?.click()},sa=()=>{const a=ie.value;if(a.length===0)return 1;const e=a.map(s=>{const u=s.name.match(/서가 이미지 (\d+)/);return u?parseInt(u[1],10):0}).filter(s=>s>0);return e.length===0?a.length+1:Math.max(...e)+1},ia=async a=>{const e=a.target.files?.[0];if(!e)return;const u=`서가 이미지 ${sa()}`;try{V.value=!0,await we(e,u,m.value),await f("이미지가 업로드되었습니다.",{type:"success"}),await O()}catch(i){console.error("이미지 업로드 오류:",i),await f(i.message||"이미지 업로드에 실패했습니다.",{type:"error"})}finally{V.value=!1,j.value&&(j.value.value="")}},ra=a=>{const e=x.value[a];return e&&H.value.find(u=>u.id===e)?.name||"-"},de=async()=>{try{oe.value=!0;const a=await Oe();P.value=a||{},ue()}catch(a){console.error("매핑 로드 오류:",a),P.value={},ue()}finally{oe.value=!1}},ue=()=>{x.value=P.value[m.value]||{}},W=async()=>{try{ne.value=await We(m.value)}catch(a){console.error("커스텀 칸 로드 오류:",a),ne.value=[]}},da=()=>{k.value={name:"",imageId:null},T.value=!0},Le=()=>{T.value=!1},ua=async()=>{try{if(B.value=!0,await je(m.value,k.value.name),k.value.imageId){const a={...x.value};a[k.value.name]=k.value.imageId,await Ce(m.value,a),P.value[m.value]=a,x.value=a}await f("칸이 추가되었습니다.",{type:"success"}),Le(),await W()}catch(a){console.error("칸 추가 오류:",a),await f(a.message||"칸 추가에 실패했습니다.",{type:"error"})}finally{B.value=!1}},ca=a=>{se.value=a.value,E.value=a.text,I.value=x.value[a.value]||null},he=()=>{se.value=null,E.value="",I.value=null},ma=async a=>{const e=E.value.trim();if(!e){await f("칸 이름을 입력해주세요.",{type:"error"});return}try{B.value=!0;let s=!1,u=!1;if(e!==a){const d=await Ge(m.value,a,e);s=!0,d.updatedCount>0&&(await W(),await de())}const i=x.value[s?e:a];if(I.value!==i){const d={...x.value},p=s?e:a;I.value?d[p]=I.value:delete d[p],await Ce(m.value,d),P.value[m.value]=d,x.value=d,u=!0}(s||u)&&await f("변경사항이 저장되었습니다.",{type:"success"}),he(),s&&(await W(),await de())}catch(s){console.error("칸 정보 변경 오류:",s),await f(s.message||"저장에 실패했습니다.",{type:"error"})}finally{B.value=!1}};return ha({title:"설정 관리 - CNX Library",meta:[{name:"description",content:"카테고리 및 위치 설정 관리"}]}),(a,e)=>{const s=_("v-select"),u=_("v-progress-circular"),i=_("v-checkbox"),d=_("v-icon"),p=_("v-btn"),L=_("v-text-field"),ce=Va,h=_("v-card-title"),D=_("v-card-text"),z=_("v-spacer"),A=_("v-card-actions"),U=_("v-card"),N=_("v-dialog"),me=_("v-file-input"),va=Ia,pa=_("v-navigation-drawer"),fa=_("v-app");return g(),Ne(fa,null,{default:o(()=>[t(ce,{"header-type":"back-home","show-header-actions":!0,onToggleDrawer:e[3]||(e[3]=l=>F.value=!n(F))},{default:o(()=>[r("div",Ua,[r("div",Na,[r("div",Sa,[e[16]||(e[16]=r("h1",{class:"page-title mb-0"}," 설정 관리 ",-1)),t(s,{modelValue:n(m),"onUpdate:modelValue":e[0]||(e[0]=l=>b(m)?m.value=l:null),items:q,variant:"outlined",density:"comfortable","hide-details":"",class:"center-select"},null,8,["modelValue"])])]),r("div",Ea,[e[20]||(e[20]=r("h3",{class:"section-title mb-4"}," 카테고리 관리 ",-1)),n(Z)?(g(),y("div",za,[t(u,{indeterminate:"",color:"primary"})])):(g(),y("div",Aa,[(g(!0),y(ve,null,pe(n(He),l=>(g(),y("div",{key:l.name,class:"category-item"},[t(i,{"model-value":l.centers.includes(n(m)),density:"compact","hide-details":"",color:"primary",class:"category-checkbox","onUpdate:modelValue":C=>Ye(l,C)},null,8,["model-value","onUpdate:modelValue"]),r("span",$a,[v($(l.name)+" ",1),r("span",Fa,"("+$(l.bookCount||0)+")",1)]),!l.isDefault&&l.bookCount===0?(g(),Ne(p,{key:0,icon:"",size:"x-small",variant:"text",color:"error",class:"category-delete-btn",onClick:C=>qe(l)},{default:o(()=>[t(d,{size:"small"},{default:o(()=>[...e[17]||(e[17]=[v(" mdi-close ",-1)])]),_:1})]),_:1},8,["onClick"])):fe("",!0)]))),128)),r("div",{class:"category-item category-add-item",onClick:Qe},[t(d,{size:"small",color:"primary",class:"mr-1"},{default:o(()=>[...e[18]||(e[18]=[v(" mdi-plus ",-1)])]),_:1}),e[19]||(e[19]=r("span",{class:"category-add-label"},"카테고리 추가",-1))])]))]),r("div",Ra,[e[25]||(e[25]=r("h3",{class:"section-title mb-4"}," 서가 이미지 ",-1)),n(te)?(g(),y("div",Ma,[t(u,{indeterminate:"",color:"primary"})])):(g(),y("div",Pa,[(g(!0),y(ve,null,pe(n(ie),l=>(g(),y("div",{key:l.id,class:"shelf-image-item"},[r("div",{class:"shelf-image-wrapper",onClick:C=>ea(l)},[r("img",{src:l.url,alt:l.name},null,8,Ba),r("div",Oa,[t(d,{color:"white",size:"24"},{default:o(()=>[...e[21]||(e[21]=[v(" mdi-magnify-plus ",-1)])]),_:1})]),t(p,{icon:"",size:"small",color:"error",variant:"flat",class:"delete-image-btn",onClick:ka(C=>la(l),["stop"])},{default:o(()=>[t(d,{size:"small"},{default:o(()=>[...e[22]||(e[22]=[v(" mdi-delete ",-1)])]),_:1})]),_:1},8,["onClick"])],8,Ta),r("div",Wa,$(l.name),1)]))),128)),r("div",{class:"shelf-image-item add-image-item",onClick:na},[r("div",ja,[t(d,{size:"32",color:"grey"},{default:o(()=>[...e[23]||(e[23]=[v(" mdi-plus ",-1)])]),_:1})]),e[24]||(e[24]=r("div",{class:"shelf-image-name text-grey"}," 이미지 추가 ",-1))])])),r("input",{ref_key:"fileInputRef",ref:j,type:"file",accept:"image/*",style:{display:"none"},onChange:ia},null,544)]),r("div",Ga,[e[31]||(e[31]=r("h3",{class:"section-title mb-4"}," 칸-이미지 매핑 ",-1)),n(oe)?(g(),y("div",Ha,[t(u,{indeterminate:"",color:"primary"})])):(g(),y("div",Ka,[(g(!0),y(ve,null,pe(n(Ke),l=>(g(),y("div",{key:l.value,class:"location-item"},[n(se)===l.value?(g(),y("div",Ja,[t(L,{modelValue:n(E),"onUpdate:modelValue":e[1]||(e[1]=C=>b(E)?E.value=C:null),label:"칸 이름",density:"compact","hide-details":"",variant:"outlined",class:"location-edit-input mb-2"},null,8,["modelValue"]),t(s,{modelValue:n(I),"onUpdate:modelValue":e[2]||(e[2]=C=>b(I)?I.value=C:null),items:n(Ve),"item-title":"name","item-value":"id",label:"서가 이미지",density:"compact","hide-details":"",variant:"outlined",placeholder:"이미지 선택",clearable:"",class:"location-edit-input"},null,8,["modelValue","items"]),r("div",Qa,[t(p,{size:"small",color:"primary",variant:"flat",onClick:C=>ma(l.value)},{default:o(()=>[...e[26]||(e[26]=[v(" 저장 ",-1)])]),_:1},8,["onClick"]),t(p,{size:"small",variant:"text",onClick:he},{default:o(()=>[...e[27]||(e[27]=[v(" 취소 ",-1)])]),_:1})])])):(g(),y("div",Xa,[r("div",Ya,[r("span",qa,$(l.text),1),r("span",Za,$(ra(l.value)),1)]),t(p,{icon:"",size:"x-small",variant:"text",class:"location-edit-btn",onClick:C=>ca(l)},{default:o(()=>[t(d,{size:"small"},{default:o(()=>[...e[28]||(e[28]=[v("mdi-pencil",-1)])]),_:1})]),_:1},8,["onClick"])]))]))),128)),r("div",{class:"location-item location-add-item",onClick:da},[t(d,{size:"24",color:"primary"},{default:o(()=>[...e[29]||(e[29]=[v(" mdi-plus ",-1)])]),_:1}),e[30]||(e[30]=r("span",{class:"location-add-label"},"칸 추가",-1))])]))])])]),_:1}),t(N,{modelValue:n(R),"onUpdate:modelValue":e[5]||(e[5]=l=>b(R)?R.value=l:null),"max-width":"400",persistent:""},{default:o(()=>[t(U,null,{default:o(()=>[t(h,{class:"dialog-title"},{default:o(()=>[...e[32]||(e[32]=[v(" 카테고리 추가 ",-1)])]),_:1}),t(D,null,{default:o(()=>[t(L,{modelValue:n(G).name,"onUpdate:modelValue":e[4]||(e[4]=l=>n(G).name=l),label:"카테고리명",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(A,null,{default:o(()=>[t(z),t(p,{variant:"text",onClick:xe},{default:o(()=>[...e[33]||(e[33]=[v(" 취소 ",-1)])]),_:1}),t(p,{color:"primary",loading:n(ae),onClick:Xe},{default:o(()=>[...e[34]||(e[34]=[v(" 추가 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:n(T),"onUpdate:modelValue":e[8]||(e[8]=l=>b(T)?T.value=l:null),"max-width":"400",persistent:""},{default:o(()=>[t(U,null,{default:o(()=>[t(h,{class:"dialog-title"},{default:o(()=>[...e[35]||(e[35]=[v(" 칸 추가 ",-1)])]),_:1}),t(D,null,{default:o(()=>[t(L,{modelValue:n(k).name,"onUpdate:modelValue":e[6]||(e[6]=l=>n(k).name=l),label:"칸 이름",variant:"outlined",density:"comfortable",placeholder:"예: 17번 칸, 신규칸 등",class:"mb-4"},null,8,["modelValue"]),t(s,{modelValue:n(k).imageId,"onUpdate:modelValue":e[7]||(e[7]=l=>n(k).imageId=l),items:n(Ve),"item-title":"name","item-value":"id",label:"서가 이미지",variant:"outlined",density:"comfortable",placeholder:"이미지 선택 (선택사항)",clearable:"","no-data-text":"등록된 이미지가 없습니다. 먼저 서가 이미지를 추가해주세요."},null,8,["modelValue","items"])]),_:1}),t(A,null,{default:o(()=>[t(z),t(p,{variant:"text",onClick:Le},{default:o(()=>[...e[36]||(e[36]=[v(" 취소 ",-1)])]),_:1}),t(p,{color:"primary",loading:n(B),onClick:ua},{default:o(()=>[...e[37]||(e[37]=[v(" 추가 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:n(K),"onUpdate:modelValue":e[11]||(e[11]=l=>b(K)?K.value=l:null),"max-width":"400",persistent:""},{default:o(()=>[t(U,null,{default:o(()=>[t(h,{class:"dialog-title"},{default:o(()=>[...e[38]||(e[38]=[v(" 서가 이미지 업로드 ",-1)])]),_:1}),t(D,null,{default:o(()=>[t(L,{modelValue:n(w).name,"onUpdate:modelValue":e[9]||(e[9]=l=>n(w).name=l),label:"이미지 이름",variant:"outlined",density:"comfortable",class:"mb-4"},null,8,["modelValue"]),t(me,{modelValue:n(w).file,"onUpdate:modelValue":e[10]||(e[10]=l=>n(w).file=l),label:"이미지 파일",variant:"outlined",density:"comfortable",accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-image"},null,8,["modelValue"]),n(w).file&&n(w).file.length>0?(g(),y("div",et,[r("img",{src:oa(n(w).file[0]),alt:"미리보기"},null,8,at)])):fe("",!0)]),_:1}),t(A,null,{default:o(()=>[t(z),t(p,{variant:"text",onClick:Ie},{default:o(()=>[...e[39]||(e[39]=[v(" 취소 ",-1)])]),_:1}),t(p,{color:"primary",loading:n(V),disabled:!n(w).name||!n(w).file||n(w).file.length===0,onClick:Ze},{default:o(()=>[...e[40]||(e[40]=[v(" 업로드 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:n(J),"onUpdate:modelValue":e[13]||(e[13]=l=>b(J)?J.value=l:null),"max-width":"400",persistent:""},{default:o(()=>[t(U,null,{default:o(()=>[t(h,{class:"dialog-title"},{default:o(()=>[...e[41]||(e[41]=[v(" 이미지 이름 수정 ",-1)])]),_:1}),t(D,null,{default:o(()=>[t(L,{modelValue:n(le).name,"onUpdate:modelValue":e[12]||(e[12]=l=>n(le).name=l),label:"이미지 이름",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(A,null,{default:o(()=>[t(z),t(p,{variant:"text",onClick:De},{default:o(()=>[...e[42]||(e[42]=[v(" 취소 ",-1)])]),_:1}),t(p,{color:"primary",loading:n(V),onClick:ta},{default:o(()=>[...e[43]||(e[43]=[v(" 수정 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:n(M),"onUpdate:modelValue":e[14]||(e[14]=l=>b(M)?M.value=l:null),"max-width":"800"},{default:o(()=>[t(U,{class:"image-preview-card"},{default:o(()=>[t(h,{class:"d-flex justify-space-between align-center"},{default:o(()=>[r("span",tt,$(n(S)?.name),1),t(p,{icon:"",variant:"text",size:"small",onClick:aa},{default:o(()=>[t(d,null,{default:o(()=>[...e[44]||(e[44]=[v("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(D,{class:"pa-0"},{default:o(()=>[r("div",lt,[n(S)?(g(),y("img",{key:0,src:n(S).url,alt:n(S).name,class:"preview-image"},null,8,ot)):fe("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(pa,{modelValue:n(F),"onUpdate:modelValue":e[15]||(e[15]=l=>b(F)?F.value=l:null),location:"right",temporary:"",width:n(ke),class:"side-navigation"},{default:o(()=>[r("div",nt,[t(va)])]),_:1},8,["modelValue","width"])]),_:1})}}},ft=ga(st,[["__scopeId","data-v-5ad1e75e"]]);export{ft as default};
