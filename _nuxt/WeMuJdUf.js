import{_ as J}from"./D-dwZDKr.js";import{_ as K,a as O}from"./ZWYCtuu7.js";import{F as Q,u as j,r,o as q,D as z,a as Y,O as C,L as d,g as c,H as x,K as n,I as s,R as P,S as R,P as t,Q as I,M as g,G as Z,J as S,T as ee}from"./r35rfKyc.js";import{u as B}from"./DmLlqz6Z.js";import{u as te}from"./DIODFKFe.js";const oe={class:"remember-me-container mb-4"},se={class:"error-content"},ae={class:"error-message"},ne=["disabled"],le={class:"auth-links text-center mt-4"},re={class:"logo-bottom text-center mt-6"},ie={class:"logo-with-credit"},ue={__name:"login",setup(de){const{login:T,loading:m,resendVerificationEmailForLogin:A,user:D,getAutoLoginInfo:F}=B(),k=j(),i=r(""),p=r(""),a=r(""),M=r(),b=r(!1),y=r(!1),v=r(!1),_=r(!1);q(async()=>{localStorage.getItem("rememberMe")==="true"&&(_.value=!0);const e=z("auth_state_ready");if(!z("auth_initialized",()=>!1).value&&e.value)try{await Promise.race([e.value,new Promise(l=>setTimeout(l,5e3))])}catch(l){console.error("인증 상태 확인 대기 중 오류:",l)}const{loading:h}=B();if(h.value){const f=Date.now();for(;h.value&&Date.now()-f<3e3;)await new Promise(L=>setTimeout(L,100))}if(D.value){await k.push("/");return}const w=F();if(w){const{$firebaseAuth:l}=Y(),f=l;if(f&&f.currentUser){await k.push("/");return}i.value=w.email}});const U=[o=>!!o||"이메일을 입력해주세요",o=>/.+@.+\..+/.test(o)||"올바른 이메일 형식이 아닙니다"],$=[o=>!!o||"비밀번호를 입력해주세요",o=>o&&o.length>=6||"비밀번호는 6자 이상이어야 합니다"],E=async()=>{a.value="",y.value=!1;const{valid:o}=await M.value.validate();if(!o)return;const e=await T(i.value,p.value,_.value);e.success?await k.push("/"):(a.value=e.error||"로그인에 실패했습니다.",e.error&&(e.error.includes("이메일 인증이 완료되지 않았습니다")||e.error.includes("이메일 재인증이 필요합니다"))&&(y.value=!0))},H=async()=>{if(!i.value||!p.value){a.value="이메일과 비밀번호를 입력해주세요.";return}v.value=!0,a.value="";const o=await A(i.value,p.value);o.success?(a.value="인증 이메일이 재전송되었습니다. 이메일을 확인해주세요.",y.value=!1):a.value=o.error||"이메일 재전송에 실패했습니다.",v.value=!1};return te({title:"로그인 - CNX Library",link:[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:""},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"}]}),(o,e)=>{const V=c("v-text-field"),h=c("v-checkbox"),w=c("v-progress-circular"),l=c("v-alert"),f=c("v-btn"),L=c("v-form"),N=J,W=O,X=K,G=c("v-app");return x(),C(G,null,{default:d(()=>[n(X,null,{default:d(()=>[e[10]||(e[10]=s("div",{class:"text-center mb-8"},[s("h1",{class:"login-title mb-2"}," CNX Library "),s("p",{class:"login-subtitle"}," 로그인하여 시작하세요 ")],-1)),n(L,{ref_key:"loginForm",ref:M,"validate-on":"submit",onSubmit:P(E,["prevent"])},{default:d(()=>[n(V,{modelValue:t(i),"onUpdate:modelValue":e[0]||(e[0]=u=>I(i)?i.value=u:null),label:"이메일",type:"email","prepend-inner-icon":"mdi-email-outline",variant:"outlined",rules:U,disabled:t(m),class:"mb-2",density:"comfortable"},null,8,["modelValue","disabled"]),n(V,{modelValue:t(p),"onUpdate:modelValue":e[1]||(e[1]=u=>I(p)?p.value=u:null),label:"비밀번호",type:t(b)?"text":"password","prepend-inner-icon":"mdi-lock-outline","append-inner-icon":t(b)?"mdi-eye-off-outline":"mdi-eye-outline",variant:"outlined",rules:$,disabled:t(m),class:"mb-2",density:"comfortable","onClick:appendInner":e[2]||(e[2]=u=>b.value=!t(b))},null,8,["modelValue","type","append-inner-icon","disabled"]),s("div",oe,[n(h,{modelValue:t(_),"onUpdate:modelValue":e[3]||(e[3]=u=>I(_)?_.value=u:null),label:"자동로그인",color:"primary","hide-details":"",disabled:t(m),density:"compact"},null,8,["modelValue","disabled"])]),t(a)?(x(),C(l,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert mb-4","onClick:close":e[4]||(e[4]=u=>a.value="")},{default:d(()=>[s("div",se,[s("div",ae,[g(S(t(a))+" ",1),t(y)?(x(),Z("a",{key:0,href:"#",class:ee(["resend-link",{resending:t(v)}]),disabled:t(v)||t(m),onClick:P(H,["prevent"])},[t(v)?(x(),C(w,{key:0,indeterminate:"",size:"14",width:"2",class:"mr-1"})):R("",!0),g(" "+S(t(v)?"재전송 중...":"인증 이메일 재전송"),1)],10,ne)):R("",!0)])])]),_:1})):R("",!0),n(f,{type:"submit",block:"",size:"large",loading:t(m),disabled:t(m),class:"login-btn",elevation:"2"},{default:d(()=>[...e[5]||(e[5]=[g(" 로그인 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},512),s("div",le,[n(N,{to:"/signup",class:"auth-link"},{default:d(()=>[...e[6]||(e[6]=[g(" 회원가입 ",-1)])]),_:1}),e[8]||(e[8]=s("span",{class:"auth-link-divider"},null,-1)),n(N,{to:"/forgot-password",class:"auth-link"},{default:d(()=>[...e[7]||(e[7]=[g(" 비밀번호찾기 ",-1)])]),_:1})]),s("div",re,[s("div",ie,[n(W),e[9]||(e[9]=s("span",{class:"credit-text"},"© rarecat",-1))])])]),_:1})]),_:1})}}},_e=Q(ue,[["__scopeId","data-v-914405e5"]]);export{_e as default};
